<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Toko Buku Islam</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary-color: #2c5aa0;
            --secondary-color: #ffffff;
            --accent-color: #e74c3c;
            --text-color: #333333;
            --light-gray: #f5f5f5;
            --border-color: #e0e0e0;
            --sidebar-width: 250px;
            --header-height: 60px;
            --shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #ffffff;
            color: var(--text-color);
            transition: all 0.3s ease;
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        /* Header Styles */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: var(--header-height);
            background-color: white;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            z-index: 1000;
        }

        .header-left {
            display: flex;
            align-items: center;
        }

        .menu-toggle {
            display: none;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            margin-right: 15px;
            color: var(--primary-color);
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-color);
        }

        .header-right {
            display: flex;
            align-items: center;
        }

        .language-selector {
            position: relative;
            margin-right: 15px;
        }

        .language-btn {
            display: flex;
            align-items: center;
            background: var(--light-gray);
            border: none;
            border-radius: 4px;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .language-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border-radius: 4px;
            box-shadow: var(--shadow);
            min-width: 150px;
            display: none;
            z-index: 1001;
        }

        .language-dropdown.show {
            display: block;
        }

        .language-option {
            display: flex;
            align-items: center;
            padding: 10px 15px;
            cursor: pointer;
            border-bottom: 1px solid var(--light-gray);
        }

        .language-option:last-child {
            border-bottom: none;
        }

        .language-option:hover, .language-option.active {
            background: var(--light-gray);
        }

        .language-option span:first-child {
            margin-right: 8px;
            font-size: 1.2rem;
        }

        /* Sidebar Styles */
        .sidebar {
            position: fixed;
            top: var(--header-height);
            left: 0;
            width: var(--sidebar-width);
            height: calc(100vh - var(--header-height));
            background-color: white;
            box-shadow: var(--shadow);
            padding: 20px 0;
            overflow-y: auto;
            transition: transform 0.3s ease;
            z-index: 999;
        }

        .nav-list {
            list-style: none;
        }

        .nav-item {
            margin-bottom: 5px;
        }

        .nav-btn {
            display: flex;
            align-items: center;
            width: 100%;
            padding: 12px 20px;
            background: none;
            border: none;
            text-align: left;
            cursor: pointer;
            font-size: 1rem;
            color: var(--text-color);
            transition: background-color 0.2s;
        }

        .nav-btn:hover {
            background-color: var(--light-gray);
        }

        .nav-btn.active {
            background-color: var(--primary-color);
            color: white;
        }

        .nav-btn i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }

        /* Main Content Styles */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            margin-top: var(--header-height);
            padding: 20px;
            transition: margin-left 0.3s ease;
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        .section-title {
            margin-bottom: 20px;
            color: var(--primary-color);
            font-size: 1.8rem;
        }

        .section-subtitle {
            margin-bottom: 30px;
            color: #666;
            font-size: 1rem;
        }

        /* Card Styles */
        .card {
            background: white;
            border-radius: 8px;
            box-shadow: var(--shadow);
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
        }

        .card-title {
            margin-bottom: 15px;
            font-size: 1.3rem;
            color: var(--primary-color);
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 1rem;
            background-color: white;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .form-row {
            display: flex;
            gap: 15px;
        }

        .form-col {
            flex: 1;
        }

        .form-radio-group {
            display: flex;
            gap: 15px;
            margin-bottom: 10px;
        }

        .form-radio {
            display: flex;
            align-items: center;
        }

        .form-radio input {
            margin-right: 5px;
        }

        .image-preview {
            max-width: 200px;
            max-height: 200px;
            margin-top: 10px;
            display: none;
            border: 1px solid var(--border-color);
        }

        .price-calculator {
            background: var(--light-gray);
            padding: 15px;
            border-radius: 4px;
            margin-top: 20px;
            border: 1px solid var(--border-color);
        }

        .price-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .price-label {
            font-weight: 500;
        }

        .price-value {
            font-weight: bold;
        }

        /* Button Styles */
        .btn {
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.2s;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: #1e4a8a;
        }

        .btn-secondary {
            background-color: var(--light-gray);
            color: var(--text-color);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background-color: #e0e0e0;
        }

        .btn-danger {
            background-color: var(--accent-color);
            color: white;
        }

        .btn-danger:hover {
            background-color: #c0392b;
        }

        .submit-btn {
            margin-top: 20px;
        }

        /* Table Styles */
        .table-container {
            overflow-x: auto;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .data-table th, .data-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .data-table th {
            background-color: var(--light-gray);
            font-weight: 600;
        }

        .data-table tr:hover {
            background-color: rgba(0, 0, 0, 0.02);
        }

        .table-image {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 4px;
            border: 1px solid var(--border-color);
        }

        .action-buttons {
            display: flex;
            gap: 5px;
        }

        .action-buttons .btn {
            padding: 5px 10px;
            font-size: 0.8rem;
        }

        /* Filter Section */
        .filter-section {
            background: white;
            border-radius: 8px;
            box-shadow: var(--shadow);
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
        }

        .filter-row {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 15px;
        }

        .filter-group {
            flex: 1;
            min-width: 150px;
        }

        .bulk-actions {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
        }

        /* Excel Upload Section */
        .excel-upload-section {
            background: white;
            border-radius: 8px;
            box-shadow: var(--shadow);
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
        }

        .upload-area {
            border: 2px dashed var(--border-color);
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            margin-bottom: 15px;
            cursor: pointer;
            transition: border-color 0.3s;
        }

        .upload-area:hover {
            border-color: var(--primary-color);
        }

        .upload-area.dragover {
            border-color: var(--primary-color);
            background-color: rgba(44, 90, 160, 0.05);
        }

        .upload-icon {
            font-size: 3rem;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .upload-text {
            margin-bottom: 15px;
        }

        .file-input {
            display: none;
        }

        .template-download {
            margin-top: 15px;
            text-align: center;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1100;
            overflow-y: auto;
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 20px;
            border-radius: 8px;
            width: 90%;
            max-width: 800px;
            position: relative;
            border: 1px solid var(--border-color);
        }

        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }

        .close-modal:hover {
            color: var(--accent-color);
        }

        /* Loading Styles */
        .loading {
            text-align: center;
            padding: 20px;
            font-style: italic;
            color: #666;
        }

        /* Book Details Grid */
        .book-details-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 5px;
        }

        .detail-item {
            display: flex;
        }

        .detail-label {
            font-weight: 500;
            margin-right: 5px;
            min-width: 100px;
        }

        .detail-value {
            color: #666;
        }

        /* Price Display */
        .price-display {
            display: flex;
            flex-direction: column;
        }

        .original-price {
            text-decoration: line-through;
            color: #999;
            font-size: 0.8rem;
        }

        .discounted-price {
            font-weight: bold;
            color: var(--primary-color);
        }

        .discount-badge {
            background: var(--accent-color);
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.7rem;
            margin-top: 3px;
            display: inline-block;
        }

        /* Responsive Styles */
        @media (max-width: 1024px) {
            .menu-toggle {
                display: block;
            }

            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .form-row {
                flex-direction: column;
                gap: 0;
            }
        }

        @media (max-width: 768px) {
            .filter-row {
                flex-direction: column;
            }

            .bulk-actions {
                flex-direction: column;
                align-items: flex-start;
            }

            .action-buttons {
                flex-direction: column;
            }
        }

        /* RTL Support */
        [dir="rtl"] .sidebar {
            left: auto;
            right: 0;
        }

        [dir="rtl"] .main-content {
            margin-left: 0;
            margin-right: var(--sidebar-width);
        }

        [dir="rtl"] .nav-btn i {
            margin-right: 0;
            margin-left: 10px;
        }

        [dir="rtl"] .language-option span:first-child {
            margin-right: 0;
            margin-left: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <button class="menu-toggle" id="menuToggle">‚ò∞</button>
                <div class="logo" data-lang-key="dashboard-title">Panel Admin - Toko Buku Islam</div>
            </div>
            <div class="header-right">
                <div class="language-selector">
                    <button class="language-btn" id="languageBtn">
                        <span id="currentLangFlag">üáÆüá©</span>
                        <span id="currentLangText">Indonesia</span>
                    </button>
                    <div class="language-dropdown" id="languageDropdown">
                        <div class="language-option active" data-lang="id">
                            <span>üáÆüá©</span>
                            <span>Indonesia</span>
                        </div>
                        <div class="language-option" data-lang="en">
                            <span>üá∫üá∏</span>
                            <span>English</span>
                        </div>
                        <div class="language-option" data-lang="ar">
                            <span>üá∏üá¶</span>
                            <span>ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</span>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Sidebar -->
        <nav class="sidebar" id="sidebar">
            <ul class="nav-list">
                <li class="nav-item">
                    <button class="nav-btn active" data-section="books">
                        <i>üìö</i>
                        <span data-lang-key="menu-books">Buku</span>
                    </button>
                </li>
                <li class="nav-item">
                    <button class="nav-btn" data-section="publishers">
                        <i>üè¢</i>
                        <span data-lang-key="menu-publishers">Penerbit</span>
                    </button>
                </li>
                <li class="nav-item">
                    <button class="nav-btn" data-section="categories">
                        <i>üìÇ</i>
                        <span data-lang-key="menu-categories">Kategori</span>
                    </button>
                </li>
                <li class="nav-item">
                    <button class="nav-btn" data-section="banners">
                        <i>üñºÔ∏è</i>
                        <span data-lang-key="menu-banners">Banner</span>
                    </button>
                </li>
                <li class="nav-item">
                    <button class="nav-btn" data-section="orders">
                        <i>üì¶</i>
                        <span data-lang-key="menu-orders">Pesanan</span>
                    </button>
                </li>
                <li class="nav-item">
                    <button class="nav-btn" data-section="currency">
                        <i>üí±</i>
                        <span data-lang-key="menu-currency">Kurs</span>
                    </button>
                </li>
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Books Section -->
            <section id="books-section" class="content-section active">
                <h1 class="section-title" data-lang-key="dashboard-title">Panel Admin - Toko Buku Islam</h1>
                <p class="section-subtitle" data-lang-key="dashboard-subtitle">Kelola data buku, penerbit, kategori, dan banner dengan mudah</p>
                
                <!-- Excel Upload Section -->
                <div class="excel-upload-section">
                    <h2 class="card-title">Upload Data Buku dari Excel</h2>
                    <div class="upload-area" id="uploadArea">
                        <div class="upload-icon">üì§</div>
                        <div class="upload-text">
                            <p>Seret file Excel ke sini atau klik untuk memilih file</p>
                            <p><small>Format yang didukung: .xlsx, .xls, .csv</small></p>
                        </div>
                        <input type="file" id="excelFileInput" class="file-input" accept=".xlsx,.xls,.csv">
                        <button class="btn btn-secondary" id="browseFilesBtn">Pilih File</button>
                    </div>
                    <div id="uploadStatus"></div>
                    <div class="template-download">
                        <p>Download template Excel untuk mengisi data buku:</p>
                        <button class="btn btn-primary" id="downloadTemplateBtn">Download Template</button>
                    </div>
                </div>
                
                <!-- Add Book Form -->
                <div class="card">
                    <h2 class="card-title" id="booksFormTitle" data-lang-key="add-book-title">Tambah Buku Baru</h2>
                    <form id="bookForm">
                        <input type="hidden" id="bookId">
                        <input type="hidden" id="bookOldCoverUrl">
                        
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="form-label" for="bookTitle" data-lang-key="book-title">Judul Buku</label>
                                    <input type="text" id="bookTitle" class="form-control" placeholder="Masukkan judul buku" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="bookAuthor" data-lang-key="book-author">Penulis</label>
                                    <input type="text" id="bookAuthor" class="form-control" placeholder="Nama penulis" required>
                                </div>
                                <div class="form-row">
                                    <div class="form-col">
                                        <div class="form-group">
                                            <label class="form-label" for="bookOriginalPrice" data-lang-key="book-original-price">Harga Asli (USD)</label>
                                            <input type="number" id="bookOriginalPrice" class="form-control" placeholder="0.00" step="0.01" min="0">
                                        </div>
                                    </div>
                                    <div class="form-col">
                                        <div class="form-group">
                                            <label class="form-label" for="bookBasePrice" data-lang-key="book-base-price">Harga Dasar (USD)</label>
                                            <input type="number" id="bookBasePrice" class="form-control" placeholder="0.00" step="0.01" min="0" required>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-col">
                                        <div class="form-group">
                                            <label class="form-label" for="bookPublisherSelect" data-lang-key="book-publisher">Penerbit</label>
                                            <select id="bookPublisherSelect" class="form-control">
                                                <option value="">-- Pilih Penerbit --</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-col">
                                        <div class="form-group">
                                            <label class="form-label" for="bookCategorySelect" data-lang-key="book-category">Kategori</label>
                                            <select id="bookCategorySelect" class="form-control">
                                                <option value="">-- Pilih Kategori --</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="bookDiscount" data-lang-key="book-discount">Diskon</label>
                                    <input type="text" id="bookDiscount" class="form-control" placeholder="Contoh: 10%">
                                </div>
                            </div>
                            
                            <div class="form-col">
                                <div class="form-row">
                                    <div class="form-col">
                                        <div class="form-group">
                                            <label class="form-label" for="bookVolumes" data-lang-key="book-volumes">Jilid</label>
                                            <input type="number" id="bookVolumes" class="form-control" placeholder="Jumlah jilid" min="1">
                                        </div>
                                    </div>
                                    <div class="form-col">
                                        <div class="form-group">
                                            <label class="form-label" for="bookPages" data-lang-key="book-pages">Halaman</label>
                                            <input type="number" id="bookPages" class="form-control" placeholder="Jumlah halaman" min="1">
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="bookYear" data-lang-key="book-year">Tahun Terbit</label>
                                    <input type="number" id="bookYear" class="form-control" placeholder="Tahun terbit" min="1000" max="2099">
                                </div>
                                <div class="form-row">
                                    <div class="form-col">
                                        <div class="form-group">
                                            <label class="form-label" for="bookWeightValue" data-lang-key="book-weight">Berat Buku</label>
                                            <input type="number" id="bookWeightValue" class="form-control" placeholder="Nilai berat" step="0.01" min="0">
                                        </div>
                                    </div>
                                    <div class="form-col">
                                        <div class="form-group">
                                            <label class="form-label" for="bookWeightUnit">Satuan</label>
                                            <select id="bookWeightUnit" class="form-control">
                                                <option value="g">Gram</option>
                                                <option value="kg">Kilogram</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="form-label" data-lang-key="book-text-color">Warna Tulisan</label>
                                    <select id="bookTextColorSelect" class="form-control">
                                        <option value="">-- Pilih Warna --</option>
                                        <option value="Hitam">Hitam</option>
                                        <option value="Putih">Putih</option>
                                        <option value="Emas">Emas</option>
                                        <option value="Perak">Perak</option>
                                    </select>
                                    <input type="text" id="bookTextColorInput" class="form-control" style="margin-top: 5px;" placeholder="Ketik manual">
                                </div>
                            </div>
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="form-label" data-lang-key="book-cover-type">Jenis Cover</label>
                                    <select id="bookCoverTypeSelect" class="form-control">
                                        <option value="">-- Pilih Jenis --</option>
                                        <option value="Hard Cover">Hard Cover</option>
                                        <option value="Soft Cover">Soft Cover</option>
                                        <option value="Spiral">Spiral</option>
                                    </select>
                                    <input type="text" id="bookCoverTypeInput" class="form-control" style="margin-top: 5px;" placeholder="Ketik manual">
                                </div>
                            </div>
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="form-label" data-lang-key="book-paper-type">Jenis Kertas</label>
                                    <select id="bookPaperTypeSelect" class="form-control">
                                        <option value="">-- Pilih Jenis --</option>
                                        <option value="HVS">HVS</option>
                                        <option value="Art Paper">Art Paper</option>
                                        <option value="Book Paper">Book Paper</option>
                                    </select>
                                    <input type="text" id="bookPaperTypeInput" class="form-control" style="margin-top: 5px;" placeholder="Ketik manual">
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="form-label" for="bookPrintCount" data-lang-key="book-print-count">Cetakan Ke</label>
                                    <input type="number" id="bookPrintCount" class="form-control" placeholder="Angka cetakan" min="1">
                                </div>
                            </div>
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="form-label" for="bookEditor" data-lang-key="book-editor">Editor</label>
                                    <input type="text" id="bookEditor" class="form-control" placeholder="Nama editor">
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="bookDescription" data-lang-key="book-description">Deskripsi Buku</label>
                            <textarea id="bookDescription" class="form-control" rows="4" placeholder="Deskripsi lengkap buku"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" data-lang-key="book-cover">Sampul Buku</label>
                            <div class="form-radio-group">
                                <div class="form-radio">
                                    <input type="radio" id="bookImageUpload" name="bookImageSource" value="upload" checked>
                                    <label for="bookImageUpload" data-lang-key="upload-file">Unggah File</label>
                                </div>
                                <div class="form-radio">
                                    <input type="radio" id="bookImageUrl" name="bookImageSource" value="url">
                                    <label for="bookImageUrl" data-lang-key="use-url">Gunakan URL</label>
                                </div>
                            </div>
                            
                            <div id="bookCoverImageFile">
                                <input type="file" id="bookCoverImageFileInput" class="form-control" accept="image/*">
                            </div>
                            <div id="bookCoverImageUrl" style="display: none;">
                                <input type="url" id="bookCoverImageUrlInput" class="form-control" placeholder="Masukkan URL gambar">
                            </div>
                            
                            <img id="bookImagePreview" class="image-preview" alt="Preview">
                        </div>
                        
                        <!-- Price Calculator -->
                        <div class="price-calculator">
                            <h3 data-lang-key="price-calculator">Kalkulator Harga Setelah Diskon</h3>
                            <div class="price-row">
                                <span class="price-label" data-lang-key="base-price-usd">Harga Dasar (USD):</span>
                                <span class="price-value" id="displayBasePriceUSD">$0.00</span>
                            </div>
                            <div class="price-row">
                                <span class="price-label" data-lang-key="discount">Diskon:</span>
                                <span class="price-value" id="displayDiscountPercent">0%</span>
                            </div>
                            <div class="price-row">
                                <span class="price-label" data-lang-key="final-price-usd">Harga Setelah Diskon (USD):</span>
                                <span class="price-value" id="displayFinalPriceUSD">$0.00</span>
                            </div>
                            <div class="price-row">
                                <span class="price-label" data-lang-key="final-price-idr">Harga Setelah Diskon (IDR):</span>
                                <span class="price-value" id="displayFinalPriceIDR">Rp 0</span>
                            </div>
                            <div class="price-row">
                                <span class="price-label" data-lang-key="final-price-egp">Harga Setelah Diskon (EGP):</span>
                                <span class="price-value" id="displayFinalPriceEGP">E¬£ 0</span>
                            </div>
                        </div>
                        
                        <button type="submit" class="btn btn-primary submit-btn" data-lang-key="save-book">Simpan Buku</button>
                        <button type="button" class="btn btn-secondary" id="cancelEditBook" style="display: none;" data-lang-key="cancel-edit">Batal Edit</button>
                    </form>
                </div>
                
                <!-- Filter and Search -->
                <div class="filter-section">
                    <h3 data-lang-key="filter-search">Filter dan Pencarian Buku</h3>
                    <div class="filter-row">
                        <div class="filter-group">
                            <input type="text" id="searchTitle" class="form-control" placeholder="Kata kunci judul..." data-lang-key="search-title">
                        </div>
                        <div class="filter-group">
                            <input type="text" id="searchAuthor" class="form-control" placeholder="Nama penulis..." data-lang-key="search-author">
                        </div>
                        <div class="filter-group">
                            <select id="filterPublisher" class="form-control" data-lang-key="filter-publisher">
                                <option value="">Semua Penerbit</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <select id="filterCategory" class="form-control" data-lang-key="filter-category">
                                <option value="">Semua Kategori</option>
                            </select>
                        </div>
                    </div>
                    <div class="filter-row">
                        <div class="filter-group">
                            <input type="text" id="filterCoverType" class="form-control" placeholder="Jenis cover..." data-lang-key="filter-cover-type">
                        </div>
                        <div class="filter-group">
                            <input type="text" id="filterPaperType" class="form-control" placeholder="Jenis kertas..." data-lang-key="filter-paper-type">
                        </div>
                        <div class="filter-group">
                            <button class="btn btn-primary" id="applyFilter" data-lang-key="apply-filter">Terapkan Filter</button>
                            <button class="btn btn-secondary" id="resetFilter" data-lang-key="reset-filter">Reset Filter</button>
                        </div>
                    </div>
                    
                    <!-- Bulk Actions -->
                    <div class="bulk-actions">
                        <span data-lang-key="bulk-actions">Aksi Massal:</span>
                        <select id="bulkAction" class="form-control" style="width: auto;">
                            <option value="" data-lang-key="select-action">Pilih Aksi</option>
                            <option value="delete" data-lang-key="delete-books">Hapus Buku</option>
                        </select>
                        <button class="btn btn-primary" id="applyBulkAction" data-lang-key="apply">Terapkan</button>
                        <span id="selectedCount">0 buku terpilih</span>
                        <input type="checkbox" id="selectAllCheckbox">
                        <label for="selectAllCheckbox">Pilih Semua</label>
                    </div>
                </div>
                
                <!-- Books List -->
                <div class="card">
                    <h2 class="card-title" data-lang-key="book-list">Daftar Buku</h2>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th><input type="checkbox" id="selectAllCheckboxHeader"></th>
                                    <th data-lang-key="table-image">Gambar</th>
                                    <th data-lang-key="table-book-info">Informasi Buku</th>
                                    <th data-lang-key="table-details">Detail</th>
                                    <th data-lang-key="table-weight">Berat</th>
                                    <th data-lang-key="table-price-usd">Harga USD</th>
                                    <th data-lang-key="table-price-idr">Harga IDR</th>
                                    <th data-lang-key="table-price-egp">Harga EGP</th>
                                    <th data-lang-key="table-discount">Diskon</th>
                                    <th data-lang-key="table-actions">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="booksTableBody">
                                <tr>
                                    <td colspan="10" class="loading" id="loadingBooks" data-lang-key="loading-books">Memuat data buku...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Publishers Section -->
            <section id="publishers-section" class="content-section">
                <h1 class="section-title" data-lang-key="menu-publishers">Penerbit</h1>
                
                <!-- Add Publisher Form -->
                <div class="card">
                    <h2 class="card-title" id="publishersFormTitle" data-lang-key="add-publisher-title">Tambah Penerbit Baru</h2>
                    <form id="publisherForm">
                        <input type="hidden" id="publisherId">
                        <input type="hidden" id="publisherOldLogoUrl">
                        
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="form-label" for="publisherName" data-lang-key="publisher-name">Nama Penerbit</label>
                                    <input type="text" id="publisherName" class="form-control" placeholder="Nama penerbit" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="publisherLetter" data-lang-key="publisher-letter">Huruf</label>
                                    <input type="text" id="publisherLetter" class="form-control" placeholder="Huruf penerbit" maxlength="1">
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="publisherDiscount" data-lang-key="publisher-discount">Diskon</label>
                                    <input type="text" id="publisherDiscount" class="form-control" placeholder="Contoh: 10%">
                                </div>
                            </div>
                            
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="form-label" data-lang-key="publisher-logo">Logo Penerbit</label>
                                    <input type="file" id="publisherLogoFile" class="form-control" accept="image/*">
                                    <img id="publisherImagePreview" class="image-preview" alt="Preview">
                                </div>
                            </div>
                        </div>
                        
                        <button type="submit" class="btn btn-primary submit-btn" data-lang-key="save-publisher">Simpan Penerbit</button>
                        <button type="button" class="btn btn-secondary" id="cancelEditPublisher" style="display: none;" data-lang-key="cancel-edit">Batal Edit</button>
                    </form>
                </div>
                
                <!-- Publishers List -->
                <div class="card">
                    <h2 class="card-title" data-lang-key="publisher-list">Daftar Penerbit</h2>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th data-lang-key="table-logo">Logo</th>
                                    <th data-lang-key="table-name">Nama</th>
                                    <th data-lang-key="table-letter">Huruf</th>
                                    <th data-lang-key="table-discount">Diskon</th>
                                    <th data-lang-key="table-actions">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="publishersTableBody">
                                <tr>
                                    <td colspan="5" class="loading" id="loadingPublishers" data-lang-key="loading-publishers">Memuat data penerbit...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Categories Section -->
            <section id="categories-section" class="content-section">
                <h1 class="section-title" data-lang-key="menu-categories">Kategori</h1>
                
                <!-- Add Category Form -->
                <div class="card">
                    <h2 class="card-title" id="categoriesFormTitle" data-lang-key="add-category-title">Tambah Kategori Baru</h2>
                    <form id="categoryForm">
                        <input type="hidden" id="categoryId">
                        <input type="hidden" id="categoryOldImageUrl">
                        
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="form-label" for="categoryNameId" data-lang-key="category-name-id">Nama (ID)</label>
                                    <input type="text" id="categoryNameId" class="form-control" placeholder="Nama dalam Bahasa Indonesia" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="categoryNameEn" data-lang-key="category-name-en">Nama (EN)</label>
                                    <input type="text" id="categoryNameEn" class="form-control" placeholder="Nama dalam Bahasa Inggris">
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="categoryNameAr" data-lang-key="category-name-ar">Nama (AR)</label>
                                    <input type="text" id="categoryNameAr" class="form-control" placeholder="Nama dalam Bahasa Arab">
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="categoryColor" data-lang-key="category-color">Warna</label>
                                    <input type="color" id="categoryColor" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="categoryLink" data-lang-key="category-link">Link Kategori</label>
                                    <input type="text" id="categoryLink" class="form-control" placeholder="Link kategori">
                                </div>
                            </div>
                            
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="form-label" data-lang-key="category-image">Gambar Kategori</label>
                                    <input type="file" id="categoryImageFile" class="form-control" accept="image/*">
                                    <img id="categoryImagePreview" class="image-preview" alt="Preview">
                                </div>
                            </div>
                        </div>
                        
                        <button type="submit" class="btn btn-primary submit-btn" data-lang-key="save-category">Simpan Kategori</button>
                        <button type="button" class="btn btn-secondary" id="cancelEditCategory" style="display: none;" data-lang-key="cancel-edit">Batal Edit</button>
                    </form>
                </div>
                
                <!-- Categories List -->
                <div class="card">
                    <h2 class="card-title" data-lang-key="category-list">Daftar Kategori</h2>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th data-lang-key="table-image">Gambar</th>
                                    <th data-lang-key="table-name-id">Nama (ID)</th>
                                    <th data-lang-key="table-name-en">Nama (EN)</th>
                                    <th data-lang-key="table-color">Warna</th>
                                    <th data-lang-key="table-link">Link</th>
                                    <th data-lang-key="table-actions">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="categoriesTableBody">
                                <tr>
                                    <td colspan="6" class="loading" id="loadingCategories" data-lang-key="loading-categories">Memuat data kategori...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Banners Section -->
            <section id="banners-section" class="content-section">
                <h1 class="section-title" data-lang-key="menu-banners">Banner</h1>
                
                <!-- Add Banner Form -->
                <div class="card">
                    <h2 class="card-title" id="bannersFormTitle" data-lang-key="add-banner-title">Tambah Banner Baru</h2>
                    <form id="bannerForm">
                        <input type="hidden" id="bannerId">
                        <input type="hidden" id="bannerOldImageUrl">
                        
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="form-label" for="bannerTitle" data-lang-key="banner-title">Judul Banner</label>
                                    <input type="text" id="bannerTitle" class="form-control" placeholder="Judul banner" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="bannerType" data-lang-key="banner-type">Tipe</label>
                                    <input type="text" id="bannerType" class="form-control" placeholder="Contoh: promo, utama">
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="bannerDisplayOrder" data-lang-key="banner-order">Urutan Tampil</label>
                                    <input type="number" id="bannerDisplayOrder" class="form-control" placeholder="Angka urutan" min="0">
                                </div>
                            </div>
                            
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="form-label" data-lang-key="banner-image">Gambar Banner</label>
                                    <input type="file" id="bannerImageFile" class="form-control" accept="image/*">
                                    <img id="bannerImagePreview" class="image-preview" alt="Preview">
                                </div>
                            </div>
                        </div>
                        
                        <button type="submit" class="btn btn-primary submit-btn" data-lang-key="save-banner">Simpan Banner</button>
                        <button type="button" class="btn btn-secondary" id="cancelEditBanner" style="display: none;" data-lang-key="cancel-edit">Batal Edit</button>
                    </form>
                </div>
                
                <!-- Banners List -->
                <div class="card">
                    <h2 class="card-title" data-lang-key="banner-list">Daftar Banner</h2>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th data-lang-key="table-image">Gambar</th>
                                    <th data-lang-key="table-title">Judul</th>
                                    <th data-lang-key="table-type">Tipe</th>
                                    <th data-lang-key="table-order">Urutan</th>
                                    <th data-lang-key="table-actions">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="bannersTableBody">
                                <tr>
                                    <td colspan="5" class="loading" id="loadingBanners" data-lang-key="loading-banners">Memuat data banner...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Orders Section -->
            <section id="orders-section" class="content-section">
                <h1 class="section-title" data-lang-key="menu-orders">Pesanan</h1>
                
                <!-- Orders List -->
                <div class="card">
                    <h2 class="card-title" data-lang-key="order-list">Daftar Pesanan</h2>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th data-lang-key="table-customer-name">Nama Pelanggan</th>
                                    <th data-lang-key="table-book">Buku</th>
                                    <th>Total (USD)</th>
                                    <th data-lang-key="table-status">Status</th>
                                    <th data-lang-key="table-date">Tanggal</th>
                                </tr>
                            </thead>
                            <tbody id="ordersTableBody">
                                <tr>
                                    <td colspan="5" class="loading" id="loadingOrders" data-lang-key="loading-orders">Memuat data pesanan...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Currency Section -->
            <section id="currency-section" class="content-section">
                <h1 class="section-title" data-lang-key="menu-currency">Kurs</h1>
                
                <!-- Currency Settings -->
                <div class="card">
                    <h2 class="card-title" data-lang-key="currency-settings">Pengaturan Kurs Mata Uang</h2>
                    <p data-lang-key="currency-description">Harga dasar produk disimpan dalam USD. Atur kurs di sini untuk mengonversi harga saat ditampilkan.</p>
                    
                    <form id="currencyForm">
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="form-label" for="usdToIdr" data-lang-key="usd-to-idr">USD ke IDR</label>
                                    <input type="number" id="usdToIdr" class="form-control" placeholder="Kurs USD ke Rupiah" step="0.01" min="0" required>
                                </div>
                            </div>
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="form-label" for="usdToEgp" data-lang-key="usd-to-egp">USD ke EGP</label>
                                    <input type="number" id="usdToEgp" class="form-control" placeholder="Kurs USD ke Pound Mesir" step="0.01" min="0" required>
                                </div>
                            </div>
                        </div>
                        
                        <button type="submit" class="btn btn-primary submit-btn" data-lang-key="save-settings">Simpan Pengaturan</button>
                    </form>
                </div>
            </section>
        </main>
    </div>

    <!-- Edit Book Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2 data-lang-key="edit-book-title">Edit Buku - Semua Data</h2>
            <form id="editBookForm">
                <input type="hidden" id="editBookId">
                <input type="hidden" id="editBookOldCoverUrl">
                
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label class="form-label" for="editBookTitle" data-lang-key="book-title">Judul Buku</label>
                            <input type="text" id="editBookTitle" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="editBookAuthor" data-lang-key="book-author">Penulis</label>
                            <input type="text" id="editBookAuthor" class="form-control" required>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="form-label" for="editBookOriginalPrice" data-lang-key="book-original-price">Harga Asli (USD)</label>
                                    <input type="number" id="editBookOriginalPrice" class="form-control" step="0.01" min="0">
                                </div>
                            </div>
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="form-label" for="editBookBasePrice" data-lang-key="book-base-price">Harga Dasar (USD)</label>
                                    <input type="number" id="editBookBasePrice" class="form-control" step="0.01" min="0" required>
                                </div>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="form-label" for="editBookPublisherSelect" data-lang-key="book-publisher">Penerbit</label>
                                    <select id="editBookPublisherSelect" class="form-control">
                                        <option value="">-- Pilih Penerbit --</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="form-label" for="editBookCategorySelect" data-lang-key="book-category">Kategori</label>
                                    <select id="editBookCategorySelect" class="form-control">
                                        <option value="">-- Pilih Kategori --</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="editBookDiscount" data-lang-key="book-discount">Diskon</label>
                            <input type="text" id="editBookDiscount" class="form-control">
                        </div>
                    </div>
                    
                    <div class="form-col">
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="form-label" for="editBookVolumes" data-lang-key="book-volumes">Jilid</label>
                                    <input type="number" id="editBookVolumes" class="form-control" min="1">
                                </div>
                            </div>
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="form-label" for="editBookPages" data-lang-key="book-pages">Halaman</label>
                                    <input type="number" id="editBookPages" class="form-control" min="1">
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="editBookYear" data-lang-key="book-year">Tahun Terbit</label>
                            <input type="number" id="editBookYear" class="form-control" min="1000" max="2099">
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="form-label" for="editBookWeightValue" data-lang-key="book-weight">Berat Buku</label>
                                    <input type="number" id="editBookWeightValue" class="form-control" step="0.01" min="0">
                                </div>
                            </div>
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="form-label" for="editBookWeightUnit">Satuan</label>
                                    <select id="editBookWeightUnit" class="form-control">
                                        <option value="g">Gram</option>
                                        <option value="kg">Kilogram</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label class="form-label" data-lang-key="book-text-color">Warna Tulisan</label>
                            <select id="editBookTextColorSelect" class="form-control">
                                <option value="">-- Pilih Warna --</option>
                                <option value="Hitam">Hitam</option>
                                <option value="Putih">Putih</option>
                                <option value="Emas">Emas</option>
                                <option value="Perak">Perak</option>
                            </select>
                            <input type="text" id="editBookTextColorInput" class="form-control" style="margin-top: 5px;" placeholder="Ketik manual">
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label class="form-label" data-lang-key="book-cover-type">Jenis Cover</label>
                            <select id="editBookCoverTypeSelect" class="form-control">
                                <option value="">-- Pilih Jenis --</option>
                                <option value="Hard Cover">Hard Cover</option>
                                <option value="Soft Cover">Soft Cover</option>
                                <option value="Spiral">Spiral</option>
                            </select>
                            <input type="text" id="editBookCoverTypeInput" class="form-control" style="margin-top: 5px;" placeholder="Ketik manual">
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label class="form-label" data-lang-key="book-paper-type">Jenis Kertas</label>
                            <select id="editBookPaperTypeSelect" class="form-control">
                                <option value="">-- Pilih Jenis --</option>
                                <option value="HVS">HVS</option>
                                <option value="Art Paper">Art Paper</option>
                                <option value="Book Paper">Book Paper</option>
                            </select>
                            <input type="text" id="editBookPaperTypeInput" class="form-control" style="margin-top: 5px;" placeholder="Ketik manual">
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label class="form-label" for="editBookPrintCount" data-lang-key="book-print-count">Cetakan Ke</label>
                            <input type="number" id="editBookPrintCount" class="form-control" min="1">
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label class="form-label" for="editBookEditor" data-lang-key="book-editor">Editor</label>
                            <input type="text" id="editBookEditor" class="form-control">
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="editBookDescription" data-lang-key="book-description">Deskripsi Buku</label>
                    <textarea id="editBookDescription" class="form-control" rows="4"></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label" data-lang-key="book-cover">Sampul Buku</label>
                    <div class="form-radio-group">
                        <div class="form-radio">
                            <input type="radio" id="editBookImageUpload" name="editBookImageSource" value="upload" checked>
                            <label for="editBookImageUpload" data-lang-key="upload-file">Unggah File</label>
                        </div>
                        <div class="form-radio">
                            <input type="radio" id="editBookImageUrl" name="editBookImageSource" value="url">
                            <label for="editBookImageUrl" data-lang-key="use-url">Gunakan URL</label>
                        </div>
                    </div>
                    
                    <div id="editBookCoverImageFile">
                        <input type="file" id="editBookCoverImageFileInput" class="form-control" accept="image/*">
                    </div>
                    <div id="editBookCoverImageUrl" style="display: none;">
                        <input type="url" id="editBookCoverImageUrlInput" class="form-control" placeholder="Masukkan URL gambar">
                    </div>
                    
                    <img id="editBookImagePreview" class="image-preview" alt="Preview">
                </div>
                
                <!-- Price Calculator -->
                <div class="price-calculator">
                    <h3 data-lang-key="price-calculator">Kalkulator Harga Setelah Diskon</h3>
                    <div class="price-row">
                        <span class="price-label" data-lang-key="base-price-usd">Harga Dasar (USD):</span>
                        <span class="price-value" id="editDisplayBasePriceUSD">$0.00</span>
                    </div>
                    <div class="price-row">
                        <span class="price-label" data-lang-key="discount">Diskon:</span>
                        <span class="price-value" id="editDisplayDiscountPercent">0%</span>
                    </div>
                    <div class="price-row">
                        <span class="price-label" data-lang-key="final-price-usd">Harga Setelah Diskon (USD):</span>
                        <span class="price-value" id="editDisplayFinalPriceUSD">$0.00</span>
                    </div>
                    <div class="price-row">
                        <span class="price-label" data-lang-key="final-price-idr">Harga Setelah Diskon (IDR):</span>
                        <span class="price-value" id="editDisplayFinalPriceIDR">Rp 0</span>
                    </div>
                    <div class="price-row">
                        <span class="price-label" data-lang-key="final-price-egp">Harga Setelah Diskon (EGP):</span>
                        <span class="price-value" id="editDisplayFinalPriceEGP">E¬£ 0</span>
                    </div>
                </div>
                
                <button type="submit" class="btn btn-primary submit-btn" data-lang-key="update-book">Perbarui Buku</button>
                <button type="button" class="btn btn-secondary" id="cancelEditModal" data-lang-key="cancel">Batal</button>
            </form>
        </div>
    </div>

    <script>
        // Language translations
        const translations = {
            id: {
                "dashboard-title": "Panel Admin - Toko Buku Islam",
                "dashboard-subtitle": "Kelola data buku, penerbit, kategori, dan banner dengan mudah",
                "menu-books": "Buku",
                "menu-publishers": "Penerbit",
                "menu-categories": "Kategori",
                "menu-banners": "Banner",
                "menu-orders": "Pesanan",
                "menu-currency": "Kurs",
                "add-book-title": "Tambah Buku Baru",
                "book-title": "Judul Buku",
                "book-author": "Penulis",
                "book-original-price": "Harga Asli (USD)",
                "book-base-price": "Harga Dasar (USD)",
                "book-publisher": "Penerbit",
                "book-category": "Kategori",
                "book-discount": "Diskon",
                "book-volumes": "Jilid",
                "book-pages": "Halaman",
                "book-year": "Tahun Terbit",
                "book-weight": "Berat Buku",
                "book-text-color": "Warna Tulisan",
                "book-cover-type": "Jenis Cover",
                "book-paper-type": "Jenis Kertas",
                "book-print-count": "Cetakan Ke",
                "book-editor": "Editor",
                "book-description": "Deskripsi Buku",
                "book-cover": "Sampul Buku",
                "upload-file": "Unggah File",
                "use-url": "Gunakan URL",
                "save-book": "Simpan Buku",
                "cancel-edit": "Batal Edit",
                "price-calculator": "Kalkulator Harga Setelah Diskon",
                "base-price-usd": "Harga Dasar (USD):",
                "discount": "Diskon:",
                "final-price-usd": "Harga Setelah Diskon (USD):",
                "final-price-idr": "Harga Setelah Diskon (IDR):",
                "final-price-egp": "Harga Setelah Diskon (EGP):",
                "filter-search": "Filter dan Pencarian Buku",
                "search-title": "Cari Judul",
                "search-author": "Cari Penulis",
                "filter-publisher": "Penerbit",
                "filter-category": "Kategori",
                "filter-cover-type": "Jenis Cover",
                "filter-paper-type": "Jenis Kertas",
                "apply-filter": "Terapkan Filter",
                "reset-filter": "Reset Filter",
                "bulk-actions": "Aksi Massal:",
                "select-action": "Pilih Aksi",
                "delete-books": "Hapus Buku",
                "apply": "Terapkan",
                "book-list": "Daftar Buku",
                "table-image": "Gambar",
                "table-book-info": "Informasi Buku",
                "table-details": "Detail",
                "table-weight": "Berat",
                "table-price-usd": "Harga USD",
                "table-price-idr": "Harga IDR",
                "table-price-egp": "Harga EGP",
                "table-discount": "Diskon",
                "table-actions": "Aksi",
                "loading-books": "Memuat data buku...",
                "add-publisher-title": "Tambah Penerbit Baru",
                "publisher-name": "Nama Penerbit",
                "publisher-letter": "Huruf",
                "publisher-discount": "Diskon",
                "publisher-logo": "Logo Penerbit",
                "save-publisher": "Simpan Penerbit",
                "publisher-list": "Daftar Penerbit",
                "table-logo": "Logo",
                "table-name": "Nama",
                "table-letter": "Huruf",
                "loading-publishers": "Memuat data penerbit...",
                "add-category-title": "Tambah Kategori Baru",
                "category-name-id": "Nama (ID)",
                "category-name-en": "Nama (EN)",
                "category-name-ar": "Nama (AR)",
                "category-color": "Warna",
                "category-link": "Link Kategori",
                "category-image": "Gambar Kategori",
                "save-category": "Simpan Kategori",
                "category-list": "Daftar Kategori",
                "table-name-id": "Nama (ID)",
                "table-name-en": "Nama (EN)",
                "table-color": "Warna",
                "table-link": "Link",
                "loading-categories": "Memuat data kategori...",
                "add-banner-title": "Tambah Banner Baru",
                "banner-title": "Judul Banner",
                "banner-type": "Tipe",
                "banner-order": "Urutan Tampil",
                "banner-image": "Gambar Banner",
                "save-banner": "Simpan Banner",
                "banner-list": "Daftar Banner",
                "table-title": "Judul",
                "table-type": "Tipe",
                "table-order": "Urutan",
                "loading-banners": "Memuat data banner...",
                "order-list": "Daftar Pesanan",
                "table-customer-name": "Nama Pelanggan",
                "table-book": "Buku",
                "table-total-idr": "Total (IDR)",
                "table-status": "Status",
                "table-date": "Tanggal",
                "loading-orders": "Memuat data pesanan...",
                "currency-settings": "Pengaturan Kurs Mata Uang",
                "currency-description": "Harga dasar produk disimpan dalam USD. Atur kurs di sini untuk mengonversi harga saat ditampilkan.",
                "usd-to-idr": "USD ke IDR",
                "usd-to-egp": "USD ke EGP",
                "save-settings": "Simpan Pengaturan",
                "edit-book-title": "Edit Buku - Semua Data",
                "update-book": "Perbarui Buku",
                "cancel": "Batal"
            },
            en: {
                "dashboard-title": "Admin Panel - Islamic Book Store",
                "dashboard-subtitle": "Manage books, publishers, categories, and banners easily",
                "menu-books": "Books",
                "menu-publishers": "Publishers",
                "menu-categories": "Categories",
                "menu-banners": "Banners",
                "menu-orders": "Orders",
                "menu-currency": "Currency",
                "add-book-title": "Add New Book",
                "book-title": "Book Title",
                "book-author": "Author",
                "book-original-price": "Original Price (USD)",
                "book-base-price": "Base Price (USD)",
                "book-publisher": "Publisher",
                "book-category": "Category",
                "book-discount": "Discount",
                "book-volumes": "Volumes",
                "book-pages": "Pages",
                "book-year": "Publication Year",
                "book-weight": "Book Weight",
                "book-text-color": "Text Color",
                "book-cover-type": "Cover Type",
                "book-paper-type": "Paper Type",
                "book-print-count": "Print Edition",
                "book-editor": "Editor",
                "book-description": "Book Description",
                "book-cover": "Book Cover",
                "upload-file": "Upload File",
                "use-url": "Use URL",
                "save-book": "Save Book",
                "cancel-edit": "Cancel Edit",
                "price-calculator": "Price Calculator After Discount",
                "base-price-usd": "Base Price (USD):",
                "discount": "Discount:",
                "final-price-usd": "Final Price (USD):",
                "final-price-idr": "Final Price (IDR):",
                "final-price-egp": "Final Price (EGP):",
                "filter-search": "Filter and Search Books",
                "search-title": "Search Title",
                "search-author": "Search Author",
                "filter-publisher": "Publisher",
                "filter-category": "Category",
                "filter-cover-type": "Cover Type",
                "filter-paper-type": "Paper Type",
                "apply-filter": "Apply Filter",
                "reset-filter": "Reset Filter",
                "bulk-actions": "Bulk Actions:",
                "select-action": "Select Action",
                "delete-books": "Delete Books",
                "apply": "Apply",
                "book-list": "Book List",
                "table-image": "Image",
                "table-book-info": "Book Information",
                "table-details": "Details",
                "table-weight": "Weight",
                "table-price-usd": "Price USD",
                "table-price-idr": "Price IDR",
                "table-price-egp": "Price EGP",
                "table-discount": "Discount",
                "table-actions": "Actions",
                "loading-books": "Loading book data...",
                "add-publisher-title": "Add New Publisher",
                "publisher-name": "Publisher Name",
                "publisher-letter": "Letter",
                "publisher-discount": "Discount",
                "publisher-logo": "Publisher Logo",
                "save-publisher": "Save Publisher",
                "publisher-list": "Publisher List",
                "table-logo": "Logo",
                "table-name": "Name",
                "table-letter": "Letter",
                "loading-publishers": "Loading publisher data...",
                "add-category-title": "Add New Category",
                "category-name-id": "Name (ID)",
                "category-name-en": "Name (EN)",
                "category-name-ar": "Name (AR)",
                "category-color": "Color",
                "category-link": "Category Link",
                "category-image": "Category Image",
                "save-category": "Save Category",
                "category-list": "Category List",
                "table-name-id": "Name (ID)",
                "table-name-en": "Name (EN)",
                "table-color": "Color",
                "table-link": "Link",
                "loading-categories": "Loading category data...",
                "add-banner-title": "Add New Banner",
                "banner-title": "Banner Title",
                "banner-type": "Type",
                "banner-order": "Display Order",
                "banner-image": "Banner Image",
                "save-banner": "Save Banner",
                "banner-list": "Banner List",
                "table-title": "Title",
                "table-type": "Type",
                "table-order": "Order",
                "loading-banners": "Loading banner data...",
                "order-list": "Order List",
                "table-customer-name": "Customer Name",
                "table-book": "Book",
                "table-total-idr": "Total (IDR)",
                "table-status": "Status",
                "table-date": "Date",
                "loading-orders": "Loading order data...",
                "currency-settings": "Currency Rate Settings",
                "currency-description": "Product base prices are stored in USD. Set rates here to convert prices when displayed.",
                "usd-to-idr": "USD to IDR",
                "usd-to-egp": "USD to EGP",
                "save-settings": "Save Settings",
                "edit-book-title": "Edit Book - All Data",
                "update-book": "Update Book",
                "cancel": "Cancel"
            },
            ar: {
                "dashboard-title": "ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ - ŸÖŸÉÿ™ÿ®ÿ© ÿßŸÑŸÉÿ™ÿ® ÿßŸÑÿ•ÿ≥ŸÑÿßŸÖŸäÿ©",
                "dashboard-subtitle": "ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÉÿ™ÿ® ŸàÿßŸÑŸÜÿßÿ¥ÿ±ŸäŸÜ ŸàÿßŸÑŸÅÿ¶ÿßÿ™ ŸàÿßŸÑŸÑÿßŸÅÿ™ÿßÿ™ ÿ®ÿ≥ŸáŸàŸÑÿ©",
                "menu-books": "ÿßŸÑŸÉÿ™ÿ®",
                "menu-publishers": "ÿßŸÑŸÜÿßÿ¥ÿ±ŸàŸÜ",
                "menu-categories": "ÿßŸÑŸÅÿ¶ÿßÿ™",
                "menu-banners": "ÿßŸÑŸÑÿßŸÅÿ™ÿßÿ™",
                "menu-orders": "ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™",
                "menu-currency": "ÿßŸÑÿπŸÖŸÑÿ©",
                "add-book-title": "ÿ•ÿ∂ÿßŸÅÿ© ŸÉÿ™ÿßÿ® ÿ¨ÿØŸäÿØ",
                "book-title": "ÿπŸÜŸàÿßŸÜ ÿßŸÑŸÉÿ™ÿßÿ®",
                "book-author": "ÿßŸÑŸÖÿ§ŸÑŸÅ",
                "book-original-price": "ÿßŸÑÿ≥ÿπÿ± ÿßŸÑÿ£ÿµŸÑŸä (ÿØŸàŸÑÿßÿ± ÿ£ŸÖÿ±ŸäŸÉŸä)",
                "book-base-price": "ÿßŸÑÿ≥ÿπÿ± ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿä (ÿØŸàŸÑÿßÿ± ÿ£ŸÖÿ±ŸäŸÉŸä)",
                "book-publisher": "ÿßŸÑŸÜÿßÿ¥ÿ±",
                "book-category": "ÿßŸÑŸÅÿ¶ÿ©",
                "book-discount": "ÿÆÿµŸÖ",
                "book-volumes": "ÿßŸÑŸÖÿ¨ŸÑÿØÿßÿ™",
                "book-pages": "ÿßŸÑÿµŸÅÿ≠ÿßÿ™",
                "book-year": "ÿ≥ŸÜÿ© ÿßŸÑŸÜÿ¥ÿ±",
                "book-weight": "Ÿàÿ≤ŸÜ ÿßŸÑŸÉÿ™ÿßÿ®",
                "book-text-color": "ŸÑŸàŸÜ ÿßŸÑŸÜÿµ",
                "book-cover-type": "ŸÜŸàÿπ ÿßŸÑÿ∫ŸÑÿßŸÅ",
                "book-paper-type": "ŸÜŸàÿπ ÿßŸÑŸàÿ±ŸÇ",
                "book-print-count": "ÿ∑ÿ®ÿπÿ©",
                "book-editor": "ÿßŸÑŸÖÿ≠ÿ±ÿ±",
                "book-description": "ŸàÿµŸÅ ÿßŸÑŸÉÿ™ÿßÿ®",
                "book-cover": "ÿ∫ŸÑÿßŸÅ ÿßŸÑŸÉÿ™ÿßÿ®",
                "upload-file": "ÿ±ŸÅÿπ ŸÖŸÑŸÅ",
                "use-url": "ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑÿ±ÿßÿ®ÿ∑",
                "save-book": "ÿ≠ŸÅÿ∏ ÿßŸÑŸÉÿ™ÿßÿ®",
                "cancel-edit": "ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑÿ™ÿπÿØŸäŸÑ",
                "price-calculator": "ÿ≠ÿßÿ≥ÿ®ÿ© ÿßŸÑÿ≥ÿπÿ± ÿ®ÿπÿØ ÿßŸÑÿÆÿµŸÖ",
                "base-price-usd": "ÿßŸÑÿ≥ÿπÿ± ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿä (ÿØŸàŸÑÿßÿ± ÿ£ŸÖÿ±ŸäŸÉŸä):",
                "discount": "ÿÆÿµŸÖ:",
                "final-price-usd": "ÿßŸÑÿ≥ÿπÿ± ÿßŸÑŸÜŸáÿßÿ¶Ÿä (ÿØŸàŸÑÿßÿ± ÿ£ŸÖÿ±ŸäŸÉŸä):",
                "final-price-idr": "ÿßŸÑÿ≥ÿπÿ± ÿßŸÑŸÜŸáÿßÿ¶Ÿä (ÿ±Ÿàÿ®Ÿäÿ© ÿ•ŸÜÿØŸàŸÜŸäÿ≥Ÿäÿ©):",
                "final-price-egp": "ÿßŸÑÿ≥ÿπÿ± ÿßŸÑŸÜŸáÿßÿ¶Ÿä (ÿ¨ŸÜŸäŸá ŸÖÿµÿ±Ÿä):",
                "filter-search": "ÿ™ÿµŸÅŸäÿ© Ÿàÿ®ÿ≠ÿ´ ÿßŸÑŸÉÿ™ÿ®",
                "search-title": "ÿ®ÿ≠ÿ´ ÿßŸÑÿπŸÜŸàÿßŸÜ",
                "search-author": "ÿ®ÿ≠ÿ´ ÿßŸÑŸÖÿ§ŸÑŸÅ",
                "filter-publisher": "ÿßŸÑŸÜÿßÿ¥ÿ±",
                "filter-category": "ÿßŸÑŸÅÿ¶ÿ©",
                "filter-cover-type": "ŸÜŸàÿπ ÿßŸÑÿ∫ŸÑÿßŸÅ",
                "filter-paper-type": "ŸÜŸàÿπ ÿßŸÑŸàÿ±ŸÇ",
                "apply-filter": "ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ™ÿµŸÅŸäÿ©",
                "reset-filter": "ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿßŸÑÿ™ÿµŸÅŸäÿ©",
                "bulk-actions": "ÿ•ÿ¨ÿ±ÿßÿ°ÿßÿ™ ÿ¨ŸÖÿßÿπŸäÿ©:",
                "select-action": "ÿßÿÆÿ™ÿ± ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°",
                "delete-books": "ÿ≠ÿ∞ŸÅ ÿßŸÑŸÉÿ™ÿ®",
                "apply": "ÿ™ÿ∑ÿ®ŸäŸÇ",
                "book-list": "ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÉÿ™ÿ®",
                "table-image": "ÿßŸÑÿµŸàÿ±ÿ©",
                "table-book-info": "ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑŸÉÿ™ÿßÿ®",
                "table-details": "ÿßŸÑÿ™ŸÅÿßÿµŸäŸÑ",
                "table-weight": "ÿßŸÑŸàÿ≤ŸÜ",
                "table-price-usd": "ÿßŸÑÿ≥ÿπÿ± ÿØŸàŸÑÿßÿ± ÿ£ŸÖÿ±ŸäŸÉŸä",
                "table-price-idr": "ÿßŸÑÿ≥ÿπÿ± ÿ±Ÿàÿ®Ÿäÿ© ÿ•ŸÜÿØŸàŸÜŸäÿ≥Ÿäÿ©",
                "table-price-egp": "ÿßŸÑÿ≥ÿπÿ± ÿ¨ŸÜŸäŸá ŸÖÿµÿ±Ÿä",
                "table-discount": "ÿÆÿµŸÖ",
                "table-actions": "ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°ÿßÿ™",
                "loading-books": "ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÉÿ™ÿ®...",
                "add-publisher-title": "ÿ•ÿ∂ÿßŸÅÿ© ŸÜÿßÿ¥ÿ± ÿ¨ÿØŸäÿØ",
                "publisher-name": "ÿßÿ≥ŸÖ ÿßŸÑŸÜÿßÿ¥ÿ±",
                "publisher-letter": "ÿßŸÑÿ≠ÿ±ŸÅ",
                "publisher-discount": "ÿÆÿµŸÖ",
                "publisher-logo": "ÿ¥ÿπÿßÿ± ÿßŸÑŸÜÿßÿ¥ÿ±",
                "save-publisher": "ÿ≠ŸÅÿ∏ ÿßŸÑŸÜÿßÿ¥ÿ±",
                "publisher-list": "ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÜÿßÿ¥ÿ±ŸäŸÜ",
                "table-logo": "ÿßŸÑÿ¥ÿπÿßÿ±",
                "table-name": "ÿßŸÑÿßÿ≥ŸÖ",
                "table-letter": "ÿßŸÑÿ≠ÿ±ŸÅ",
                "loading-publishers": "ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÜÿßÿ¥ÿ±ŸäŸÜ...",
                "add-category-title": "ÿ•ÿ∂ÿßŸÅÿ© ŸÅÿ¶ÿ© ÿ¨ÿØŸäÿØÿ©",
                "category-name-id": "ÿßŸÑÿßÿ≥ŸÖ (ID)",
                "category-name-en": "ÿßŸÑÿßÿ≥ŸÖ (EN)",
                "category-name-ar": "ÿßŸÑÿßÿ≥ŸÖ (AR)",
                "category-color": "ÿßŸÑŸÑŸàŸÜ",
                "category-link": "ÿ±ÿßÿ®ÿ∑ ÿßŸÑŸÅÿ¶ÿ©",
                "category-image": "ÿµŸàÿ±ÿ© ÿßŸÑŸÅÿ¶ÿ©",
                "save-category": "ÿ≠ŸÅÿ∏ ÿßŸÑŸÅÿ¶ÿ©",
                "category-list": "ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÅÿ¶ÿßÿ™",
                "table-name-id": "ÿßŸÑÿßÿ≥ŸÖ (ID)",
                "table-name-en": "ÿßŸÑÿßÿ≥ŸÖ (EN)",
                "table-color": "ÿßŸÑŸÑŸàŸÜ",
                "table-link": "ÿßŸÑÿ±ÿßÿ®ÿ∑",
                "loading-categories": "ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÅÿ¶ÿßÿ™...",
                "add-banner-title": "ÿ•ÿ∂ÿßŸÅÿ© ŸÑÿßŸÅÿ™ÿ© ÿ¨ÿØŸäÿØÿ©",
                "banner-title": "ÿπŸÜŸàÿßŸÜ ÿßŸÑŸÑÿßŸÅÿ™ÿ©",
                "banner-type": "ÿßŸÑŸÜŸàÿπ",
                "banner-order": "ÿ™ÿ±ÿ™Ÿäÿ® ÿßŸÑÿπÿ±ÿ∂",
                "banner-image": "ÿµŸàÿ±ÿ© ÿßŸÑŸÑÿßŸÅÿ™ÿ©",
                "save-banner": "ÿ≠ŸÅÿ∏ ÿßŸÑŸÑÿßŸÅÿ™ÿ©",
                "banner-list": "ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÑÿßŸÅÿ™ÿßÿ™",
                "table-title": "ÿßŸÑÿπŸÜŸàÿßŸÜ",
                "table-type": "ÿßŸÑŸÜŸàÿπ",
                "table-order": "ÿßŸÑÿ™ÿ±ÿ™Ÿäÿ®",
                "loading-banners": "ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÑÿßŸÅÿ™ÿßÿ™...",
                "order-list": "ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™",
                "table-customer-name": "ÿßÿ≥ŸÖ ÿßŸÑÿπŸÖŸäŸÑ",
                "table-book": "ÿßŸÑŸÉÿ™ÿßÿ®",
                "table-total-idr": "ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä (ÿ±Ÿàÿ®Ÿäÿ© ÿ•ŸÜÿØŸàŸÜŸäÿ≥Ÿäÿ©)",
                "table-status": "ÿßŸÑÿ≠ÿßŸÑÿ©",
                "table-date": "ÿßŸÑÿ™ÿßÿ±ŸäÿÆ",
                "loading-orders": "ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™...",
                "currency-settings": "ÿ•ÿπÿØÿßÿØÿßÿ™ ÿ≥ÿπÿ± ÿßŸÑÿµÿ±ŸÅ",
                "currency-description": "Ÿäÿ™ŸÖ ÿ™ÿÆÿ≤ŸäŸÜ ÿßŸÑÿ£ÿ≥ÿπÿßÿ± ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ© ŸÑŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ÿ®ÿßŸÑÿØŸàŸÑÿßÿ± ÿßŸÑÿ£ŸÖÿ±ŸäŸÉŸä. ÿßÿ∂ÿ®ÿ∑ ÿßŸÑÿ£ÿ≥ÿπÿßÿ± ŸáŸÜÿß ŸÑÿ™ÿ≠ŸàŸäŸÑ ÿßŸÑÿ£ÿ≥ÿπÿßÿ± ÿπŸÜÿØ ÿπÿ±ÿ∂Ÿáÿß.",
                "usd-to-idr": "ÿØŸàŸÑÿßÿ± ÿ£ŸÖÿ±ŸäŸÉŸä ÿ•ŸÑŸâ ÿ±Ÿàÿ®Ÿäÿ© ÿ•ŸÜÿØŸàŸÜŸäÿ≥Ÿäÿ©",
                "usd-to-egp": "ÿØŸàŸÑÿßÿ± ÿ£ŸÖÿ±ŸäŸÉŸä ÿ•ŸÑŸâ ÿ¨ŸÜŸäŸá ŸÖÿµÿ±Ÿä",
                "save-settings": "ÿ≠ŸÅÿ∏ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™",
                "edit-book-title": "ÿ™ÿπÿØŸäŸÑ ÿßŸÑŸÉÿ™ÿßÿ® - ÿ¨ŸÖŸäÿπ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™",
                "update-book": "ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÉÿ™ÿßÿ®",
                "cancel": "ÿ•ŸÑÿ∫ÿßÿ°"
            }
        };

        // Current language
        let currentLanguage = 'id';

        // Language selector functionality
        const languageBtn = document.getElementById('languageBtn');
        const languageDropdown = document.getElementById('languageDropdown');
        const currentLangFlag = document.getElementById('currentLangFlag');
        const currentLangText = document.getElementById('currentLangText');

        languageBtn.addEventListener('click', () => {
            languageDropdown.classList.toggle('show');
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', (e) => {
            if (!languageBtn.contains(e.target) && !languageDropdown.contains(e.target)) {
                languageDropdown.classList.remove('show');
            }
        });

        // Language option click handlers
        const languageOptions = document.querySelectorAll('.language-option');
        languageOptions.forEach(option => {
            option.addEventListener('click', () => {
                const lang = option.getAttribute('data-lang');
                changeLanguage(lang);
                
                // Update active state
                languageOptions.forEach(opt => opt.classList.remove('active'));
                option.classList.add('active');
                
                // Update button display
                const flag = option.querySelector('span:first-child').textContent;
                const text = option.querySelector('span:last-child').textContent;
                currentLangFlag.textContent = flag;
                currentLangText.textContent = text;
                
                // Close dropdown
                languageDropdown.classList.remove('show');
            });
        });

        // Change language function
        function changeLanguage(lang) {
            currentLanguage = lang;
            document.documentElement.lang = lang;
            
            // Update all elements with data-lang-key attribute
            const elements = document.querySelectorAll('[data-lang-key]');
            elements.forEach(element => {
                const key = element.getAttribute('data-lang-key');
                if (translations[lang] && translations[lang][key]) {
                    element.textContent = translations[lang][key];
                }
            });
            
            // Update placeholders
            updatePlaceholders(lang);
            
            // Update RTL for Arabic
            if (lang === 'ar') {
                document.body.style.direction = 'rtl';
                document.querySelector('.main-content').style.marginLeft = '0';
                document.querySelector('.main-content').style.marginRight = 'var(--sidebar-width)';
                document.querySelector('.sidebar').style.left = 'auto';
                document.querySelector('.sidebar').style.right = '0';
            } else {
                document.body.style.direction = 'ltr';
                document.querySelector('.main-content').style.marginLeft = 'var(--sidebar-width)';
                document.querySelector('.main-content').style.marginRight = '0';
                document.querySelector('.sidebar').style.left = '0';
                document.querySelector('.sidebar').style.right = 'auto';
            }
        }

        // Update placeholders based on language
        function updatePlaceholders(lang) {
            const placeholders = {
                id: {
                    'bookTitle': 'Masukkan judul buku',
                    'bookAuthor': 'Nama penulis',
                    'bookOriginalPrice': '0.00',
                    'bookBasePrice': '0.00',
                    'bookDiscount': 'Contoh: 10%',
                    'bookVolumes': 'Jumlah jilid',
                    'bookPages': 'Jumlah halaman',
                    'bookYear': 'Tahun terbit',
                    'bookWeightValue': 'Nilai berat',
                    'bookTextColorInput': 'Ketik manual',
                    'bookCoverTypeInput': 'Ketik manual',
                    'bookPaperTypeInput': 'Ketik manual',
                    'bookPrintCount': 'Angka cetakan',
                    'bookEditor': 'Nama editor',
                    'bookDescription': 'Deskripsi lengkap buku',
                    'bookCoverImageUrl': 'Masukkan URL gambar',
                    'searchTitle': 'Kata kunci judul...',
                    'searchAuthor': 'Nama penulis...',
                    'filterCoverType': 'Jenis cover...',
                    'filterPaperType': 'Jenis kertas...',
                    'publisherName': 'Nama penerbit',
                    'publisherLetter': 'Huruf penerbit',
                    'publisherDiscount': 'Contoh: 10%',
                    'categoryNameId': 'Nama dalam Bahasa Indonesia',
                    'categoryNameEn': 'Nama dalam Bahasa Inggris',
                    'categoryNameAr': 'Nama dalam Bahasa Arab',
                    'bannerTitle': 'Judul banner',
                    'bannerType': 'Contoh: promo, utama',
                    'bannerDisplayOrder': 'Angka urutan',
                    'usdToIdr': 'Kurs USD ke Rupiah',
                    'usdToEgp': 'Kurs USD ke Pound Mesir'
                },
                en: {
                    'bookTitle': 'Enter book title',
                    'bookAuthor': 'Author name',
                    'bookOriginalPrice': '0.00',
                    'bookBasePrice': '0.00',
                    'bookDiscount': 'Example: 10%',
                    'bookVolumes': 'Number of volumes',
                    'bookPages': 'Number of pages',
                    'bookYear': 'Publication year',
                    'bookWeightValue': 'Weight value',
                    'bookTextColorInput': 'Type manually',
                    'bookCoverTypeInput': 'Type manually',
                    'bookPaperTypeInput': 'Type manually',
                    'bookPrintCount': 'Print edition number',
                    'bookEditor': 'Editor name',
                    'bookDescription': 'Complete book description',
                    'bookCoverImageUrl': 'Enter image URL',
                    'searchTitle': 'Title keywords...',
                    'searchAuthor': 'Author name...',
                    'filterCoverType': 'Cover type...',
                    'filterPaperType': 'Paper type...',
                    'publisherName': 'Publisher name',
                    'publisherLetter': 'Publisher letter',
                    'publisherDiscount': 'Example: 10%',
                    'categoryNameId': 'Name in Indonesian',
                    'categoryNameEn': 'Name in English',
                    'categoryNameAr': 'Name in Arabic',
                    'bannerTitle': 'Banner title',
                    'bannerType': 'Example: promo, main',
                    'bannerDisplayOrder': 'Order number',
                    'usdToIdr': 'USD to IDR rate',
                    'usdToEgp': 'USD to EGP rate'
                },
                ar: {
                    'bookTitle': 'ÿ£ÿØÿÆŸÑ ÿπŸÜŸàÿßŸÜ ÿßŸÑŸÉÿ™ÿßÿ®',
                    'bookAuthor': 'ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ§ŸÑŸÅ',
                    'bookOriginalPrice': '0.00',
                    'bookBasePrice': '0.00',
                    'bookDiscount': 'ŸÖÿ´ÿßŸÑ: 10%',
                    'bookVolumes': 'ÿπÿØÿØ ÿßŸÑŸÖÿ¨ŸÑÿØÿßÿ™',
                    'bookPages': 'ÿπÿØÿØ ÿßŸÑÿµŸÅÿ≠ÿßÿ™',
                    'bookYear': 'ÿ≥ŸÜÿ© ÿßŸÑŸÜÿ¥ÿ±',
                    'bookWeightValue': 'ŸÇŸäŸÖÿ© ÿßŸÑŸàÿ≤ŸÜ',
                    'bookTextColorInput': 'ÿßŸÉÿ™ÿ® ŸäÿØŸàŸäÿßŸã',
                    'bookCoverTypeInput': 'ÿßŸÉÿ™ÿ® ŸäÿØŸàŸäÿßŸã',
                    'bookPaperTypeInput': 'ÿßŸÉÿ™ÿ® ŸäÿØŸàŸäÿßŸã',
                    'bookPrintCount': 'ÿ±ŸÇŸÖ ÿßŸÑÿ∑ÿ®ÿπÿ©',
                    'bookEditor': 'ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≠ÿ±ÿ±',
                    'bookDescription': 'ŸàÿµŸÅ ÿßŸÑŸÉÿ™ÿßÿ® ÿßŸÑŸÉÿßŸÖŸÑ',
                    'bookCoverImageUrl': 'ÿ£ÿØÿÆŸÑ ÿ±ÿßÿ®ÿ∑ ÿßŸÑÿµŸàÿ±ÿ©',
                    'searchTitle': 'ŸÉŸÑŸÖÿßÿ™ ŸÖŸÅÿ™ÿßÿ≠Ÿäÿ© ŸÑŸÑÿπŸÜŸàÿßŸÜ...',
                    'searchAuthor': 'ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ§ŸÑŸÅ...',
                    'filterCoverType': 'ŸÜŸàÿπ ÿßŸÑÿ∫ŸÑÿßŸÅ...',
                    'filterPaperType': 'ŸÜŸàÿπ ÿßŸÑŸàÿ±ŸÇ...',
                    'publisherName': 'ÿßÿ≥ŸÖ ÿßŸÑŸÜÿßÿ¥ÿ±',
                    'publisherLetter': 'ÿ≠ÿ±ŸÅ ÿßŸÑŸÜÿßÿ¥ÿ±',
                    'publisherDiscount': 'ŸÖÿ´ÿßŸÑ: 10%',
                    'categoryNameId': 'ÿßŸÑÿßÿ≥ŸÖ ÿ®ÿßŸÑÿ•ŸÜÿØŸàŸÜŸäÿ≥Ÿäÿ©',
                    'categoryNameEn': 'ÿßŸÑÿßÿ≥ŸÖ ÿ®ÿßŸÑÿ•ŸÜÿ¨ŸÑŸäÿ≤Ÿäÿ©',
                    'categoryNameAr': 'ÿßŸÑÿßÿ≥ŸÖ ÿ®ÿßŸÑÿπÿ±ÿ®Ÿäÿ©',
                    'bannerTitle': 'ÿπŸÜŸàÿßŸÜ ÿßŸÑŸÑÿßŸÅÿ™ÿ©',
                    'bannerType': 'ŸÖÿ´ÿßŸÑ: ÿ™ÿ±ŸàŸäÿ¨Ÿäÿå ÿ±ÿ¶Ÿäÿ≥Ÿä',
                    'bannerDisplayOrder': 'ÿ±ŸÇŸÖ ÿßŸÑÿ™ÿ±ÿ™Ÿäÿ®',
                    'usdToIdr': 'ÿ≥ÿπÿ± ÿµÿ±ŸÅ ÿßŸÑÿØŸàŸÑÿßÿ± ÿ•ŸÑŸâ ÿßŸÑÿ±Ÿàÿ®Ÿäÿ© ÿßŸÑÿ•ŸÜÿØŸàŸÜŸäÿ≥Ÿäÿ©',
                    'usdToEgp': 'ÿ≥ÿπÿ± ÿµÿ±ŸÅ ÿßŸÑÿØŸàŸÑÿßÿ± ÿ•ŸÑŸâ ÿßŸÑÿ¨ŸÜŸäŸá ÿßŸÑŸÖÿµÿ±Ÿä'
                }
            };
            
            // Update all input placeholders
            for (const [id, placeholder] of Object.entries(placeholders[lang])) {
                const element = document.getElementById(id);
                if (element) {
                    element.placeholder = placeholder;
                }
            }
        }

        // Menu toggle for mobile
        document.getElementById('menuToggle').addEventListener('click', function() {
            document.getElementById('sidebar').classList.toggle('active');
        });

        // Navigation
        const navButtons = document.querySelectorAll('.nav-btn');
        const contentSections = document.querySelectorAll('.content-section');

        navButtons.forEach(button => {
            button.addEventListener('click', () => {
                const targetSection = button.getAttribute('data-section');
                
                // Update active nav button
                navButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                
                // Show target section
                contentSections.forEach(section => {
                    section.classList.remove('active');
                    if (section.id === `${targetSection}-section`) {
                        section.classList.add('active');
                    }
                });
                
                // Close mobile menu
                if (window.innerWidth <= 1024) {
                    document.getElementById('sidebar').classList.remove('active');
                }
            });
        });

        // Check screen size on load and resize
        function checkScreenSize() {
            const menuToggle = document.getElementById('menuToggle');
            if (window.innerWidth <= 1024) {
                menuToggle.style.display = 'block';
            } else {
                menuToggle.style.display = 'none';
                document.getElementById('sidebar').classList.remove('active');
            }
        }

        window.addEventListener('load', checkScreenSize);
        window.addEventListener('resize', checkScreenSize);

        // Initialize with Indonesian language
        changeLanguage('id');

        // Supabase initialization and application logic
        document.addEventListener('DOMContentLoaded', function() {
            const supabaseUrl = 'https://rfqpsuzmonfmnvthxinb.supabase.co';
            const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJmcXBzdXptb25mbW52dGh4aW5iIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA1OTQyMjUsImV4cCI6MjA3NjE3MDIyNX0.gJFzuE-KJrdSoIKMTIDszTdNLDl_sJkIhgo7wmXRGWA';
            const supabase = window.supabase.createClient(supabaseUrl, supabaseAnonKey);
            const STORAGE_BUCKET = 'images';

            let currencySettings = { usd_rate: 15000, egp_rate: 500 };
            let allPublishers = [];
            let allCategories = [];
            let selectedBooks = new Set();
            let currentFilters = {};

            // Excel Upload Functionality
            const uploadArea = document.getElementById('uploadArea');
            const excelFileInput = document.getElementById('excelFileInput');
            const browseFilesBtn = document.getElementById('browseFilesBtn');
            const uploadStatus = document.getElementById('uploadStatus');
            const downloadTemplateBtn = document.getElementById('downloadTemplateBtn');

            // Handle drag and drop events
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                uploadArea.addEventListener(eventName, preventDefaults, false);
            });

            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            ['dragenter', 'dragover'].forEach(eventName => {
                uploadArea.addEventListener(eventName, highlight, false);
            });

            ['dragleave', 'drop'].forEach(eventName => {
                uploadArea.addEventListener(eventName, unhighlight, false);
            });

            function highlight() {
                uploadArea.classList.add('dragover');
            }

            function unhighlight() {
                uploadArea.classList.remove('dragover');
            }

            // Handle file drop
            uploadArea.addEventListener('drop', handleDrop, false);

            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                handleFiles(files);
            }

            // Handle file selection via button
            browseFilesBtn.addEventListener('click', () => {
                excelFileInput.click();
            });

            excelFileInput.addEventListener('change', (e) => {
                handleFiles(e.target.files);
            });

            // Download template
            downloadTemplateBtn.addEventListener('click', downloadTemplate);

            function downloadTemplate() {
                // Create template data
                const templateData = [
                    {
                        'Judul Buku': 'Contoh: Fiqih Islam',
                        'Penulis': 'Contoh: Ahmad Sarwat',
                        'Harga Asli (USD)': '20.00',
                        'Harga Dasar (USD)': '15.00',
                        'Penerbit ID': '1',
                        'Kategori ID': '1',
                        'Diskon': '10%',
                        'Jilid': '1',
                        'Halaman': '300',
                        'Tahun Terbit': '2023',
                        'Berat Nilai': '0.5',
                        'Berat Satuan': 'kg',
                        'Warna Tulisan': 'Hitam',
                        'Jenis Cover': 'Hard Cover',
                        'Jenis Kertas': 'HVS',
                        'Cetakan Ke': '1',
                        'Editor': 'Contoh: Editor Name',
                        'Deskripsi': 'Deskripsi buku...',
                        'URL Gambar Sampul': 'https://example.com/image.jpg'
                    }
                ];

                // Create worksheet and workbook
                const ws = XLSX.utils.json_to_sheet(templateData);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, 'Template Buku');

                // Generate and download file
                XLSX.writeFile(wb, 'template_buku.xlsx');
            }

            function handleFiles(files) {
                if (files.length === 0) return;
                
                const file = files[0];
                const fileType = file.name.split('.').pop().toLowerCase();
                
                if (!['xlsx', 'xls', 'csv'].includes(fileType)) {
                    uploadStatus.innerHTML = '<p style="color: red;">Format file tidak didukung. Harap unggah file Excel (.xlsx, .xls) atau CSV.</p>';
                    return;
                }
                
                uploadStatus.innerHTML = '<p>Memproses file...</p>';
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });
                        
                        // Get first worksheet
                        const worksheetName = workbook.SheetNames[0];
                        const worksheet = workbook.Sheets[worksheetName];
                        
                        // Convert to JSON
                        const jsonData = XLSX.utils.sheet_to_json(worksheet);
                        
                        if (jsonData.length === 0) {
                            uploadStatus.innerHTML = '<p style="color: red;">File Excel kosong atau tidak memiliki data.</p>';
                            return;
                        }
                        
                        // Process and upload data
                        processExcelData(jsonData);
                    } catch (error) {
                        console.error('Error processing Excel file:', error);
                        uploadStatus.innerHTML = '<p style="color: red;">Terjadi kesalahan saat memproses file Excel.</p>';
                    }
                };
                
                reader.readAsArrayBuffer(file);
            }

            async function processExcelData(data) {
                uploadStatus.innerHTML = '<p>Mengunggah data ke database...</p>';
                
                let successCount = 0;
                let errorCount = 0;
                
                for (const item of data) {
                    try {
                        // Map Excel columns to database fields
                        const bookData = {
                            title: item['Judul Buku'] || '',
                            author: item['Penulis'] || '',
                            original_price: parseFloat(item['Harga Asli (USD)']) || 0,
                            base_price: parseFloat(item['Harga Dasar (USD)']) || 0,
                            publisher_id: parseInt(item['Penerbit ID']) || null,
                            category_id: parseInt(item['Kategori ID']) || null,
                            discount: item['Diskon'] || '',
                            volumes: parseInt(item['Jilid']) || null,
                            pages: parseInt(item['Halaman']) || null,
                            year: parseInt(item['Tahun Terbit']) || null,
                            weight_value: parseFloat(item['Berat Nilai']) || null,
                            weight_unit: item['Berat Satuan'] || 'g',
                            text_color: item['Warna Tulisan'] || '',
                            cover_type: item['Jenis Cover'] || '',
                            paper_type: item['Jenis Kertas'] || '',
                            print_count: parseInt(item['Cetakan Ke']) || null,
                            editor: item['Editor'] || '',
                            description: item['Deskripsi'] || '',
                            cover_image_url: item['URL Gambar Sampul'] || ''
                        };
                        
                        // Insert into database
                        const { error } = await supabase.from('books').insert([bookData]);
                        
                        if (error) {
                            console.error('Error inserting book:', error);
                            errorCount++;
                        } else {
                            successCount++;
                        }
                    } catch (error) {
                        console.error('Error processing book data:', error);
                        errorCount++;
                    }
                }
                
                // Show upload results
                uploadStatus.innerHTML = `
                    <p style="color: green;">Upload selesai!</p>
                    <p>Berhasil: ${successCount} buku</p>
                    <p>Gagal: ${errorCount} buku</p>
                `;
                
                // Refresh books list
                if (successCount > 0) {
                    window.fetchBooks();
                }
            }

            function saveFormData(formId) {
                const form = document.getElementById(formId);
                const formData = {};
                const inputs = form.querySelectorAll('input, select, textarea');
                inputs.forEach(input => {
                    if (input.type !== 'file' && input.type !== 'submit' && input.type !== 'button') {
                        formData[input.id] = input.value;
                    }
                });
                localStorage.setItem(`formData_${formId}`, JSON.stringify(formData));
            }

            function loadFormData(formId) {
                const savedData = localStorage.getItem(`formData_${formId}`);
                if (savedData) {
                    const formData = JSON.parse(savedData);
                    Object.keys(formData).forEach(key => {
                        const element = document.getElementById(key);
                        if (element) {
                            element.value = formData[key];
                            if (element.id.includes('BasePrice') || element.id.includes('Discount')) {
                                updatePriceCalculator();
                            }
                        }
                    });
                }
            }

            function setupFormAutoSave(formId) {
                const form = document.getElementById(formId);
                const inputs = form.querySelectorAll('input, select, textarea');
                inputs.forEach(input => {
                    if (input.type !== 'file' && input.type !== 'submit' && input.type !== 'button') {
                        input.addEventListener('input', () => saveFormData(formId));
                        input.addEventListener('change', () => saveFormData(formId));
                    }
                });
            }

            const sections = document.querySelectorAll('.content-section');
            const navButtons = document.querySelectorAll('.nav-btn');
            
            function showSection(sectionId) {
                sections.forEach(section => section.classList.remove('active'));
                navButtons.forEach(btn => btn.classList.remove('active'));
                document.getElementById(`${sectionId}-section`).classList.add('active');
                document.querySelector(`[data-section="${sectionId}"]`).classList.add('active');
                
                if (window[`fetch${sectionId.charAt(0).toUpperCase() + sectionId.slice(1)}`]) {
                    window[`fetch${sectionId.charAt(0).toUpperCase() + sectionId.slice(1)}`]();
                }
            }
            
            navButtons.forEach(button => {
                button.addEventListener('click', () => showSection(button.dataset.section));
            });

            function formatPrice(priceInUsd, currency) {
                let rate = 1, symbol = '$';
                if (currency === 'IDR') { rate = currencySettings.usd_rate; symbol = 'Rp '; }
                if (currency === 'EGP') { rate = currencySettings.egp_rate; symbol = 'E¬£ '; }
                const price = priceInUsd * rate;
                return `${symbol}${price.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            }
            
            function calculateDiscountedPrice(basePrice, discount) {
                if (!discount) return basePrice;
                const discountPercent = parseFloat(discount.replace('%', '')) || 0;
                return basePrice * (1 - discountPercent / 100);
            }
            
            function slugify(text) {
                return text.toString().toLowerCase()
                    .replace(/\s+/g, '-')
                    .replace(/[^\w\-]+/g, '')
                    .replace(/\-\-+/g, '-')
                    .replace(/^-+/, '')
                    .replace(/-+$/, '');
            }
            
            async function uploadImage(file, folder) {
                if (!file) return null;
                const fileExt = file.name.split('.').pop();
                const fileName = `${folder}/${Date.now()}.${fileExt}`;
                const { data, error } = await supabase.storage.from(STORAGE_BUCKET).upload(fileName, file);
                if (error) {
                    console.error('Error uploading image:', error);
                    alert('Gagal mengunggah gambar.');
                    return null;
                }
                const { data: { publicUrl } } = supabase.storage.from(STORAGE_BUCKET).getPublicUrl(fileName);
                return publicUrl;
            }
            
            async function fetchData(tableName, tbodyId, loadingId, renderFunction) {
                document.getElementById(loadingId).style.display = 'block';
                const { data, error } = await supabase.from(tableName).select('*');
                if (error) {
                    console.error(`Error fetching ${tableName}:`, error);
                    document.getElementById(loadingId).textContent = 'Gagal memuat data.';
                } else {
                    renderFunction(data);
                    document.getElementById(loadingId).style.display = 'none';
                }
            }
            
            async function deleteItem(tableName, itemId, fetchFunction) {
                if (!confirm('Apakah Anda yakin ingin menghapus data ini?')) return;
                const { error } = await supabase.from(tableName).delete().eq('id', itemId);
                if (error) {
                    console.error(`Error deleting from ${tableName}:`, error);
                    alert('Gagal menghapus data.');
                } else {
                    fetchFunction();
                }
            }

            const bookForm = document.getElementById('bookForm');
            const booksTableBody = document.getElementById('booksTableBody');
            const bookFileInput = document.getElementById('bookCoverImageFileInput');
            const bookUrlInput = document.getElementById('bookCoverImageUrlInput');
            const bookImagePreview = document.getElementById('bookImagePreview');
            const bookPublisherSelect = document.getElementById('bookPublisherSelect');
            const bookCategorySelect = document.getElementById('bookCategorySelect');
            const bookDiscountInput = document.getElementById('bookDiscount');
            const bookBasePriceInput = document.getElementById('bookBasePrice');

            const displayBasePriceUSD = document.getElementById('displayBasePriceUSD');
            const displayDiscountPercent = document.getElementById('displayDiscountPercent');
            const displayFinalPriceUSD = document.getElementById('displayFinalPriceUSD');
            const displayFinalPriceIDR = document.getElementById('displayFinalPriceIDR');
            const displayFinalPriceEGP = document.getElementById('displayFinalPriceEGP');

            const selectAllCheckbox = document.getElementById('selectAllCheckboxHeader');
            const bulkActionSelect = document.getElementById('bulkAction');
            const applyBulkActionBtn = document.getElementById('applyBulkAction');
            const selectedCountSpan = document.getElementById('selectedCount');

            const searchTitle = document.getElementById('searchTitle');
            const searchAuthor = document.getElementById('searchAuthor');
            const filterPublisher = document.getElementById('filterPublisher');
            const filterCategory = document.getElementById('filterCategory');
            const filterCoverType = document.getElementById('filterCoverType');
            const filterPaperType = document.getElementById('filterPaperType');
            const applyFilterBtn = document.getElementById('applyFilter');
            const resetFilterBtn = document.getElementById('resetFilter');

            const editModal = document.getElementById('editModal');
            const editBookForm = document.getElementById('editBookForm');
            const closeModalBtn = document.querySelector('.close-modal');
            const cancelEditModalBtn = document.getElementById('cancelEditModal');

            function updatePriceCalculator() {
                const basePrice = parseFloat(bookBasePriceInput.value) || 0;
                const discount = bookDiscountInput.value || '0';
                const discountPercent = parseFloat(discount.replace('%', '')) || 0;
                const finalPriceUSD = calculateDiscountedPrice(basePrice, discount);
                
                displayBasePriceUSD.textContent = `$${basePrice.toFixed(2)}`;
                displayDiscountPercent.textContent = `${discountPercent}%`;
                displayFinalPriceUSD.textContent = `$${finalPriceUSD.toFixed(2)}`;
                displayFinalPriceIDR.textContent = formatPrice(finalPriceUSD, 'IDR');
                displayFinalPriceEGP.textContent = formatPrice(finalPriceUSD, 'EGP');
            }

            function updateEditPriceCalculator() {
                const basePrice = parseFloat(document.getElementById('editBookBasePrice').value) || 0;
                const discount = document.getElementById('editBookDiscount').value || '0';
                const discountPercent = parseFloat(discount.replace('%', '')) || 0;
                const finalPriceUSD = calculateDiscountedPrice(basePrice, discount);
                
                document.getElementById('editDisplayBasePriceUSD').textContent = `$${basePrice.toFixed(2)}`;
                document.getElementById('editDisplayDiscountPercent').textContent = `${discountPercent}%`;
                document.getElementById('editDisplayFinalPriceUSD').textContent = `$${finalPriceUSD.toFixed(2)}`;
                document.getElementById('editDisplayFinalPriceIDR').textContent = formatPrice(finalPriceUSD, 'IDR');
                document.getElementById('editDisplayFinalPriceEGP').textContent = formatPrice(finalPriceUSD, 'EGP');
            }

            async function populatePublisherDropdown() {
                const { data, error } = await supabase.from('publishers').select('id, name, discount');
                if (error) {
                    console.error('Error fetching publishers:', error);
                    return;
                }
                allPublishers = data;
                
                bookPublisherSelect.innerHTML = '<option value="">-- Pilih Penerbit --</option>' + 
                    data.map(p => `<option value="${p.id}" data-discount="${p.discount || ''}">${p.name}</option>`).join('');
                
                document.getElementById('editBookPublisherSelect').innerHTML = '<option value="">-- Pilih Penerbit --</option>' + 
                    data.map(p => `<option value="${p.id}" data-discount="${p.discount || ''}">${p.name}</option>`).join('');
                
                filterPublisher.innerHTML = '<option value="">Semua Penerbit</option>' + 
                    data.map(p => `<option value="${p.id}">${p.name}</option>`).join('');
            }

            async function populateCategoryDropdown() {
                const { data, error } = await supabase.from('categories').select('id, name_id');
                if (error) {
                    console.error('Error fetching categories:', error);
                    return;
                }
                allCategories = data;
                
                bookCategorySelect.innerHTML = '<option value="">-- Pilih Kategori --</option>' + 
                    data.map(c => `<option value="${c.id}">${c.name_id}</option>`).join('');
                
                document.getElementById('editBookCategorySelect').innerHTML = '<option value="">-- Pilih Kategori --</option>' + 
                    data.map(c => `<option value="${c.id}">${c.name_id}</option>`).join('');
                
                filterCategory.innerHTML = '<option value="">Semua Kategori</option>' + 
                    data.map(c => `<option value="${c.id}">${c.name_id}</option>`).join('');
            }

            bookPublisherSelect.addEventListener('change', (e) => {
                const selectedOption = e.target.options[e.target.selectedIndex];
                bookDiscountInput.value = selectedOption.dataset.discount || '';
                updatePriceCalculator();
                saveFormData('bookForm');
            });

            document.getElementById('editBookPublisherSelect').addEventListener('change', (e) => {
                const selectedOption = e.target.options[e.target.selectedIndex];
                document.getElementById('editBookDiscount').value = selectedOption.dataset.discount || '';
                updateEditPriceCalculator();
            });

            bookBasePriceInput.addEventListener('input', () => {
                updatePriceCalculator();
                saveFormData('bookForm');
            });
            bookDiscountInput.addEventListener('input', () => {
                updatePriceCalculator();
                saveFormData('bookForm');
            });

            document.getElementById('editBookBasePrice').addEventListener('input', updateEditPriceCalculator);
            document.getElementById('editBookDiscount').addEventListener('input', updateEditPriceCalculator);

            document.querySelectorAll('input[name="bookImageSource"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    if (e.target.value === 'upload') {
                        document.getElementById('bookCoverImageFile').style.display = 'block';
                        document.getElementById('bookCoverImageUrl').style.display = 'none';
                    } else {
                        document.getElementById('bookCoverImageFile').style.display = 'none';
                        document.getElementById('bookCoverImageUrl').style.display = 'block';
                    }
                    saveFormData('bookForm');
                });
            });

            document.querySelectorAll('input[name="editBookImageSource"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    if (e.target.value === 'upload') {
                        document.getElementById('editBookCoverImageFile').style.display = 'block';
                        document.getElementById('editBookCoverImageUrl').style.display = 'none';
                    } else {
                        document.getElementById('editBookCoverImageFile').style.display = 'none';
                        document.getElementById('editBookCoverImageUrl').style.display = 'block';
                    }
                });
            });

            bookFileInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    bookImagePreview.src = URL.createObjectURL(file);
                    bookImagePreview.style.display = 'block';
                }
            });
            bookUrlInput.addEventListener('input', (e) => {
                if (e.target.value) {
                    bookImagePreview.src = e.target.value;
                    bookImagePreview.style.display = 'block';
                } else {
                    bookImagePreview.style.display = 'none';
                }
                saveFormData('bookForm');
            });

            document.getElementById('editBookCoverImageFileInput').addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    document.getElementById('editBookImagePreview').src = URL.createObjectURL(file);
                    document.getElementById('editBookImagePreview').style.display = 'block';
                }
            });
            document.getElementById('editBookCoverImageUrlInput').addEventListener('input', (e) => {
                if (e.target.value) {
                    document.getElementById('editBookImagePreview').src = e.target.value;
                    document.getElementById('editBookImagePreview').style.display = 'block';
                } else {
                    document.getElementById('editBookImagePreview').style.display = 'none';
                }
            });

            function updateSelectedCount() {
                selectedCountSpan.textContent = `${selectedBooks.size} buku terpilih`;
            }

            function handleBookSelection(bookId, isChecked) {
                if (isChecked) {
                    selectedBooks.add(bookId);
                } else {
                    selectedBooks.delete(bookId);
                }
                updateSelectedCount();
            }

            selectAllCheckbox.addEventListener('change', (e) => {
                const checkboxes = document.querySelectorAll('.book-checkbox');
                checkboxes.forEach(checkbox => {
                    checkbox.checked = e.target.checked;
                    handleBookSelection(checkbox.dataset.id, e.target.checked);
                });
            });

            applyBulkActionBtn.addEventListener('click', async () => {
                const action = bulkActionSelect.value;
                if (!action) {
                    alert('Pilih aksi terlebih dahulu');
                    return;
                }

                if (selectedBooks.size === 0) {
                    alert('Pilih setidaknya satu buku');
                    return;
                }

                if (action === 'delete') {
                    if (!confirm(`Apakah Anda yakin ingin menghapus ${selectedBooks.size} buku?`)) return;
                    
                    for (const bookId of selectedBooks) {
                        await deleteItem('books', bookId, () => {});
                    }
                    selectedBooks.clear();
                    updateSelectedCount();
                    selectAllCheckbox.checked = false;
                    window.fetchBooks();
                    alert(`${selectedBooks.size} buku berhasil dihapus`);
                }
            });

            function getCustomInputValue(selectId, inputId) {
                const selectValue = document.getElementById(selectId).value;
                const inputValue = document.getElementById(inputId).value.trim();
                return inputValue || selectValue;
            }

            function setCustomInputValue(selectId, inputId, value) {
                const select = document.getElementById(selectId);
                const input = document.getElementById(inputId);
                
                if (select.querySelector(`option[value="${value}"]`)) {
                    select.value = value;
                    input.value = '';
                } else {
                    select.value = '';
                    input.value = value;
                }
            }

            function openEditModal(data) {
                document.getElementById('editBookId').value = data.id;
                document.getElementById('editBookTitle').value = data.title;
                document.getElementById('editBookAuthor').value = data.author;
                document.getElementById('editBookOriginalPrice').value = data.original_price;
                document.getElementById('editBookBasePrice').value = data.base_price;
                document.getElementById('editBookVolumes').value = data.volumes;
                document.getElementById('editBookPages').value = data.pages;
                document.getElementById('editBookYear').value = data.year;
                document.getElementById('editBookDescription').value = data.description || '';
                document.getElementById('editBookOldCoverUrl').value = data.cover_image_url || '';
                document.getElementById('editBookPublisherSelect').value = data.publisher_id || '';
                document.getElementById('editBookCategorySelect').value = data.category_id || '';
                document.getElementById('editBookDiscount').value = data.discount || '';
                
                // Set berat buku
                if (data.weight_value && data.weight_unit) {
                    document.getElementById('editBookWeightValue').value = data.weight_value;
                    document.getElementById('editBookWeightUnit').value = data.weight_unit;
                }
                
                setCustomInputValue('editBookTextColorSelect', 'editBookTextColorInput', data.text_color || '');
                setCustomInputValue('editBookCoverTypeSelect', 'editBookCoverTypeInput', data.cover_type || '');
                setCustomInputValue('editBookPaperTypeSelect', 'editBookPaperTypeInput', data.paper_type || '');
                
                document.getElementById('editBookPrintCount').value = data.print_count || '';
                document.getElementById('editBookEditor').value = data.editor || '';
                
                updateEditPriceCalculator();
                
                if (data.cover_image_url) {
                    document.getElementById('editBookImagePreview').src = data.cover_image_url;
                    document.getElementById('editBookImagePreview').style.display = 'block';
                }
                
                editModal.style.display = 'block';
            }

            function applyFilters() {
                currentFilters = {
                    title: searchTitle.value,
                    author: searchAuthor.value,
                    publisher: filterPublisher.value,
                    category: filterCategory.value,
                    coverType: filterCoverType.value,
                    paperType: filterPaperType.value
                };
                
                window.fetchBooks();
            }

            function resetFilters() {
                searchTitle.value = '';
                searchAuthor.value = '';
                filterPublisher.value = '';
                filterCategory.value = '';
                filterCoverType.value = '';
                filterPaperType.value = '';
                
                currentFilters = {};
                window.fetchBooks();
            }

            applyFilterBtn.addEventListener('click', applyFilters);
            resetFilterBtn.addEventListener('click', resetFilters);

            const renderBooks = (books) => {
                let filteredBooks = books;
                
                if (currentFilters.title) {
                    filteredBooks = filteredBooks.filter(book => 
                        book.title.toLowerCase().includes(currentFilters.title.toLowerCase())
                    );
                }
                
                if (currentFilters.author) {
                    filteredBooks = filteredBooks.filter(book => 
                        book.author.toLowerCase().includes(currentFilters.author.toLowerCase())
                    );
                }
                
                if (currentFilters.publisher) {
                    filteredBooks = filteredBooks.filter(book => 
                        book.publisher_id === currentFilters.publisher
                    );
                }
                
                if (currentFilters.category) {
                    filteredBooks = filteredBooks.filter(book => 
                        book.category_id === currentFilters.category
                    );
                }
                
                if (currentFilters.coverType) {
                    filteredBooks = filteredBooks.filter(book => 
                        book.cover_type && book.cover_type.toLowerCase().includes(currentFilters.coverType.toLowerCase())
                    );
                }
                
                if (currentFilters.paperType) {
                    filteredBooks = filteredBooks.filter(book => 
                        book.paper_type && book.paper_type.toLowerCase().includes(currentFilters.paperType.toLowerCase())
                    );
                }
                
                booksTableBody.innerHTML = filteredBooks.map(book => {
                    const basePrice = book.base_price || 0;
                    const discount = book.discount || '0';
                    const discountPercent = parseFloat(discount.replace('%', '')) || 0;
                    const finalPriceUSD = calculateDiscountedPrice(basePrice, discount);
                    const isChecked = selectedBooks.has(book.id);
                    
                    const publisher = allPublishers.find(p => p.id === book.publisher_id);
                    const category = allCategories.find(c => c.id === book.category_id);
                    
                    return `
                    <tr>
                        <td><input type="checkbox" class="book-checkbox" data-id="${book.id}" ${isChecked ? 'checked' : ''}></td>
                        <td><img src="${book.cover_image_url || 'https://via.placeholder.com/60x60.png?text=No+Image'}" class="table-image" alt="Cover"></td>
                        <td>
                            <strong>${book.title}</strong><br>
                            <small>Penulis: ${book.author}</small><br>
                            <small>Penerbit: ${publisher ? publisher.name : '-'}</small><br>
                            <small>Kategori: ${category ? category.name_id : '-'}</small>
                        </td>
                        <td>
                            <div class="book-details-grid">
                                ${book.text_color ? `<div class="detail-item"><span class="detail-label">Warna Tulisan:</span><span class="detail-value">${book.text_color}</span></div>` : ''}
                                ${book.cover_type ? `<div class="detail-item"><span class="detail-label">Jenis Cover:</span><span class="detail-value">${book.cover_type}</span></div>` : ''}
                                ${book.paper_type ? `<div class="detail-item"><span class="detail-label">Jenis Kertas:</span><span class="detail-value">${book.paper_type}</span></div>` : ''}
                                ${book.print_count ? `<div class="detail-item"><span class="detail-label">Cetakan Ke:</span><span class="detail-value">${book.print_count}</span></div>` : ''}
                                ${book.editor ? `<div class="detail-item"><span class="detail-label">Editor:</span><span class="detail-value">${book.editor}</span></div>` : ''}
                                ${book.volumes ? `<div class="detail-item"><span class="detail-label">Jilid:</span><span class="detail-value">${book.volumes}</span></div>` : ''}
                                ${book.pages ? `<div class="detail-item"><span class="detail-label">Halaman:</span><span class="detail-value">${book.pages}</span></div>` : ''}
                                ${book.year ? `<div class="detail-item"><span class="detail-label">Tahun:</span><span class="detail-value">${book.year}</span></div>` : ''}
                            </div>
                        </td>
                        <td>${book.weight_value ? `${book.weight_value} ${book.weight_unit}` : '-'}</td>
                        <td class="price-display">
                            <span class="original-price">${formatPrice(basePrice, 'USD')}</span>
                            <span class="discounted-price">${formatPrice(finalPriceUSD, 'USD')}</span>
                            ${discountPercent > 0 ? `<span class="discount-badge">-${discountPercent}%</span>` : ''}
                        </td>
                        <td class="price-display">
                            <span class="original-price">${formatPrice(basePrice, 'IDR')}</span>
                            <span class="discounted-price">${formatPrice(finalPriceUSD, 'IDR')}</span>
                        </td>
                        <td class="price-display">
                            <span class="original-price">${formatPrice(basePrice, 'EGP')}</span>
                            <span class="discounted-price">${formatPrice(finalPriceUSD, 'EGP')}</span>
                        </td>
                        <td>${discount || '-'}</td>
                        <td class="action-buttons">
                            <button class="btn edit-btn" data-id="${book.id}">‚úèÔ∏è Edit</button>
                            <button class="btn delete-btn" data-id="${book.id}">üóëÔ∏è Hapus</button>
                        </td>
                    </tr>`;
                }).join('');

                document.querySelectorAll('.book-checkbox').forEach(checkbox => {
                    checkbox.addEventListener('change', (e) => {
                        handleBookSelection(e.target.dataset.id, e.target.checked);
                    });
                });
            };
            
            window.fetchBooks = () => fetchData('books', 'booksTableBody', 'loadingBooks', renderBooks);

            setupFormAutoSave('bookForm');
            loadFormData('bookForm');

            bookForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const submitBtn = document.querySelector('#bookForm .submit-btn');
                submitBtn.disabled = true;
                submitBtn.textContent = 'Menyimpan...';
                
                const bookId = document.getElementById('bookId').value;
                const bookData = {
                    title: document.getElementById('bookTitle').value,
                    author: document.getElementById('bookAuthor').value,
                    original_price: parseFloat(document.getElementById('bookOriginalPrice').value),
                    base_price: parseFloat(document.getElementById('bookBasePrice').value),
                    volumes: document.getElementById('bookVolumes').value,
                    pages: document.getElementById('bookPages').value,
                    year: document.getElementById('bookYear').value,
                    description: document.getElementById('bookDescription').value,
                    publisher_id: bookPublisherSelect.value || null,
                    category_id: bookCategorySelect.value || null,
                    discount: bookDiscountInput.value,
                    text_color: getCustomInputValue('bookTextColorSelect', 'bookTextColorInput'),
                    cover_type: getCustomInputValue('bookCoverTypeSelect', 'bookCoverTypeInput'),
                    paper_type: getCustomInputValue('bookPaperTypeSelect', 'bookPaperTypeInput'),
                    print_count: document.getElementById('bookPrintCount').value ? parseInt(document.getElementById('bookPrintCount').value) : null,
                    editor: document.getElementById('bookEditor').value,
                    weight_value: document.getElementById('bookWeightValue').value ? parseFloat(document.getElementById('bookWeightValue').value) : null,
                    weight_unit: document.getElementById('bookWeightUnit').value
                };
                
                let imageUrl = null;
                if (document.querySelector('input[name="bookImageSource"]:checked').value === 'url') {
                    imageUrl = bookUrlInput.value;
                } else {
                    const file = bookFileInput.files[0];
                    if (file) {
                        imageUrl = await uploadImage(file, 'books');
                        if (!imageUrl) {
                            submitBtn.disabled = false;
                            submitBtn.textContent = 'Tambah Buku';
                            return;
                        }
                    } else {
                        imageUrl = document.getElementById('bookOldCoverUrl').value;
                    }
                }
                bookData.cover_image_url = imageUrl;

                const { error } = bookId ? 
                    await supabase.from('books').update(bookData).eq('id', bookId) : 
                    await supabase.from('books').insert([bookData]);
                    
                if (error) {
                    console.error('Error saving book:', error);
                    alert('Gagal menyimpan buku.');
                } else {
                    if (!bookId) {
                        bookForm.reset();
                        localStorage.removeItem('formData_bookForm');
                    }
                    resetBookForm();
                }
                
                submitBtn.disabled = false;
                submitBtn.textContent = bookId ? 'Perbarui Buku' : 'Tambah Buku';
                window.fetchBooks();
            });
            
            booksTableBody.addEventListener('click', async (e) => {
                const id = e.target.dataset.id;
                if (e.target.classList.contains('delete-btn')) {
                    await deleteItem('books', id, window.fetchBooks);
                }
                if (e.target.classList.contains('edit-btn')) {
                    const { data } = await supabase.from('books').select('*').eq('id', id).single();
                    if (data) {
                        openEditModal(data);
                    }
                }
            });
            
            function resetBookForm() {
                document.getElementById('bookId').value = '';
                document.getElementById('bookOldCoverUrl').value = '';
                bookImagePreview.style.display = 'none';
                document.getElementById('booksFormTitle').textContent = 'Tambah Buku Baru';
                document.querySelector('#bookForm .submit-btn').textContent = 'Tambah Buku';
                document.getElementById('cancelEditBook').style.display = 'none';
                document.getElementById('bookCoverImageFile').style.display = 'block';
                document.getElementById('bookCoverImageUrl').style.display = 'none';
                updatePriceCalculator();
            }
            
            document.getElementById('cancelEditBook').addEventListener('click', resetBookForm);

            editBookForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const submitBtn = document.querySelector('#editBookForm .submit-btn');
                submitBtn.disabled = true;
                submitBtn.textContent = 'Menyimpan...';
                
                const bookId = document.getElementById('editBookId').value;
                const bookData = {
                    title: document.getElementById('editBookTitle').value,
                    author: document.getElementById('editBookAuthor').value,
                    original_price: parseFloat(document.getElementById('editBookOriginalPrice').value),
                    base_price: parseFloat(document.getElementById('editBookBasePrice').value),
                    volumes: document.getElementById('editBookVolumes').value,
                    pages: document.getElementById('editBookPages').value,
                    year: document.getElementById('editBookYear').value,
                    description: document.getElementById('editBookDescription').value,
                    publisher_id: document.getElementById('editBookPublisherSelect').value || null,
                    category_id: document.getElementById('editBookCategorySelect').value || null,
                    discount: document.getElementById('editBookDiscount').value,
                    text_color: getCustomInputValue('editBookTextColorSelect', 'editBookTextColorInput'),
                    cover_type: getCustomInputValue('editBookCoverTypeSelect', 'editBookCoverTypeInput'),
                    paper_type: getCustomInputValue('editBookPaperTypeSelect', 'editBookPaperTypeInput'),
                    print_count: document.getElementById('editBookPrintCount').value ? parseInt(document.getElementById('editBookPrintCount').value) : null,
                    editor: document.getElementById('editBookEditor').value,
                    weight_value: document.getElementById('editBookWeightValue').value ? parseFloat(document.getElementById('editBookWeightValue').value) : null,
                    weight_unit: document.getElementById('editBookWeightUnit').value
                };
                
                let imageUrl = null;
                if (document.querySelector('input[name="editBookImageSource"]:checked').value === 'url') {
                    imageUrl = document.getElementById('editBookCoverImageUrlInput').value;
                } else {
                    const file = document.getElementById('editBookCoverImageFileInput').files[0];
                    if (file) {
                        imageUrl = await uploadImage(file, 'books');
                        if (!imageUrl) {
                            submitBtn.disabled = false;
                            submitBtn.textContent = 'Perbarui Buku';
                            return;
                        }
                    } else {
                        imageUrl = document.getElementById('editBookOldCoverUrl').value;
                    }
                }
                bookData.cover_image_url = imageUrl;

                const { error } = await supabase.from('books').update(bookData).eq('id', bookId);
                    
                if (error) {
                    console.error('Error updating book:', error);
                    alert('Gagal memperbarui buku.');
                } else {
                    closeEditModal();
                    window.fetchBooks();
                }
                
                submitBtn.disabled = false;
                submitBtn.textContent = 'Perbarui Buku';
            });

            function closeEditModal() {
                editModal.style.display = 'none';
                editBookForm.reset();
                document.getElementById('editBookId').value = '';
                document.getElementById('editBookOldCoverUrl').value = '';
                document.getElementById('editBookImagePreview').style.display = 'none';
                document.getElementById('editBookCoverImageFile').style.display = 'block';
                document.getElementById('editBookCoverImageUrl').style.display = 'none';
            }

            closeModalBtn.addEventListener('click', closeEditModal);
            cancelEditModalBtn.addEventListener('click', closeEditModal);

            window.addEventListener('click', (e) => {
                if (e.target === editModal) {
                    closeEditModal();
                }
            });

            const categoryForm = document.getElementById('categoryForm');
            const categoriesTableBody = document.getElementById('categoriesTableBody');
            const categoryFileInput = document.getElementById('categoryImageFile');
            const categoryImagePreview = document.getElementById('categoryImagePreview');
            const categoryNameIdInput = document.getElementById('categoryNameId');
            const categoryLinkInput = document.getElementById('categoryLink');

            categoryNameIdInput.addEventListener('input', (e) => {
                categoryLinkInput.value = `/kategori/${slugify(e.target.value)}`;
                saveFormData('categoryForm');
            });

            const renderCategories = (categories) => {
                categoriesTableBody.innerHTML = categories.map(c => `
                    <tr>
                        <td><img src="${c.image_url || 'https://via.placeholder.com/60x60.png?text=No+Image'}" class="table-image" alt="Category"></td>
                        <td>${c.name_id}</td>
                        <td>${c.name_en}</td>
                        <td><span style="display:inline-block; width:20px; height:20px; background-color:${c.color}; border-radius:4px; vertical-align:middle;"></span> ${c.color}</td>
                        <td>${c.link ? `<a href="${c.link}" target="_blank">${c.link}</a>` : '-'}</td>
                        <td class="action-buttons">
                            <button class="btn edit-btn" data-id="${c.id}">‚úèÔ∏è Edit</button>
                            <button class="btn delete-btn" data-id="${c.id}">üóëÔ∏è Hapus</button>
                        </td>
                    </tr>`).join('');
            };
            
            window.fetchCategories = () => fetchData('categories', 'categoriesTableBody', 'loadingCategories', renderCategories);
            
            categoryFileInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    categoryImagePreview.src = URL.createObjectURL(file);
                    categoryImagePreview.style.display = 'block';
                }
            });
            
            setupFormAutoSave('categoryForm');
            loadFormData('categoryForm');
            
            categoryForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const submitBtn = document.querySelector('#categoryForm .submit-btn');
                submitBtn.disabled = true;
                submitBtn.textContent = 'Menyimpan...';
                const categoryId = document.getElementById('categoryId').value;
                const categoryData = {
                    name_id: document.getElementById('categoryNameId').value,
                    name_en: document.getElementById('categoryNameEn').value,
                    name_ar: document.getElementById('categoryNameAr').value,
                    color: document.getElementById('categoryColor').value,
                    link: categoryLinkInput.value
                };
                const file = categoryFileInput.files[0];
                if (file) {
                    categoryData.image_url = await uploadImage(file, 'categories');
                    if (!categoryData.image_url) {
                        submitBtn.disabled = false;
                        submitBtn.textContent = 'Tambah Kategori';
                        return;
                    }
                } else {
                    categoryData.image_url = document.getElementById('categoryOldImageUrl').value;
                }
                const { error } = categoryId ? 
                    await supabase.from('categories').update(categoryData).eq('id', categoryId) : 
                    await supabase.from('categories').insert([categoryData]);
                if (error) {
                    alert('Gagal menyimpan kategori.');
                } else {
                    if (!categoryId) {
                        categoryForm.reset();
                        localStorage.removeItem('formData_categoryForm');
                    }
                    resetCategoryForm();
                }
                submitBtn.disabled = false;
                submitBtn.textContent = categoryId ? 'Perbarui Kategori' : 'Tambah Kategori';
                window.fetchCategories();
            });
            
            categoriesTableBody.addEventListener('click', async (e) => {
                const id = e.target.dataset.id;
                if (e.target.classList.contains('delete-btn')) {
                    await deleteItem('categories', id, window.fetchCategories);
                }
                if (e.target.classList.contains('edit-btn')) {
                    const { data } = await supabase.from('categories').select('*').eq('id', id).single();
                    if (data) {
                        document.getElementById('categoryId').value = data.id;
                        document.getElementById('categoryNameId').value = data.name_id;
                        document.getElementById('categoryNameEn').value = data.name_en;
                        document.getElementById('categoryNameAr').value = data.name_ar;
                        document.getElementById('categoryColor').value = data.color;
                        categoryLinkInput.value = data.link || '';
                        document.getElementById('categoryOldImageUrl').value = data.image_url || '';
                        if (data.image_url) {
                            categoryImagePreview.src = data.image_url;
                            categoryImagePreview.style.display = 'block';
                        } else {
                            categoryImagePreview.style.display = 'none';
                        }
                        document.getElementById('categoriesFormTitle').textContent = 'Edit Kategori';
                        document.querySelector('#categoryForm .submit-btn').textContent = 'Perbarui Kategori';
                        document.getElementById('cancelEditCategory').style.display = 'inline-block';
                        categoryForm.scrollIntoView({ behavior: 'smooth' });
                        saveFormData('categoryForm');
                    }
                }
            });
            
            function resetCategoryForm() {
                categoryForm.reset();
                document.getElementById('categoryId').value = '';
                document.getElementById('categoryOldImageUrl').value = '';
                categoryImagePreview.style.display = 'none';
                document.getElementById('categoriesFormTitle').textContent = 'Tambah Kategori Baru';
                document.querySelector('#categoryForm .submit-btn').textContent = 'Tambah Kategori';
                document.getElementById('cancelEditCategory').style.display = 'none';
            }
            
            document.getElementById('cancelEditCategory').addEventListener('click', resetCategoryForm);

            const publisherForm = document.getElementById('publisherForm');
            const publishersTableBody = document.getElementById('publishersTableBody');
            const publisherFileInput = document.getElementById('publisherLogoFile');
            const publisherImagePreview = document.getElementById('publisherImagePreview');
            
            const renderPublishers = (publishers) => {
                publishersTableBody.innerHTML = publishers.map(p => `
                    <tr>
                        <td><img src="${p.logo_url || 'https://via.placeholder.com/60x60.png?text=No+Logo'}" class="table-image" alt="Logo"></td>
                        <td>${p.name}</td>
                        <td>${p.letter}</td>
                        <td>${p.discount || '-'}</td>
                        <td class="action-buttons">
                            <button class="btn edit-btn" data-id="${p.id}">‚úèÔ∏è Edit</button>
                            <button class="btn delete-btn" data-id="${p.id}">üóëÔ∏è Hapus</button>
                        </td>
                    </tr>`).join('');
            };
            
            window.fetchPublishers = () => fetchData('publishers', 'publishersTableBody', 'loadingPublishers', renderPublishers);
            
            publisherFileInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    publisherImagePreview.src = URL.createObjectURL(file);
                    publisherImagePreview.style.display = 'block';
                }
            });
            
            setupFormAutoSave('publisherForm');
            loadFormData('publisherForm');
            
            publisherForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const submitBtn = document.querySelector('#publisherForm .submit-btn');
                submitBtn.disabled = true;
                submitBtn.textContent = 'Menyimpan...';
                const publisherId = document.getElementById('publisherId').value;
                const publisherData = {
                    name: document.getElementById('publisherName').value,
                    letter: document.getElementById('publisherLetter').value,
                    discount: document.getElementById('publisherDiscount').value
                };
                const file = publisherFileInput.files[0];
                if (file) {
                    publisherData.logo_url = await uploadImage(file, 'publishers');
                    if (!publisherData.logo_url) {
                        submitBtn.disabled = false;
                        submitBtn.textContent = 'Tambah Penerbit';
                        return;
                    }
                } else {
                    publisherData.logo_url = document.getElementById('publisherOldLogoUrl').value;
                }
                const { error } = publisherId ? 
                    await supabase.from('publishers').update(publisherData).eq('id', publisherId) : 
                    await supabase.from('publishers').insert([publisherData]);
                if (error) {
                    alert('Gagal menyimpan penerbit.');
                } else {
                    if (!publisherId) {
                        publisherForm.reset();
                        localStorage.removeItem('formData_publisherForm');
                    }
                    resetPublisherForm();
                }
                submitBtn.disabled = false;
                submitBtn.textContent = publisherId ? 'Perbarui Penerbit' : 'Tambah Penerbit';
                window.fetchPublishers();
            });
            
            publishersTableBody.addEventListener('click', async (e) => {
                const id = e.target.dataset.id;
                if (e.target.classList.contains('delete-btn')) {
                    await deleteItem('publishers', id, window.fetchPublishers);
                }
                if (e.target.classList.contains('edit-btn')) {
                    const { data } = await supabase.from('publishers').select('*').eq('id', id).single();
                    if (data) {
                        document.getElementById('publisherId').value = data.id;
                        document.getElementById('publisherName').value = data.name;
                        document.getElementById('publisherLetter').value = data.letter;
                        document.getElementById('publisherDiscount').value = data.discount;
                        document.getElementById('publisherOldLogoUrl').value = data.logo_url || '';
                        if (data.logo_url) {
                            publisherImagePreview.src = data.logo_url;
                            publisherImagePreview.style.display = 'block';
                        } else {
                            publisherImagePreview.style.display = 'none';
                        }
                        document.getElementById('publishersFormTitle').textContent = 'Edit Penerbit';
                        document.querySelector('#publisherForm .submit-btn').textContent = 'Perbarui Penerbit';
                        document.getElementById('cancelEditPublisher').style.display = 'inline-block';
                        publisherForm.scrollIntoView({ behavior: 'smooth' });
                        saveFormData('publisherForm');
                    }
                }
            });
            
            function resetPublisherForm() {
                publisherForm.reset();
                document.getElementById('publisherId').value = '';
                document.getElementById('publisherOldLogoUrl').value = '';
                publisherImagePreview.style.display = 'none';
                document.getElementById('publishersFormTitle').textContent = 'Tambah Penerbit Baru';
                document.querySelector('#publisherForm .submit-btn').textContent = 'Tambah Penerbit';
                document.getElementById('cancelEditPublisher').style.display = 'none';
            }
            
            document.getElementById('cancelEditPublisher').addEventListener('click', resetPublisherForm);

            const bannerForm = document.getElementById('bannerForm');
            const bannersTableBody = document.getElementById('bannersTableBody');
            const bannerFileInput = document.getElementById('bannerImageFile');
            const bannerImagePreview = document.getElementById('bannerImagePreview');
            
            const renderBanners = (banners) => {
                bannersTableBody.innerHTML = banners.map(b => `
                    <tr>
                        <td><img src="${b.image_url || 'https://via.placeholder.com/60x60.png?text=No+Image'}" class="table-image" alt="Banner"></td>
                        <td>${b.title}</td>
                        <td>${b.type}</td>
                        <td>${b.display_order}</td>
                        <td class="action-buttons">
                            <button class="btn edit-btn" data-id="${b.id}">‚úèÔ∏è Edit</button>
                            <button class="btn delete-btn" data-id="${b.id}">üóëÔ∏è Hapus</button>
                        </td>
                    </tr>`).join('');
            };
            
            window.fetchBanners = () => fetchData('banners', 'bannersTableBody', 'loadingBanners', renderBanners);
            
            bannerFileInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    bannerImagePreview.src = URL.createObjectURL(file);
                    bannerImagePreview.style.display = 'block';
                }
            });
            
            setupFormAutoSave('bannerForm');
            loadFormData('bannerForm');
            
            bannerForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const submitBtn = document.querySelector('#bannerForm .submit-btn');
                submitBtn.disabled = true;
                submitBtn.textContent = 'Menyimpan...';
                const bannerId = document.getElementById('bannerId').value;
                const bannerData = {
                    title: document.getElementById('bannerTitle').value,
                    type: document.getElementById('bannerType').value,
                    display_order: parseInt(document.getElementById('bannerDisplayOrder').value) || 0
                };
                const file = bannerFileInput.files[0];
                if (file) {
                    bannerData.image_url = await uploadImage(file, 'banners');
                    if (!bannerData.image_url) {
                        submitBtn.disabled = false;
                        submitBtn.textContent = 'Tambah Banner';
                        return;
                    }
                } else {
                    bannerData.image_url = document.getElementById('bannerOldImageUrl').value;
                }
                const { error } = bannerId ? 
                    await supabase.from('banners').update(bannerData).eq('id', bannerId) : 
                    await supabase.from('banners').insert([bannerData]);
                if (error) {
                    alert('Gagal menyimpan banner.');
                } else {
                    if (!bannerId) {
                        bannerForm.reset();
                        localStorage.removeItem('formData_bannerForm');
                    }
                    resetBannerForm();
                }
                submitBtn.disabled = false;
                submitBtn.textContent = bannerId ? 'Perbarui Banner' : 'Tambah Banner';
                window.fetchBanners();
            });
            
            bannersTableBody.addEventListener('click', async (e) => {
                const id = e.target.dataset.id;
                if (e.target.classList.contains('delete-btn')) {
                    await deleteItem('banners', id, window.fetchBanners);
                }
                if (e.target.classList.contains('edit-btn')) {
                    const { data } = await supabase.from('banners').select('*').eq('id', id).single();
                    if (data) {
                        document.getElementById('bannerId').value = data.id;
                        document.getElementById('bannerTitle').value = data.title;
                        document.getElementById('bannerType').value = data.type;
                        document.getElementById('bannerDisplayOrder').value = data.display_order;
                        document.getElementById('bannerOldImageUrl').value = data.image_url || '';
                        if (data.image_url) {
                            bannerImagePreview.src = data.image_url;
                            bannerImagePreview.style.display = 'block';
                        } else {
                            bannerImagePreview.style.display = 'none';
                        }
                        document.getElementById('bannersFormTitle').textContent = 'Edit Banner';
                        document.querySelector('#bannerForm .submit-btn').textContent = 'Perbarui Banner';
                        document.getElementById('cancelEditBanner').style.display = 'inline-block';
                        bannerForm.scrollIntoView({ behavior: 'smooth' });
                        saveFormData('bannerForm');
                    }
                }
            });
            
            function resetBannerForm() {
                bannerForm.reset();
                document.getElementById('bannerId').value = '';
                document.getElementById('bannerOldImageUrl').value = '';
                bannerImagePreview.style.display = 'none';
                document.getElementById('bannersFormTitle').textContent = 'Tambah Banner Baru';
                document.querySelector('#bannerForm .submit-btn').textContent = 'Tambah Banner';
                document.getElementById('cancelEditBanner').style.display = 'none';
            }
            
            document.getElementById('cancelEditBanner').addEventListener('click', resetBannerForm);

            const ordersTableBody = document.getElementById('ordersTableBody');
            const renderOrders = (orders) => {
                ordersTableBody.innerHTML = orders.map(o => `
                    <tr>
                        <td>${o.name}</td>
                        <td>${o.book_title}</td>
                        <td>$${(o.total_price || 0).toFixed(2)}</td>
                        <td>${o.status}</td>
                        <td>${new Date(o.created_at).toLocaleString('id-ID')}</td>
                    </tr>`).join('');
            };
            
            window.fetchOrders = () => fetchData('orders', 'ordersTableBody', 'loadingOrders', renderOrders);

            const currencyForm = document.getElementById('currencyForm');
            
            window.fetchCurrency = async () => {
                const { data, error } = await supabase.from('site_settings').select('usd_rate, egp_rate').single();
                if (error) {
                    console.error('Error fetching currency settings:', error);
                } else if (data) {
                    currencySettings = { usd_rate: data.usd_rate, egp_rate: data.egp_rate };
                    document.getElementById('usdToIdr').value = currencySettings.usd_rate;
                    document.getElementById('usdToEgp').value = currencySettings.egp_rate;
                }
            };
            
            setupFormAutoSave('currencyForm');
            loadFormData('currencyForm');
            
            currencyForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const newUsdRate = parseFloat(document.getElementById('usdToIdr').value);
                const newEgpRate = parseFloat(document.getElementById('usdToEgp').value);
                const { error } = await supabase.from('site_settings').update({
                    usd_rate: newUsdRate,
                    egp_rate: newEgpRate
                }).eq('id', (await supabase.from('site_settings').select('id').single()).data.id);
                if (error) {
                    alert('Gagal memperbarui pengaturan kurs.');
                } else {
                    alert('Pengaturan kurs berhasil disimpan!');
                    currencySettings.usd_rate = newUsdRate;
                    currencySettings.egp_rate = newEgpRate;
                    if (document.getElementById('books-section').classList.contains('active')) {
                        window.fetchBooks();
                    }
                    updatePriceCalculator();
                    saveFormData('currencyForm');
                }
            });

            window.fetchCurrency().then(() => {
                populatePublisherDropdown().then(() => {
                    populateCategoryDropdown().then(() => {
                        window.fetchBooks();
                    });
                });
            });
        });
    </script>
</body>
</html>
