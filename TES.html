

   <!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Admin - Toko Buku Islam</title>
    <style>
     :root {
    --primary: #2c3e50;
    --primary-light: #f8f9fa;
    --primary-dark: #1a252f;
    --secondary: #34495e;
    --light: #ffffff;
    --dark: #2c3e50;
    --border: #eaeaea;
    --success: #27ae60;
    --danger: #e74c3c;
    --warning: #f39c12;
    --sidebar-width: 250px;
    --font-family: 'Inter', 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
    --heading-font: 'Poppins', 'Inter', 'Segoe UI', Roboto, sans-serif;
}

@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@500;600;700&display=swap');

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: var(--font-family);
    background-color: #f8f9fa;
    color: var(--dark);
    line-height: 1.6;
    font-weight: 400;
}

.app-container {
    display: flex;
    min-height: 100vh;
}

.sidebar {
    width: var(--sidebar-width);
    background: var(--light);
    color: var(--dark);
    position: fixed;
    height: 100vh;
    overflow-y: auto;
    z-index: 100;
    transition: transform 0.3s ease;
    box-shadow: 2px 0 10px rgba(0,0,0,0.05);
}

.sidebar-header {
    padding: 2rem 1.5rem;
    text-align: center;
    border-bottom: 1px solid var(--border);
}

.sidebar-header h1 {
    font-family: var(--heading-font);
    font-size: 1.5rem;
    margin-bottom: 0.5rem;
    font-weight: 600;
    color: var(--primary);
}

.sidebar-header p {
    font-size: 0.85rem;
    opacity: 0.7;
    color: var(--secondary);
}

.sidebar-nav {
    padding: 1rem 0;
}

.nav-btn {
    display: block;
    width: 100%;
    background: transparent;
    color: var(--dark);
    border: none;
    padding: 1rem 1.5rem;
    cursor: pointer;
    font-size: 0.95rem;
    transition: all 0.3s ease;
    text-align: left;
    border-left: 3px solid transparent;
    font-weight: 500;
}

.nav-btn:hover {
    background: var(--primary-light);
}

.nav-btn.active {
    background: var(--primary-light);
    border-left-color: var(--primary);
    color: var(--primary);
    font-weight: 600;
}

.main-content {
    flex: 1;
    margin-left: var(--sidebar-width);
    background: var(--light);
    min-height: 100vh;
}

header {
    background: var(--light);
    color: var(--secondary);
    padding: 1.5rem 2rem;
    border-bottom: 1px solid var(--border);
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 2px 10px rgba(0,0,0,0.03);
}

.header-title {
    text-align: right;
}

.header-title h1 {
    font-family: var(--heading-font);
    font-size: 1.8rem;
    color: var(--primary);
    font-weight: 600;
}

.header-title p {
    font-size: 0.9rem;
    color: #6c757d;
    font-weight: 400;
}

.header-actions {
    display: flex;
    gap: 1rem;
    align-items: center;
}

.language-selector {
    position: relative;
}

.language-btn {
    background: var(--light);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 0.5rem 1rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.9rem;
    transition: all 0.2s ease;
}

.language-btn:hover {
    border-color: var(--primary);
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
}

.language-dropdown {
    position: absolute;
    top: 100%;
    right: 0;
    background: var(--light);
    border: 1px solid var(--border);
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    z-index: 1000;
    min-width: 150px;
    display: none;
    margin-top: 0.5rem;
}

.language-dropdown.show {
    display: block;
}

.language-option {
    padding: 0.75rem 1rem;
    cursor: pointer;
    transition: background 0.2s;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.language-option:hover {
    background: var(--primary-light);
}

.language-option.active {
    background: var(--primary-light);
    color: var(--primary);
    font-weight: 500;
}

main {
    padding: 2rem;
}

.content-section {
    display: none;
    animation: fadeIn 0.5s ease;
}

.content-section.active {
    display: block;
}

h2 {
    font-family: var(--heading-font);
    color: var(--primary);
    border-bottom: 1px solid var(--border);
    padding-bottom: 0.75rem;
    margin-bottom: 1.5rem;
    font-size: 1.5rem;
    font-weight: 600;
}

.form-section {
    background: var(--light);
    border-radius: 12px;
    padding: 2rem;
    margin-bottom: 2rem;
    border: 1px solid var(--border);
    box-shadow: 0 2px 15px rgba(0,0,0,0.04);
}

.form-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 1.25rem;
    margin-bottom: 1.5rem;
}

.form-group {
    display: flex;
    flex-direction: column;
}

.form-group label {
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: var(--dark);
    font-size: 0.9rem;
}

.form-grid input,
.form-grid select,
.form-grid textarea {
    padding: 0.75rem 1rem;
    border: 1px solid var(--border);
    border-radius: 8px;
    font-size: 1rem;
    transition: all 0.3s ease;
    background: var(--light);
    font-family: var(--font-family);
}

.form-grid input:focus,
.form-grid select:focus,
.form-grid textarea:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(44, 62, 80, 0.1);
}

.form-grid input[readonly] {
    background-color: var(--primary-light);
    color: #6c757d;
}

.custom-input {
    display: flex;
    gap: 0.5rem;
}

.custom-input select {
    flex: 1;
}

.custom-input input {
    flex: 2;
}

.form-buttons {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
}

.btn {
    padding: 0.75rem 1.5rem;
    border: none;
    border-radius: 8px;
    font-size: 1rem;
    cursor: pointer;
    transition: all 0.3s ease;
    font-weight: 600;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    font-family: var(--font-family);
}

.btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.submit-btn {
    background: var(--primary);
    color: var(--light);
}

.submit-btn:hover {
    background: var(--primary-dark);
}

.cancel-btn {
    background: var(--danger);
    color: var(--light);
}

.cancel-btn:hover {
    background: #c0392b;
}

.edit-btn {
    background: var(--warning);
    color: var(--light);
    padding: 0.5rem 1rem;
    font-size: 0.875rem;
}

.delete-btn {
    background: var(--danger);
    color: var(--light);
    padding: 0.5rem 1rem;
    font-size: 0.875rem;
}

.image-upload-container {
    margin-top: 1.5rem;
    padding: 1.5rem;
    background: var(--primary-light);
    border-radius: 12px;
    border: 1px dashed var(--border);
}

.image-upload-container label {
    font-weight: 600;
    margin-bottom: 1rem;
    display: block;
    color: var(--dark);
}

.image-preview {
    max-width: 200px;
    max-height: 200px;
    border: 1px solid var(--border);
    border-radius: 8px;
    margin-top: 1rem;
    background: var(--light);
    object-fit: contain;
    display: block;
}

.image-source-selector {
    margin-bottom: 1rem;
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
}

.image-source-selector label {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-weight: normal;
    cursor: pointer;
}

.table-wrapper {
    overflow-x: auto;
    background: var(--light);
    border-radius: 12px;
    border: 1px solid var(--border);
    margin-top: 1.5rem;
    box-shadow: 0 2px 15px rgba(0,0,0,0.04);
}

.admin-table {
    width: 100%;
    border-collapse: collapse;
    min-width: 800px;
}

.admin-table th {
    background: var(--primary-light);
    padding: 1rem;
    text-align: left;
    font-weight: 600;
    color: var(--primary);
    border-bottom: 1px solid var(--border);
    font-family: var(--heading-font);
}

.admin-table td {
    padding: 1rem;
    border-bottom: 1px solid var(--border);
    vertical-align: top;
}

.admin-table tbody tr:hover {
    background: var(--primary-light);
}

.action-buttons {
    display: flex;
    gap: 0.5rem;
}

.table-image {
    width: 60px;
    height: 60px;
    object-fit: cover;
    border-radius: 8px;
    border: 1px solid var(--border);
}

.price-display {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
}

.original-price {
    text-decoration: line-through;
    color: #6c757d;
    font-size: 0.875rem;
}

.discounted-price {
    color: var(--danger);
    font-weight: 600;
}

.discount-badge {
    background: var(--danger);
    color: var(--light);
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.75rem;
    margin-left: 0.5rem;
}

.price-calculator {
    background: var(--primary-light);
    color: var(--dark);
    padding: 1.5rem;
    border-radius: 12px;
    margin-top: 1.5rem;
    border: 1px solid var(--border);
}

.price-calculator h4 {
    margin: 0 0 1rem 0;
    font-size: 1.1rem;
    color: var(--primary);
    font-family: var(--heading-font);
    font-weight: 600;
}

.price-row {
    display: flex;
    justify-content: space-between;
    margin-bottom: 0.5rem;
    padding: 0.5rem 0;
    border-bottom: 1px solid rgba(44, 62, 80, 0.1);
}

.price-label {
    font-weight: 500;
}

.bulk-actions {
    background: var(--primary-light);
    padding: 1rem 1.5rem;
    border-radius: 12px;
    margin-bottom: 1.5rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    flex-wrap: wrap;
    border: 1px solid var(--border);
}

.bulk-actions select,
.bulk-actions button {
    padding: 0.5rem 1rem;
    border-radius: 6px;
    border: 1px solid var(--border);
}

.book-details-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 0.75rem;
    margin-top: 0.5rem;
}

.detail-item {
    display: flex;
    flex-direction: column;
}

.detail-label {
    font-size: 0.75rem;
    color: #6c757d;
    margin-bottom: 0.25rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.detail-value {
    font-size: 0.875rem;
    font-weight: 500;
}

.filter-section {
    background: var(--light);
    padding: 1.5rem;
    border-radius: 12px;
    margin-bottom: 1.5rem;
    border: 1px solid var(--border);
    box-shadow: 0 2px 15px rgba(0,0,0,0.04);
}

.filter-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-bottom: 1rem;
}

.filter-buttons {
    display: flex;
    gap: 1rem;
}

.apply-filter {
    background: var(--primary);
    color: var(--light);
}

.reset-filter {
    background: #6c757d;
    color: var(--light);
}

.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    z-index: 1000;
    backdrop-filter: blur(5px);
}

.modal-content {
    background: var(--light);
    margin: 2% auto;
    padding: 2rem;
    border-radius: 12px;
    width: 95%;
    max-width: 1000px;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    animation: modalSlideIn 0.3s ease;
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid var(--border);
}

.modal-header h2 {
    font-family: var(--heading-font);
    font-weight: 600;
    border: none;
    padding: 0;
    margin: 0;
}

.close-modal {
    background: none;
    border: none;
    font-size: 1.5rem;
    cursor: pointer;
    color: #6c757d;
    padding: 0.5rem;
    border-radius: 6px;
    transition: all 0.2s ease;
}

.close-modal:hover {
    background: var(--primary-light);
    color: var(--dark);
}

#loadingBooks,
#loadingPublishers,
#loadingCategories,
#loadingBanners,
#loadingOrders {
    text-align: center;
    padding: 2rem;
    color: #6c757d;
    font-style: italic;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

@keyframes modalSlideIn {
    from { opacity: 0; transform: translateY(-50px) scale(0.9); }
    to { opacity: 1; transform: translateY(0) scale(1); }
}

@media (max-width: 1024px) {
    .sidebar {
        transform: translateX(-100%);
    }
    
    .sidebar.active {
        transform: translateX(0);
    }
    
    .main-content {
        margin-left: 0;
    }
    
    .menu-toggle {
        display: block;
        position: fixed;
        top: 1rem;
        left: 1rem;
        z-index: 101;
        background: var(--primary);
        color: var(--light);
        border: none;
        border-radius: 6px;
        padding: 0.5rem;
        cursor: pointer;
    }
    
    header {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
    }
    
    .header-title {
        text-align: left;
        width: 100%;
    }
}

@media (max-width: 768px) {
    main {
        padding: 1rem;
    }
    
    .form-section {
        padding: 1.5rem;
    }
    
    .form-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
    }
    
    .modal-content {
        margin: 5% auto;
        padding: 1.5rem;
        width: 98%;
    }
    
    .bulk-actions {
        flex-direction: column;
        align-items: stretch;
    }
    
    .filter-grid {
        grid-template-columns: 1fr;
    }
    
    .header-title h1 {
        font-size: 1.5rem;
    }
}

@media (max-width: 480px) {
    header {
        padding: 1rem;
    }
    
    header h1 {
        font-size: 1.3rem;
    }
    
    .form-buttons {
        flex-direction: column;
    }
    
    .btn {
        width: 100%;
        justify-content: center;
    }
    
    .sidebar-header {
        padding: 1.5rem 1rem;
    }
    
    .sidebar-header h1 {
        font-size: 1.3rem;
    }
}
     * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-family);
            background-color: #f8f9fa;
            color: var(--dark);
            line-height: 1.6;
            font-weight: 400;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: var(--light);
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 2px 15px rgba(0,0,0,0.04);
        }

        h1 {
            font-family: var(--heading-font);
            color: var(--primary);
            margin-bottom: 1rem;
            font-weight: 600;
        }

        .description {
            color: #6c757d;
            margin-bottom: 2rem;
        }

        .upload-section {
            margin-bottom: 2rem;
        }

        .upload-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 1.5rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-family: var(--font-family);
            text-decoration: none;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .download-btn {
            background: var(--success);
            color: var(--light);
        }

        .download-btn:hover {
            background: #219653;
        }

        .upload-btn {
            background: var(--warning);
            color: var(--light);
            cursor: pointer;
        }

        .upload-btn:hover {
            background: #e67e22;
        }

        .submit-btn {
            background: var(--primary);
            color: var(--light);
        }

        .submit-btn:hover {
            background: var(--primary-dark);
        }

        .submit-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .file-upload-wrapper {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex: 1;
        }

        .file-name {
            font-size: 0.9rem;
            color: #6c757d;
            font-style: italic;
        }

        .upload-progress {
            margin: 1.5rem 0;
            padding: 1rem;
            background: var(--primary-light);
            border-radius: 8px;
            display: none;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--border);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }

        .progress-fill {
            height: 100%;
            background: var(--success);
            border-radius: 4px;
            transition: width 0.3s ease;
            width: 0%;
        }

        .progress-text {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: var(--dark);
        }

        .upload-results {
            margin-top: 1.5rem;
            padding: 1.5rem;
            background: var(--primary-light);
            border-radius: 8px;
            border: 1px solid var(--border);
            display: none;
        }

        .results-summary {
            display: flex;
            gap: 2rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .result-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 1rem;
            border-radius: 8px;
            min-width: 100px;
        }

        .result-item.success {
            background: rgba(39, 174, 96, 0.1);
            border: 1px solid var(--success);
        }

        .result-item.failed {
            background: rgba(231, 76, 60, 0.1);
            border: 1px solid var(--danger);
        }

        .result-item.skipped {
            background: rgba(243, 156, 18, 0.1);
            border: 1px solid var(--warning);
        }

        .result-count {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .result-item.success .result-count {
            color: var(--success);
        }

        .result-item.failed .result-count {
            color: var(--danger);
        }

        .result-item.skipped .result-count {
            color: var(--warning);
        }

        .results-details {
            max-height: 300px;
            overflow-y: auto;
        }

        .result-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            border-radius: 6px;
            background: var(--light);
        }

        .result-row.success {
            border-left: 4px solid var(--success);
        }

        .result-row.failed {
            border-left: 4px solid var(--danger);
        }

        .result-row.skipped {
            border-left: 4px solid var(--warning);
        }

        .result-info {
            flex: 1;
        }

        .result-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .result-message {
            font-size: 0.85rem;
            color: #6c757d;
        }

        .result-status {
            font-size: 0.8rem;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-weight: 600;
        }

        .result-status.success {
            background: var(--success);
            color: var(--light);
        }

        .result-status.failed {
            background: var(--danger);
            color: var(--light);
        }

        .result-status.skipped {
            background: var(--warning);
            color: var(--light);
        }

        .instructions {
            background: var(--primary-light);
            padding: 1.5rem;
            border-radius: 8px;
            margin-top: 2rem;
        }

        .instructions h3 {
            color: var(--primary);
            margin-bottom: 1rem;
        }

        .instructions ul {
            padding-left: 1.5rem;
        }

        .instructions li {
            margin-bottom: 0.5rem;
        }

        .instructions strong {
            color: var(--primary);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .upload-actions {
                flex-direction: column;
                align-items: stretch;
            }
            
            .file-upload-wrapper {
                justify-content: space-between;
            }
            
            .results-summary {
                justify-content: center;
            }
            
            .result-item {
                min-width: 80px;
                padding: 0.75rem;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h1>Panel Admin</h1>
                <p>Toko Buku Islam</p>
            </div>
            <nav class="sidebar-nav">
                <button class="nav-btn active" data-section="books" data-lang-key="menu-books">Buku</button>
                <button class="nav-btn" data-section="publishers" data-lang-key="menu-publishers">Penerbit</button>
                <button class="nav-btn" data-section="categories" data-lang-key="menu-categories">Kategori</button>
                <button class="nav-btn" data-section="banners" data-lang-key="menu-banners">Banner</button>
                <button class="nav-btn" data-section="orders" data-lang-key="menu-orders">Pesanan</button>
                <button class="nav-btn" data-section="currency" data-lang-key="menu-currency">Kurs</button>
            </nav>
        </aside>
        
        <main class="main-content">
            <button class="menu-toggle" id="menuToggle" style="display: none;">☰ Menu</button>
            
            <header>
                <div class="header-title">
                    <h1 data-lang-key="dashboard-title">Panel Admin - Toko Buku Islam</h1>
                    <p data-lang-key="dashboard-subtitle">Kelola data buku, penerbit, kategori, dan banner dengan mudah</p>
                </div>
                <div class="header-actions">
                    <div class="language-selector">
                        <button class="language-btn" id="languageBtn">
                            <span id="currentLangFlag">🇮🇩</span>
                            <span id="currentLangText">Indonesia</span>
                            <span>▼</span>
                        </button>
                        <div class="language-dropdown" id="languageDropdown">
                            <div class="language-option active" data-lang="id">
                                <span>🇮🇩</span>
                                <span>Indonesia</span>
                            </div>
                            <div class="language-option" data-lang="en">
                                <span>🇬🇧</span>
                                <span>English</span>
                            </div>
                            <div class="language-option" data-lang="ar">
                                <span>🇸🇦</span>
                                <span>العربية</span>
                            </div>
                        </div>
                    </div>
                </div>
            </header>
               <div class="container">
        <h1>Upload Buku via Excel</h1>
        <p class="description">Upload data buku secara massal menggunakan file Excel. Unduh template terlebih dahulu untuk memastikan format yang benar.</p>
        
        <div class="upload-section">
            <div class="upload-actions">
                <button type="button" class="btn download-btn" id="downloadTemplate">
                    📥 Unduh Template Excel
                </button>
                <div class="file-upload-wrapper">
                    <input type="file" id="excelFile" accept=".xlsx, .xls" style="display: none;">
                    <label for="excelFile" class="btn upload-btn">
                        📤 Upload File Excel
                    </label>
                    <span id="fileName" class="file-name">Belum ada file dipilih</span>
                </div>
                <button type="button" class="btn submit-btn" id="processExcel" disabled>
                    🔄 Proses Data
                </button>
            </div>
            
            <div class="upload-progress" id="uploadProgress">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-text">
                    <span id="progressStatus">Memproses...</span>
                    <span id="progressCount">0/0</span>
                </div>
            </div>
            
            <div class="upload-results" id="uploadResults">
                <h3>Hasil Upload</h3>
                <div class="results-summary">
                    <div class="result-item success">
                        <span class="result-count" id="successCount">0</span>
                        <span>Berhasil</span>
                    </div>
                    <div class="result-item failed">
                        <span class="result-count" id="failedCount">0</span>
                        <span>Gagal</span>
                    </div>
                    <div class="result-item skipped">
                        <span class="result-count" id="skippedCount">0</span>
                        <span>Dilewati</span>
                    </div>
                </div>
                <div class="results-details" id="resultsDetails">
                    <!-- Detail hasil akan ditampilkan di sini -->
                </div>
            </div>
        </div>

        <div class="instructions">
            <h3>Petunjuk Penggunaan</h3>
            <ul>
                <li><strong>Judul Buku*</strong> - Wajib diisi. Judul lengkap buku</li>
                <li><strong>Penulis*</strong> - Wajib diisi. Nama penulis buku</li>
                <li><strong>Harga Asli (USD)*</strong> - Wajib diisi. Harga asli dalam USD (angka)</li>
                <li><strong>Harga Dasar (USD)*</strong> - Wajib diisi. Harga dasar dalam USD (angka)</li>
                <li><strong>Penerbit</strong> - Nama penerbit harus sudah terdaftar di sistem</li>
                <li><strong>Kategori</strong> - Nama kategori harus sudah terdaftar di sistem</li>
                <li><strong>Diskon</strong> - Format: 10% atau 0.1 (opsional)</li>
                <li><strong>Jilid</strong> - Jumlah jilid (opsional)</li>
                <li><strong>Halaman</strong> - Jumlah halaman (opsional)</li>
                <li><strong>Tahun Terbit</strong> - Tahun terbit (opsional)</li>
                <li><strong>Berat Nilai</strong> - Nilai berat (angka, opsional)</li>
                <li><strong>Berat Satuan</strong> - Satuan berat: kg, g, ons, lb (opsional)</li>
                <li><strong>Warna Tulisan</strong> - Warna teks buku (opsional)</li>
                <li><strong>Jenis Cover</strong> - Jenis sampul buku (opsional)</li>
                <li><strong>Jenis Kertas</strong> - Jenis kertas buku (opsional)</li>
                <li><strong>Cetakan Ke</strong> - Angka cetakan (opsional)</li>
                <li><strong>Editor</strong> - Nama editor (opsional)</li>
                <li><strong>Deskripsi</strong> - Deskripsi buku (opsional)</li>
                <li><strong>URL Gambar Sampul</strong> - URL gambar sampul buku (opsional)</li>
            </ul>
            <p style="margin-top: 1rem; font-style: italic;">* Field wajib diisi</p>
        </div>
    </div>
            <section id="books-section" class="content-section active">
                <div class="form-section">
                    <h2 id="booksFormTitle" data-lang-key="add-book-title">Tambah Buku Baru</h2>
                    <form id="bookForm">
                        <input type="hidden" id="bookId">
                        <input type="hidden" id="bookOldCoverUrl">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="bookTitle" data-lang-key="book-title">Judul Buku</label>
                                <input type="text" id="bookTitle" placeholder="Masukkan judul buku" required>
                            </div>
                            <div class="form-group">
                                <label for="bookAuthor" data-lang-key="book-author">Penulis</label>
                                <input type="text" id="bookAuthor" placeholder="Nama penulis" required>
                            </div>
                            <div class="form-group">
                                <label for="bookOriginalPrice" data-lang-key="book-original-price">Harga Asli (USD)</label>
                                <input type="number" step="0.01" id="bookOriginalPrice" placeholder="0.00" required>
                            </div>
                            <div class="form-group">
                                <label for="bookBasePrice" data-lang-key="book-base-price">Harga Dasar (USD)</label>
                                <input type="number" step="0.01" id="bookBasePrice" placeholder="0.00" required>
                            </div>
                            <div class="form-group">
                                <label for="bookPublisherSelect" data-lang-key="book-publisher">Penerbit</label>
                                <select id="bookPublisherSelect">
                                    <option value="">-- Pilih Penerbit --</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="bookCategorySelect" data-lang-key="book-category">Kategori</label>
                                <select id="bookCategorySelect">
                                    <option value="">-- Pilih Kategori --</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="bookDiscount" data-lang-key="book-discount">Diskon</label>
                                <input type="text" id="bookDiscount" placeholder="Contoh: 10%">
                            </div>
                            <div class="form-group">
                                <label for="bookVolumes" data-lang-key="book-volumes">Jilid</label>
                                <input type="text" id="bookVolumes" placeholder="Jumlah jilid">
                            </div>
                            <div class="form-group">
                                <label for="bookPages" data-lang-key="book-pages">Halaman</label>
                                <input type="text" id="bookPages" placeholder="Jumlah halaman">
                            </div>
                            <div class="form-group">
                                <label for="bookYear" data-lang-key="book-year">Tahun Terbit</label>
                                <input type="text" id="bookYear" placeholder="Tahun terbit">
                            </div>
                            <div class="form-group">
                                <label for="bookWeight" data-lang-key="book-weight">Berat Buku</label>
                                <div class="custom-input">
                                    <input type="number" step="0.01" id="bookWeightValue" placeholder="Nilai berat">
                                    <select id="bookWeightUnit">
                                        <option value="kg">kg</option>
                                        <option value="g">g</option>
                                        <option value="ons">ons</option>
                                        <option value="lb">lb</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label data-lang-key="book-text-color">Warna Tulisan</label>
                                <div class="custom-input">
                                    <select id="bookTextColorSelect">
                                        <option value="">-- Pilih --</option>
                                        <option value="Hitam">Hitam</option>
                                        <option value="Biru">Biru</option>
                                        <option value="Hijau">Hijau</option>
                                        <option value="Merah">Merah</option>
                                        <option value="Coklat">Coklat</option>
                                        <option value="Ungu">Ungu</option>
                                    </select>
                                    <input type="text" id="bookTextColorInput" placeholder="Ketik manual">
                                </div>
                            </div>
                            <div class="form-group">
                                <label data-lang-key="book-cover-type">Jenis Cover</label>
                                <div class="custom-input">
                                    <select id="bookCoverTypeSelect">
                                        <option value="">-- Pilih --</option>
                                        <option value="Hard Cover">Hard Cover</option>
                                        <option value="Soft Cover">Soft Cover</option>
                                        <option value="Flexi Cover">Flexi Cover</option>
                                        <option value="Spiral">Spiral</option>
                                    </select>
                                    <input type="text" id="bookCoverTypeInput" placeholder="Ketik manual">
                                </div>
                            </div>
                            <div class="form-group">
                                <label data-lang-key="book-paper-type">Jenis Kertas</label>
                                <div class="custom-input">
                                    <select id="bookPaperTypeSelect">
                                        <option value="">-- Pilih --</option>
                                        <option value="HVS">HVS</option>
                                        <option value="Art Paper">Art Paper</option>
                                        <option value="Book Paper">Book Paper</option>
                                        <option value="Matt Paper">Matt Paper</option>
                                        <option value="Glossy Paper">Glossy Paper</option>
                                    </select>
                                    <input type="text" id="bookPaperTypeInput" placeholder="Ketik manual">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="bookPrintCount" data-lang-key="book-print-count">Cetakan Ke</label>
                                <input type="number" id="bookPrintCount" placeholder="Angka cetakan">
                            </div>
                            <div class="form-group">
                                <label for="bookEditor" data-lang-key="book-editor">Editor</label>
                                <input type="text" id="bookEditor" placeholder="Nama editor">
                            </div>
                            <div class="form-group" style="grid-column: 1 / -1;">
                                <label for="bookDescription" data-lang-key="book-description">Deskripsi Buku</label>
                                <textarea id="bookDescription" placeholder="Deskripsi lengkap buku" rows="4"></textarea>
                            </div>
                        </div>
                        
                        <div class="price-calculator">
                            <h4 data-lang-key="price-calculator">Kalkulator Harga Setelah Diskon</h4>
                            <div class="price-row">
                                <span class="price-label" data-lang-key="base-price-usd">Harga Dasar (USD):</span>
                                <span id="displayBasePriceUSD">$0.00</span>
                            </div>
                            <div class="price-row">
                                <span class="price-label" data-lang-key="discount">Diskon:</span>
                                <span id="displayDiscountPercent">0%</span>
                            </div>
                            <div class="price-row">
                                <span class="price-label" data-lang-key="final-price-usd">Harga Setelah Diskon (USD):</span>
                                <span id="displayFinalPriceUSD" class="discounted-price">$0.00</span>
                            </div>
                            <div class="price-row">
                                <span class="price-label" data-lang-key="final-price-idr">Harga Setelah Diskon (IDR):</span>
                                <span id="displayFinalPriceIDR" class="discounted-price">Rp 0</span>
                            </div>
                            <div class="price-row">
                                <span class="price-label" data-lang-key="final-price-egp">Harga Setelah Diskon (EGP):</span>
                                <span id="displayFinalPriceEGP" class="discounted-price">E£ 0</span>
                            </div>
                        </div>
                        
                        <div class="image-upload-container">
                            <label data-lang-key="book-cover">Sampul Buku</label>
                            <div class="image-source-selector">
                                <label><input type="radio" name="bookImageSource" value="upload" checked> <span data-lang-key="upload-file">Unggah File</span></label>
                                <label><input type="radio" name="bookImageSource" value="url"> <span data-lang-key="use-url">Gunakan URL</span></label>
                            </div>
                            <input type="file" id="bookCoverImageFile" accept="image/*">
                            <input type="url" id="bookCoverImageUrl" placeholder="Masukkan URL gambar" style="display:none;">
                            <img id="bookImagePreview" class="image-preview" src="" alt="Preview Sampul" style="display:none;">
                        </div>
                        
                        <div class="form-buttons">
                            <button type="submit" class="btn submit-btn" data-lang-key="save-book">Simpan Buku</button>
                            <button type="button" class="btn cancel-btn" id="cancelEditBook" style="display:none;" data-lang-key="cancel-edit">Batal Edit</button>
                        </div>
                    </form>
                </div>

                <div class="filter-section">
                    <h3 data-lang-key="filter-search">Filter dan Pencarian Buku</h3>
                    <div class="filter-grid">
                        <div class="form-group">
                            <label for="searchTitle" data-lang-key="search-title">Cari Judul</label>
                            <input type="text" id="searchTitle" placeholder="Kata kunci judul...">
                        </div>
                        <div class="form-group">
                            <label for="searchAuthor" data-lang-key="search-author">Cari Penulis</label>
                            <input type="text" id="searchAuthor" placeholder="Nama penulis...">
                        </div>
                        <div class="form-group">
                            <label for="filterPublisher" data-lang-key="filter-publisher">Penerbit</label>
                            <select id="filterPublisher">
                                <option value="">Semua Penerbit</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="filterCategory" data-lang-key="filter-category">Kategori</label>
                            <select id="filterCategory">
                                <option value="">Semua Kategori</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="filterCoverType" data-lang-key="filter-cover-type">Jenis Cover</label>
                            <input type="text" id="filterCoverType" placeholder="Jenis cover...">
                        </div>
                        <div class="form-group">
                            <label for="filterPaperType" data-lang-key="filter-paper-type">Jenis Kertas</label>
                            <input type="text" id="filterPaperType" placeholder="Jenis kertas...">
                        </div>
                    </div>
                    <div class="filter-buttons">
                        <button class="btn apply-filter" id="applyFilter" data-lang-key="apply-filter">Terapkan Filter</button>
                        <button class="btn reset-filter" id="resetFilter" data-lang-key="reset-filter">Reset Filter</button>
                    </div>
                </div>

                <div class="bulk-actions">
                    <strong data-lang-key="bulk-actions">Aksi Massal:</strong>
                    <select id="bulkAction">
                        <option value="" data-lang-key="select-action">Pilih Aksi</option>
                        <option value="delete" data-lang-key="delete-books">Hapus Buku</option>
                    </select>
                    <button id="applyBulkAction" class="btn submit-btn" data-lang-key="apply">Terapkan</button>
                    <span id="selectedCount">0 buku terpilih</span>
                </div>

                <h2 data-lang-key="book-list">Daftar Buku</h2>
                <div class="table-wrapper">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th width="40"><input type="checkbox" id="selectAll"></th>
                                <th width="80" data-lang-key="table-image">Gambar</th>
                                <th data-lang-key="table-book-info">Informasi Buku</th>
                                <th data-lang-key="table-details">Detail</th>
                                <th data-lang-key="table-weight">Berat</th>
                                <th data-lang-key="table-price-usd">Harga USD</th>
                                <th data-lang-key="table-price-idr">Harga IDR</th>
                                <th data-lang-key="table-price-egp">Harga EGP</th>
                                <th width="80" data-lang-key="table-discount">Diskon</th>
                                <th width="120" data-lang-key="table-actions">Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="booksTableBody"></tbody>
                    </table>
                    <p id="loadingBooks" data-lang-key="loading-books">Memuat data buku...</p>
                </div>
            </section>

            <section id="publishers-section" class="content-section">
                <div class="form-section">
                    <h2 id="publishersFormTitle" data-lang-key="add-publisher-title">Tambah Penerbit Baru</h2>
                    <form id="publisherForm">
                        <input type="hidden" id="publisherId">
                        <input type="hidden" id="publisherOldLogoUrl">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="publisherName" data-lang-key="publisher-name">Nama Penerbit</label>
                                <input type="text" id="publisherName" placeholder="Nama penerbit" required>
                            </div>
                            <div class="form-group">
                                <label for="publisherLetter" data-lang-key="publisher-letter">Huruf</label>
                                <input type="text" id="publisherLetter" placeholder="Huruf penerbit" required>
                            </div>
                            <div class="form-group">
                                <label for="publisherDiscount" data-lang-key="publisher-discount">Diskon</label>
                                <input type="text" id="publisherDiscount" placeholder="Contoh: 10%">
                            </div>
                        </div>
                        <div class="image-upload-container">
                            <label for="publisherLogoFile" data-lang-key="publisher-logo">Logo Penerbit</label>
                            <input type="file" id="publisherLogoFile" accept="image/*">
                            <img id="publisherImagePreview" class="image-preview" src="" alt="Preview Logo" style="display:none;">
                        </div>
                        <div class="form-buttons">
                            <button type="submit" class="btn submit-btn" data-lang-key="save-publisher">Simpan Penerbit</button>
                            <button type="button" class="btn cancel-btn" id="cancelEditPublisher" style="display:none;" data-lang-key="cancel-edit">Batal Edit</button>
                        </div>
                    </form>
                </div>
                <h2 data-lang-key="publisher-list">Daftar Penerbit</h2>
                <div class="table-wrapper">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th width="80" data-lang-key="table-logo">Logo</th>
                                <th data-lang-key="table-name">Nama</th>
                                <th width="80" data-lang-key="table-letter">Huruf</th>
                                <th width="100" data-lang-key="table-discount">Diskon</th>
                                <th width="120" data-lang-key="table-actions">Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="publishersTableBody"></tbody>
                    </table>
                    <p id="loadingPublishers" data-lang-key="loading-publishers">Memuat data penerbit...</p>
                </div>
            </section>

            <section id="categories-section" class="content-section">
                <div class="form-section">
                    <h2 id="categoriesFormTitle" data-lang-key="add-category-title">Tambah Kategori Baru</h2>
                    <form id="categoryForm">
                        <input type="hidden" id="categoryId">
                        <input type="hidden" id="categoryOldImageUrl">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="categoryNameId" data-lang-key="category-name-id">Nama (ID)</label>
                                <input type="text" id="categoryNameId" placeholder="Nama dalam Bahasa Indonesia" required>
                            </div>
                            <div class="form-group">
                                <label for="categoryNameEn" data-lang-key="category-name-en">Nama (EN)</label>
                                <input type="text" id="categoryNameEn" placeholder="Nama dalam Bahasa Inggris" required>
                            </div>
                            <div class="form-group">
                                <label for="categoryNameAr" data-lang-key="category-name-ar">Nama (AR)</label>
                                <input type="text" id="categoryNameAr" placeholder="Nama dalam Bahasa Arab" required>
                            </div>
                            <div class="form-group">
                                <label for="categoryColor" data-lang-key="category-color">Warna</label>
                                <input type="color" id="categoryColor" value="#3498db">
                            </div>
                            <div class="form-group">
                                <label for="categoryLink" data-lang-key="category-link">Link Kategori</label>
                                <input type="text" id="categoryLink" placeholder="Link akan dibuat otomatis" readonly>
                            </div>
                        </div>
                        <div class="image-upload-container">
                            <label for="categoryImageFile" data-lang-key="category-image">Gambar Kategori</label>
                            <input type="file" id="categoryImageFile" accept="image/*">
                            <img id="categoryImagePreview" class="image-preview" src="" alt="Preview Gambar" style="display:none;">
                        </div>
                        <div class="form-buttons">
                            <button type="submit" class="btn submit-btn" data-lang-key="save-category">Simpan Kategori</button>
                            <button type="button" class="btn cancel-btn" id="cancelEditCategory" style="display:none;" data-lang-key="cancel-edit">Batal Edit</button>
                        </div>
                    </form>
                </div>
                <h2 data-lang-key="category-list">Daftar Kategori</h2>
                <div class="table-wrapper">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th width="80" data-lang-key="table-image">Gambar</th>
                                <th data-lang-key="table-name-id">Nama (ID)</th>
                                <th data-lang-key="table-name-en">Nama (EN)</th>
                                <th width="100" data-lang-key="table-color">Warna</th>
                                <th data-lang-key="table-link">Link</th>
                                <th width="120" data-lang-key="table-actions">Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="categoriesTableBody"></tbody>
                    </table>
                    <p id="loadingCategories" data-lang-key="loading-categories">Memuat data kategori...</p>
                </div>
            </section>

            <section id="banners-section" class="content-section">
                <div class="form-section">
                    <h2 id="bannersFormTitle" data-lang-key="add-banner-title">Tambah Banner Baru</h2>
                    <form id="bannerForm">
                        <input type="hidden" id="bannerId">
                        <input type="hidden" id="bannerOldImageUrl">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="bannerTitle" data-lang-key="banner-title">Judul Banner</label>
                                <input type="text" id="bannerTitle" placeholder="Judul banner" required>
                            </div>
                            <div class="form-group">
                                <label for="bannerType" data-lang-key="banner-type">Tipe</label>
                                <input type="text" id="bannerType" placeholder="Contoh: promo, utama" required>
                            </div>
                            <div class="form-group">
                                <label for="bannerDisplayOrder" data-lang-key="banner-order">Urutan Tampil</label>
                                <input type="number" id="bannerDisplayOrder" placeholder="Angka urutan">
                            </div>
                        </div>
                        <div class="image-upload-container">
                            <label for="bannerImageFile" data-lang-key="banner-image">Gambar Banner</label>
                            <input type="file" id="bannerImageFile" accept="image/*">
                            <img id="bannerImagePreview" class="image-preview" src="" alt="Preview Gambar" style="display:none;">
                        </div>
                        <div class="form-buttons">
                            <button type="submit" class="btn submit-btn" data-lang-key="save-banner">Simpan Banner</button>
                            <button type="button" class="btn cancel-btn" id="cancelEditBanner" style="display:none;" data-lang-key="cancel-edit">Batal Edit</button>
                        </div>
                    </form>
                </div>
                <h2 data-lang-key="banner-list">Daftar Banner</h2>
                <div class="table-wrapper">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th width="100" data-lang-key="table-image">Gambar</th>
                                <th data-lang-key="table-title">Judul</th>
                                <th width="120" data-lang-key="table-type">Tipe</th>
                                <th width="100" data-lang-key="table-order">Urutan</th>
                                <th width="120" data-lang-key="table-actions">Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="bannersTableBody"></tbody>
                    </table>
                    <p id="loadingBanners" data-lang-key="loading-banners">Memuat data banner...</p>
                </div>
            </section>

            <section id="orders-section" class="content-section">
                <h2 data-lang-key="order-list">Daftar Pesanan</h2>
                <div class="table-wrapper">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th data-lang-key="table-customer-name">Nama Pelanggan</th>
                                <th data-lang-key="table-book">Buku</th>
                                <th width="120" data-lang-key="table-total-idr">Total (IDR)</th>
                                <th width="100" data-lang-key="table-status">Status</th>
                                <th width="150" data-lang-key="table-date">Tanggal</th>
                            </tr>
                        </thead>
                        <tbody id="ordersTableBody"></tbody>
                    </table>
                    <p id="loadingOrders" data-lang-key="loading-orders">Memuat data pesanan...</p>
                </div>
            </section>

            <section id="currency-section" class="content-section">
                <div class="form-section">
                    <h2 data-lang-key="currency-settings">Pengaturan Kurs Mata Uang</h2>
                    <p data-lang-key="currency-description">Harga dasar produk disimpan dalam USD. Atur kurs di sini untuk mengonversi harga saat ditampilkan.</p>
                    <form id="currencyForm">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="usdToIdr" data-lang-key="usd-to-idr">USD ke IDR</label>
                                <input type="number" id="usdToIdr" placeholder="Kurs USD ke Rupiah" required>
                            </div>
                            <div class="form-group">
                                <label for="usdToEgp" data-lang-key="usd-to-egp">USD ke EGP</label>
                                <input type="number" id="usdToEgp" placeholder="Kurs USD ke Pound Mesir" required>
                            </div>
                        </div>
                        <div class="form-buttons">
                            <button type="submit" class="btn submit-btn" data-lang-key="save-settings">Simpan Pengaturan</button>
                        </div>
                    </form>
                </div>
            </section>
        </main>
    </div>

    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 data-lang-key="edit-book-title">Edit Buku - Semua Data</h2>
                <button class="close-modal">&times;</button>
            </div>
            <form id="editBookForm">
                <input type="hidden" id="editBookId">
                <input type="hidden" id="editBookOldCoverUrl">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="editBookTitle" data-lang-key="book-title">Judul Buku</label>
                        <input type="text" id="editBookTitle" placeholder="Masukkan judul buku" required>
                    </div>
                    <div class="form-group">
                        <label for="editBookAuthor" data-lang-key="book-author">Penulis</label>
                        <input type="text" id="editBookAuthor" placeholder="Nama penulis" required>
                    </div>
                    <div class="form-group">
                        <label for="editBookOriginalPrice" data-lang-key="book-original-price">Harga Asli (USD)</label>
                        <input type="number" step="0.01" id="editBookOriginalPrice" placeholder="0.00" required>
                    </div>
                    <div class="form-group">
                        <label for="editBookBasePrice" data-lang-key="book-base-price">Harga Dasar (USD)</label>
                        <input type="number" step="0.01" id="editBookBasePrice" placeholder="0.00" required>
                    </div>
                    <div class="form-group">
                        <label for="editBookPublisherSelect" data-lang-key="book-publisher">Penerbit</label>
                        <select id="editBookPublisherSelect">
                            <option value="">-- Pilih Penerbit --</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editBookCategorySelect" data-lang-key="book-category">Kategori</label>
                        <select id="editBookCategorySelect">
                            <option value="">-- Pilih Kategori --</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editBookDiscount" data-lang-key="book-discount">Diskon</label>
                        <input type="text" id="editBookDiscount" placeholder="Contoh: 10%">
                    </div>
                    <div class="form-group">
                        <label for="editBookVolumes" data-lang-key="book-volumes">Jilid</label>
                        <input type="text" id="editBookVolumes" placeholder="Jumlah jilid">
                    </div>
                    <div class="form-group">
                        <label for="editBookPages" data-lang-key="book-pages">Halaman</label>
                        <input type="text" id="editBookPages" placeholder="Jumlah halaman">
                    </div>
                    <div class="form-group">
                        <label for="editBookYear" data-lang-key="book-year">Tahun Terbit</label>
                        <input type="text" id="editBookYear" placeholder="Tahun terbit">
                    </div>
                    <div class="form-group">
                        <label for="editBookWeight" data-lang-key="book-weight">Berat Buku</label>
                        <div class="custom-input">
                            <input type="number" step="0.01" id="editBookWeightValue" placeholder="Nilai berat">
                            <select id="editBookWeightUnit">
                                <option value="kg">kg</option>
                                <option value="g">g</option>
                                <option value="ons">ons</option>
                                <option value="lb">lb</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label data-lang-key="book-text-color">Warna Tulisan</label>
                        <div class="custom-input">
                            <select id="editBookTextColorSelect">
                                <option value="">-- Pilih --</option>
                                <option value="Hitam">Hitam</option>
                                <option value="Biru">Biru</option>
                                <option value="Hijau">Hijau</option>
                                <option value="Merah">Merah</option>
                                <option value="Coklat">Coklat</option>
                                <option value="Ungu">Ungu</option>
                            </select>
                            <input type="text" id="editBookTextColorInput" placeholder="Ketik manual">
                        </div>
                    </div>
                    <div class="form-group">
                        <label data-lang-key="book-cover-type">Jenis Cover</label>
                        <div class="custom-input">
                            <select id="editBookCoverTypeSelect">
                                <option value="">-- Pilih --</option>
                                <option value="Hard Cover">Hard Cover</option>
                                <option value="Soft Cover">Soft Cover</option>
                                <option value="Flexi Cover">Flexi Cover</option>
                                <option value="Spiral">Spiral</option>
                            </select>
                            <input type="text" id="editBookCoverTypeInput" placeholder="Ketik manual">
                        </div>
                    </div>
                    <div class="form-group">
                        <label data-lang-key="book-paper-type">Jenis Kertas</label>
                        <div class="custom-input">
                            <select id="editBookPaperTypeSelect">
                                <option value="">-- Pilih --</option>
                                <option value="HVS">HVS</option>
                                <option value="Art Paper">Art Paper</option>
                                <option value="Book Paper">Book Paper</option>
                                <option value="Matt Paper">Matt Paper</option>
                                <option value="Glossy Paper">Glossy Paper</option>
                            </select>
                            <input type="text" id="editBookPaperTypeInput" placeholder="Ketik manual">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="editBookPrintCount" data-lang-key="book-print-count">Cetakan Ke</label>
                        <input type="number" id="editBookPrintCount" placeholder="Angka cetakan">
                    </div>
                    <div class="form-group">
                        <label for="editBookEditor" data-lang-key="book-editor">Editor</label>
                        <input type="text" id="editBookEditor" placeholder="Nama editor">
                    </div>
                    <div class="form-group" style="grid-column: 1 / -1;">
                        <label for="editBookDescription" data-lang-key="book-description">Deskripsi Buku</label>
                        <textarea id="editBookDescription" placeholder="Deskripsi lengkap buku" rows="4"></textarea>
                    </div>
                </div>
                
                <div class="price-calculator">
                    <h4 data-lang-key="price-calculator">Kalkulator Harga Setelah Diskon</h4>
                    <div class="price-row">
                        <span class="price-label" data-lang-key="base-price-usd">Harga Dasar (USD):</span>
                        <span id="editDisplayBasePriceUSD">$0.00</span>
                    </div>
                    <div class="price-row">
                        <span class="price-label" data-lang-key="discount">Diskon:</span>
                        <span id="editDisplayDiscountPercent">0%</span>
                    </div>
                    <div class="price-row">
                        <span class="price-label" data-lang-key="final-price-usd">Harga Setelah Diskon (USD):</span>
                        <span id="editDisplayFinalPriceUSD" class="discounted-price">$0.00</span>
                    </div>
                    <div class="price-row">
                        <span class="price-label" data-lang-key="final-price-idr">Harga Setelah Diskon (IDR):</span>
                        <span id="editDisplayFinalPriceIDR" class="discounted-price">Rp 0</span>
                    </div>
                    <div class="price-row">
                        <span class="price-label" data-lang-key="final-price-egp">Harga Setelah Diskon (EGP):</span>
                        <span id="editDisplayFinalPriceEGP" class="discounted-price">E£ 0</span>
                    </div>
                </div>
                
                <div class="image-upload-container">
                    <label data-lang-key="book-cover">Sampul Buku</label>
                    <div class="image-source-selector">
                        <label><input type="radio" name="editBookImageSource" value="upload" checked> <span data-lang-key="upload-file">Unggah File</span></label>
                        <label><input type="radio" name="editBookImageSource" value="url"> <span data-lang-key="use-url">Gunakan URL</span></label>
                    </div>
                    <input type="file" id="editBookCoverImageFile" accept="image/*">
                    <input type="url" id="editBookCoverImageUrl" placeholder="Masukkan URL gambar" style="display:none;">
                    <img id="editBookImagePreview" class="image-preview" src="" alt="Preview Sampul" style="display:none;">
                </div>
                
                <div class="form-buttons">
                    <button type="submit" class="btn submit-btn" data-lang-key="update-book">Perbarui Buku</button>
                    <button type="button" class="btn cancel-btn" id="cancelEditModal" data-lang-key="cancel">Batal</button>
                </div>
            </form>
        </div>
    </div>
     <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
           // DOM Elements
        const downloadTemplateBtn = document.getElementById('downloadTemplate');
        const excelFileInput = document.getElementById('excelFile');
        const fileNameSpan = document.getElementById('fileName');
        const processExcelBtn = document.getElementById('processExcel');
        const uploadProgress = document.getElementById('uploadProgress');
        const progressFill = document.getElementById('progressFill');
        const progressStatus = document.getElementById('progressStatus');
        const progressCount = document.getElementById('progressCount');
        const uploadResults = document.getElementById('uploadResults');
        const successCount = document.getElementById('successCount');
        const failedCount = document.getElementById('failedCount');
        const skippedCount = document.getElementById('skippedCount');
        const resultsDetails = document.getElementById('resultsDetails');

        // Download Excel Template
        downloadTemplateBtn.addEventListener('click', downloadExcelTemplate);

        function downloadExcelTemplate() {
            try {
                // Create workbook
                const wb = XLSX.utils.book_new();
                
                // Define template data
                const templateData = [
                    {
                        'Judul Buku': 'Buku Panduan Shalat Lengkap',
                        'Penulis': 'Ustadz Ahmad',
                        'Harga Asli (USD)': '25.00',
                        'Harga Dasar (USD)': '20.00',
                        'Penerbit': 'Pustaka Muslim',
                        'Kategori': 'Fiqih',
                        'Diskon': '10%',
                        'Jilid': '1',
                        'Halaman': '300',
                        'Tahun Terbit': '2023',
                        'Berat Nilai': '0.5',
                        'Berat Satuan': 'kg',
                        'Warna Tulisan': 'Hitam',
                        'Jenis Cover': 'Hard Cover',
                        'Jenis Kertas': 'HVS',
                        'Cetakan Ke': '1',
                        'Editor': 'Editor Islam',
                        'Deskripsi': 'Buku panduan shalat lengkap untuk pemula dan lanjutan',
                        'URL Gambar Sampul': 'https://example.com/shalat.jpg'
                    },
                    {
                        'Judul Buku': 'Tafsir Al-Quran Jilid 1',
                        'Penulis': 'Dr. Muhammad Ali',
                        'Harga Asli (USD)': '30.00',
                        'Harga Dasar (USD)': '25.00',
                        'Penerbit': 'Penerbit Quran',
                        'Kategori': 'Tafsir',
                        'Diskon': '15%',
                        'Jilid': '1',
                        'Halaman': '450',
                        'Tahun Terbit': '2022',
                        'Berat Nilai': '0.8',
                        'Berat Satuan': 'kg',
                        'Warna Tulisan': 'Hitam',
                        'Jenis Cover': 'Hard Cover',
                        'Jenis Kertas': 'Book Paper',
                        'Cetakan Ke': '2',
                        'Editor': 'Tim Editor Quran',
                        'Deskripsi': 'Tafsir Al-Quran jilid pertama dengan penjelasan mendalam',
                        'URL Gambar Sampul': 'https://example.com/tafsir.jpg'
                    }
                ];
                
                // Create worksheet
                const ws = XLSX.utils.json_to_sheet(templateData);
                
                // Set column widths
                const colWidths = [
                    { wch: 25 }, // Judul Buku
                    { wch: 20 }, // Penulis
                    { wch: 15 }, // Harga Asli
                    { wch: 15 }, // Harga Dasar
                    { wch: 20 }, // Penerbit
                    { wch: 15 }, // Kategori
                    { wch: 10 }, // Diskon
                    { wch: 8 },  // Jilid
                    { wch: 10 }, // Halaman
                    { wch: 12 }, // Tahun Terbit
                    { wch: 12 }, // Berat Nilai
                    { wch: 12 }, // Berat Satuan
                    { wch: 15 }, // Warna Tulisan
                    { wch: 15 }, // Jenis Cover
                    { wch: 15 }, // Jenis Kertas
                    { wch: 12 }, // Cetakan Ke
                    { wch: 15 }, // Editor
                    { wch: 30 }, // Deskripsi
                    { wch: 30 }  // URL Gambar Sampul
                ];
                ws['!cols'] = colWidths;
                
                // Add worksheet to workbook
                XLSX.utils.book_append_sheet(wb, ws, 'Template Buku');
                
                // Download the file
                XLSX.writeFile(wb, 'Template_Upload_Buku.xlsx');
                
                alert('Template berhasil diunduh! Silakan isi data buku Anda.');
            } catch (error) {
                console.error('Error downloading template:', error);
                alert('Terjadi kesalahan saat mengunduh template. Silakan coba lagi.');
            }
        }

        // File selection handler
        excelFileInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                fileNameSpan.textContent = file.name;
                fileNameSpan.style.color = 'var(--dark)';
                processExcelBtn.disabled = false;
            } else {
                fileNameSpan.textContent = 'Belum ada file dipilih';
                fileNameSpan.style.color = '#6c757d';
                processExcelBtn.disabled = true;
            }
        });

        // Process Excel data
        processExcelBtn.addEventListener('click', processExcelFile);

        async function processExcelFile() {
            const file = excelFileInput.files[0];
            if (!file) return;
            
            // Reset results
            resetUploadResults();
            uploadProgress.style.display = 'block';
            
            try {
                const data = await readExcelFile(file);
                await processBookData(data);
            } catch (error) {
                console.error('Error processing Excel file:', error);
                progressStatus.textContent = 'Error: ' + error.message;
                progressFill.style.background = 'var(--danger)';
            }
        }

        function readExcelFile(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    try {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });
                        
                        // Get first worksheet
                        const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                        const jsonData = XLSX.utils.sheet_to_json(worksheet);
                        
                        resolve(jsonData);
                    } catch (error) {
                        reject(new Error('Format file Excel tidak valid'));
                    }
                };
                
                reader.onerror = function() {
                    reject(new Error('Gagal membaca file'));
                };
                
                reader.readAsArrayBuffer(file);
            });
        }

        // Simulate processing book data (in a real app, this would connect to your database)
        async function processBookData(data) {
            let success = 0;
            let failed = 0;
            let skipped = 0;
            
            const totalRows = data.length;
            let processedRows = 0;
            
            // Show upload results
            uploadResults.style.display = 'block';
            
            for (const row of data) {
                processedRows++;
                const progress = (processedRows / totalRows) * 100;
                
                progressFill.style.width = `${progress}%`;
                progressCount.textContent = `${processedRows}/${totalRows}`;
                
                try {
                    // Validate required fields
                    if (!row['Judul Buku'] || !row['Penulis'] || !row['Harga Asli (USD)'] || !row['Harga Dasar (USD)']) {
                        addResultRow('failed', row['Judul Buku'] || 'Data tanpa judul', 'Data tidak lengkap - field wajib kosong');
                        failed++;
                        continue;
                    }
                    
                    // Simulate processing delay
                    await new Promise(resolve => setTimeout(resolve, 500));
                    
                    // Random result for demo (in real app, this would be actual processing)
                    const randomResult = Math.random();
                    
                    if (randomResult < 0.7) {
                        addResultRow('success', row['Judul Buku'], 'Buku berhasil ditambahkan ke database');
                        success++;
                    } else if (randomResult < 0.9) {
                        addResultRow('skipped', row['Judul Buku'], 'Buku sudah ada di sistem');
                        skipped++;
                    } else {
                        addResultRow('failed', row['Judul Buku'], 'Gagal menyimpan ke database');
                        failed++;
                    }
                    
                } catch (error) {
                    addResultRow('failed', row['Judul Buku'] || 'Data tanpa judul', `Error: ${error.message}`);
                    failed++;
                }
                
                // Update counts
                updateResultCounts(success, failed, skipped);
            }
            
            // Final update
            progressStatus.textContent = 'Selesai';
            progressFill.style.background = 'var(--success)';
            
            // Show completion message
            setTimeout(() => {
                alert(`Proses upload selesai!\nBerhasil: ${success}\nGagal: ${failed}\nDilewati: ${skipped}`);
            }, 1000);
        }

        function resetUploadResults() {
            successCount.textContent = '0';
            failedCount.textContent = '0';
            skippedCount.textContent = '0';
            resultsDetails.innerHTML = '';
            progressFill.style.width = '0%';
            progressFill.style.background = 'var(--success)';
            progressStatus.textContent = 'Memproses...';
            progressCount.textContent = '0/0';
        }

        function addResultRow(status, title, message) {
            const statusText = {
                'success': 'Berhasil',
                'failed': 'Gagal',
                'skipped': 'Dilewati'
            };
            
            const row = document.createElement('div');
            row.className = `result-row ${status}`;
            row.innerHTML = `
                <div class="result-info">
                    <div class="result-title">${title}</div>
                    <div class="result-message">${message}</div>
                </div>
                <div class="result-status ${status}">${statusText[status]}</div>
            `;
            
            resultsDetails.appendChild(row);
        }

        function updateResultCounts(success, failed, skipped) {
            successCount.textContent = success;
            failedCount.textContent = failed;
            skippedCount.textContent = skipped;
        }
       // Language translations
        const translations = {
            id: {
                "dashboard-title": "Panel Admin - Toko Buku Islam",
                "dashboard-subtitle": "Kelola data buku, penerbit, kategori, dan banner dengan mudah",
                "menu-books": "Buku",
                "menu-publishers": "Penerbit",
                "menu-categories": "Kategori",
                "menu-banners": "Banner",
                "menu-orders": "Pesanan",
                "menu-currency": "Kurs",
                "add-book-title": "Tambah Buku Baru",
                "book-title": "Judul Buku",
                "book-author": "Penulis",
                "book-original-price": "Harga Asli (USD)",
                "book-base-price": "Harga Dasar (USD)",
                "book-publisher": "Penerbit",
                "book-category": "Kategori",
                "book-discount": "Diskon",
                "book-volumes": "Jilid",
                "book-pages": "Halaman",
                "book-year": "Tahun Terbit",
                "book-weight": "Berat Buku",
                "book-text-color": "Warna Tulisan",
                "book-cover-type": "Jenis Cover",
                "book-paper-type": "Jenis Kertas",
                "book-print-count": "Cetakan Ke",
                "book-editor": "Editor",
                "book-description": "Deskripsi Buku",
                "book-cover": "Sampul Buku",
                "upload-file": "Unggah File",
                "use-url": "Gunakan URL",
                "save-book": "Simpan Buku",
                "cancel-edit": "Batal Edit",
                "price-calculator": "Kalkulator Harga Setelah Diskon",
                "base-price-usd": "Harga Dasar (USD):",
                "discount": "Diskon:",
                "final-price-usd": "Harga Setelah Diskon (USD):",
                "final-price-idr": "Harga Setelah Diskon (IDR):",
                "final-price-egp": "Harga Setelah Diskon (EGP):",
                "filter-search": "Filter dan Pencarian Buku",
                "search-title": "Cari Judul",
                "search-author": "Cari Penulis",
                "filter-publisher": "Penerbit",
                "filter-category": "Kategori",
                "filter-cover-type": "Jenis Cover",
                "filter-paper-type": "Jenis Kertas",
                "apply-filter": "Terapkan Filter",
                "reset-filter": "Reset Filter",
                "bulk-actions": "Aksi Massal:",
                "select-action": "Pilih Aksi",
                "delete-books": "Hapus Buku",
                "apply": "Terapkan",
                "book-list": "Daftar Buku",
                "table-image": "Gambar",
                "table-book-info": "Informasi Buku",
                "table-details": "Detail",
                "table-weight": "Berat",
                "table-price-usd": "Harga USD",
                "table-price-idr": "Harga IDR",
                "table-price-egp": "Harga EGP",
                "table-discount": "Diskon",
                "table-actions": "Aksi",
                "loading-books": "Memuat data buku...",
                "add-publisher-title": "Tambah Penerbit Baru",
                "publisher-name": "Nama Penerbit",
                "publisher-letter": "Huruf",
                "publisher-discount": "Diskon",
                "publisher-logo": "Logo Penerbit",
                "save-publisher": "Simpan Penerbit",
                "publisher-list": "Daftar Penerbit",
                "table-logo": "Logo",
                "table-name": "Nama",
                "table-letter": "Huruf",
                "loading-publishers": "Memuat data penerbit...",
                "add-category-title": "Tambah Kategori Baru",
                "category-name-id": "Nama (ID)",
                "category-name-en": "Nama (EN)",
                "category-name-ar": "Nama (AR)",
                "category-color": "Warna",
                "category-link": "Link Kategori",
                "category-image": "Gambar Kategori",
                "save-category": "Simpan Kategori",
                "category-list": "Daftar Kategori",
                "table-name-id": "Nama (ID)",
                "table-name-en": "Nama (EN)",
                "table-color": "Warna",
                "table-link": "Link",
                "loading-categories": "Memuat data kategori...",
                "add-banner-title": "Tambah Banner Baru",
                "banner-title": "Judul Banner",
                "banner-type": "Tipe",
                "banner-order": "Urutan Tampil",
                "banner-image": "Gambar Banner",
                "save-banner": "Simpan Banner",
                "banner-list": "Daftar Banner",
                "table-title": "Judul",
                "table-type": "Tipe",
                "table-order": "Urutan",
                "loading-banners": "Memuat data banner...",
                "order-list": "Daftar Pesanan",
                "table-customer-name": "Nama Pelanggan",
                "table-book": "Buku",
                "table-total-idr": "Total (IDR)",
                "table-status": "Status",
                "table-date": "Tanggal",
                "loading-orders": "Memuat data pesanan...",
                "currency-settings": "Pengaturan Kurs Mata Uang",
                "currency-description": "Harga dasar produk disimpan dalam USD. Atur kurs di sini untuk mengonversi harga saat ditampilkan.",
                "usd-to-idr": "USD ke IDR",
                "usd-to-egp": "USD ke EGP",
                "save-settings": "Simpan Pengaturan",
                "edit-book-title": "Edit Buku - Semua Data",
                "update-book": "Perbarui Buku",
                "cancel": "Batal"
            },
            en: {
                "dashboard-title": "Admin Panel - Islamic Book Store",
                "dashboard-subtitle": "Manage books, publishers, categories, and banners easily",
                "menu-books": "Books",
                "menu-publishers": "Publishers",
                "menu-categories": "Categories",
                "menu-banners": "Banners",
                "menu-orders": "Orders",
                "menu-currency": "Currency",
                "add-book-title": "Add New Book",
                "book-title": "Book Title",
                "book-author": "Author",
                "book-original-price": "Original Price (USD)",
                "book-base-price": "Base Price (USD)",
                "book-publisher": "Publisher",
                "book-category": "Category",
                "book-discount": "Discount",
                "book-volumes": "Volumes",
                "book-pages": "Pages",
                "book-year": "Publication Year",
                "book-weight": "Book Weight",
                "book-text-color": "Text Color",
                "book-cover-type": "Cover Type",
                "book-paper-type": "Paper Type",
                "book-print-count": "Print Edition",
                "book-editor": "Editor",
                "book-description": "Book Description",
                "book-cover": "Book Cover",
                "upload-file": "Upload File",
                "use-url": "Use URL",
                "save-book": "Save Book",
                "cancel-edit": "Cancel Edit",
                "price-calculator": "Price Calculator After Discount",
                "base-price-usd": "Base Price (USD):",
                "discount": "Discount:",
                "final-price-usd": "Final Price (USD):",
                "final-price-idr": "Final Price (IDR):",
                "final-price-egp": "Final Price (EGP):",
                "filter-search": "Filter and Search Books",
                "search-title": "Search Title",
                "search-author": "Search Author",
                "filter-publisher": "Publisher",
                "filter-category": "Category",
                "filter-cover-type": "Cover Type",
                "filter-paper-type": "Paper Type",
                "apply-filter": "Apply Filter",
                "reset-filter": "Reset Filter",
                "bulk-actions": "Bulk Actions:",
                "select-action": "Select Action",
                "delete-books": "Delete Books",
                "apply": "Apply",
                "book-list": "Book List",
                "table-image": "Image",
                "table-book-info": "Book Information",
                "table-details": "Details",
                "table-weight": "Weight",
                "table-price-usd": "Price USD",
                "table-price-idr": "Price IDR",
                "table-price-egp": "Price EGP",
                "table-discount": "Discount",
                "table-actions": "Actions",
                "loading-books": "Loading book data...",
                "add-publisher-title": "Add New Publisher",
                "publisher-name": "Publisher Name",
                "publisher-letter": "Letter",
                "publisher-discount": "Discount",
                "publisher-logo": "Publisher Logo",
                "save-publisher": "Save Publisher",
                "publisher-list": "Publisher List",
                "table-logo": "Logo",
                "table-name": "Name",
                "table-letter": "Letter",
                "loading-publishers": "Loading publisher data...",
                "add-category-title": "Add New Category",
                "category-name-id": "Name (ID)",
                "category-name-en": "Name (EN)",
                "category-name-ar": "Name (AR)",
                "category-color": "Color",
                "category-link": "Category Link",
                "category-image": "Category Image",
                "save-category": "Save Category",
                "category-list": "Category List",
                "table-name-id": "Name (ID)",
                "table-name-en": "Name (EN)",
                "table-color": "Color",
                "table-link": "Link",
                "loading-categories": "Loading category data...",
                "add-banner-title": "Add New Banner",
                "banner-title": "Banner Title",
                "banner-type": "Type",
                "banner-order": "Display Order",
                "banner-image": "Banner Image",
                "save-banner": "Save Banner",
                "banner-list": "Banner List",
                "table-title": "Title",
                "table-type": "Type",
                "table-order": "Order",
                "loading-banners": "Loading banner data...",
                "order-list": "Order List",
                "table-customer-name": "Customer Name",
                "table-book": "Book",
                "table-total-idr": "Total (IDR)",
                "table-status": "Status",
                "table-date": "Date",
                "loading-orders": "Loading order data...",
                "currency-settings": "Currency Rate Settings",
                "currency-description": "Product base prices are stored in USD. Set rates here to convert prices when displayed.",
                "usd-to-idr": "USD to IDR",
                "usd-to-egp": "USD to EGP",
                "save-settings": "Save Settings",
                "edit-book-title": "Edit Book - All Data",
                "update-book": "Update Book",
                "cancel": "Cancel"
            },
            ar: {
                "dashboard-title": "لوحة التحكم - مكتبة الكتب الإسلامية",
                "dashboard-subtitle": "إدارة الكتب والناشرين والفئات واللافتات بسهولة",
                "menu-books": "الكتب",
                "menu-publishers": "الناشرون",
                "menu-categories": "الفئات",
                "menu-banners": "اللافتات",
                "menu-orders": "الطلبات",
                "menu-currency": "العملة",
                "add-book-title": "إضافة كتاب جديد",
                "book-title": "عنوان الكتاب",
                "book-author": "المؤلف",
                "book-original-price": "السعر الأصلي (دولار أمريكي)",
                "book-base-price": "السعر الأساسي (دولار أمريكي)",
                "book-publisher": "الناشر",
                "book-category": "الفئة",
                "book-discount": "خصم",
                "book-volumes": "المجلدات",
                "book-pages": "الصفحات",
                "book-year": "سنة النشر",
                "book-weight": "وزن الكتاب",
                "book-text-color": "لون النص",
                "book-cover-type": "نوع الغلاف",
                "book-paper-type": "نوع الورق",
                "book-print-count": "طبعة",
                "book-editor": "المحرر",
                "book-description": "وصف الكتاب",
                "book-cover": "غلاف الكتاب",
                "upload-file": "رفع ملف",
                "use-url": "استخدام الرابط",
                "save-book": "حفظ الكتاب",
                "cancel-edit": "إلغاء التعديل",
                "price-calculator": "حاسبة السعر بعد الخصم",
                "base-price-usd": "السعر الأساسي (دولار أمريكي):",
                "discount": "خصم:",
                "final-price-usd": "السعر النهائي (دولار أمريكي):",
                "final-price-idr": "السعر النهائي (روبية إندونيسية):",
                "final-price-egp": "السعر النهائي (جنيه مصري):",
                "filter-search": "تصفية وبحث الكتب",
                "search-title": "بحث العنوان",
                "search-author": "بحث المؤلف",
                "filter-publisher": "الناشر",
                "filter-category": "الفئة",
                "filter-cover-type": "نوع الغلاف",
                "filter-paper-type": "نوع الورق",
                "apply-filter": "تطبيق التصفية",
                "reset-filter": "إعادة تعيين التصفية",
                "bulk-actions": "إجراءات جماعية:",
                "select-action": "اختر الإجراء",
                "delete-books": "حذف الكتب",
                "apply": "تطبيق",
                "book-list": "قائمة الكتب",
                "table-image": "الصورة",
                "table-book-info": "معلومات الكتاب",
                "table-details": "التفاصيل",
                "table-weight": "الوزن",
                "table-price-usd": "السعر دولار أمريكي",
                "table-price-idr": "السعر روبية إندونيسية",
                "table-price-egp": "السعر جنيه مصري",
                "table-discount": "خصم",
                "table-actions": "الإجراءات",
                "loading-books": "جاري تحميل بيانات الكتب...",
                "add-publisher-title": "إضافة ناشر جديد",
                "publisher-name": "اسم الناشر",
                "publisher-letter": "الحرف",
                "publisher-discount": "خصم",
                "publisher-logo": "شعار الناشر",
                "save-publisher": "حفظ الناشر",
                "publisher-list": "قائمة الناشرين",
                "table-logo": "الشعار",
                "table-name": "الاسم",
                "table-letter": "الحرف",
                "loading-publishers": "جاري تحميل بيانات الناشرين...",
                "add-category-title": "إضافة فئة جديدة",
                "category-name-id": "الاسم (ID)",
                "category-name-en": "الاسم (EN)",
                "category-name-ar": "الاسم (AR)",
                "category-color": "اللون",
                "category-link": "رابط الفئة",
                "category-image": "صورة الفئة",
                "save-category": "حفظ الفئة",
                "category-list": "قائمة الفئات",
                "table-name-id": "الاسم (ID)",
                "table-name-en": "الاسم (EN)",
                "table-color": "اللون",
                "table-link": "الرابط",
                "loading-categories": "جاري تحميل بيانات الفئات...",
                "add-banner-title": "إضافة لافتة جديدة",
                "banner-title": "عنوان اللافتة",
                "banner-type": "النوع",
                "banner-order": "ترتيب العرض",
                "banner-image": "صورة اللافتة",
                "save-banner": "حفظ اللافتة",
                "banner-list": "قائمة اللافتات",
                "table-title": "العنوان",
                "table-type": "النوع",
                "table-order": "الترتيب",
                "loading-banners": "جاري تحميل بيانات اللافتات...",
                "order-list": "قائمة الطلبات",
                "table-customer-name": "اسم العميل",
                "table-book": "الكتاب",
                "table-total-idr": "الإجمالي (روبية إندونيسية)",
                "table-status": "الحالة",
                "table-date": "التاريخ",
                "loading-orders": "جاري تحميل بيانات الطلبات...",
                "currency-settings": "إعدادات سعر الصرف",
                "currency-description": "يتم تخزين الأسعار الأساسية للمنتجات بالدولار الأمريكي. اضبط الأسعار هنا لتحويل الأسعار عند عرضها.",
                "usd-to-idr": "دولار أمريكي إلى روبية إندونيسية",
                "usd-to-egp": "دولار أمريكي إلى جنيه مصري",
                "save-settings": "حفظ الإعدادات",
                "edit-book-title": "تعديل الكتاب - جميع البيانات",
                "update-book": "تحديث الكتاب",
                "cancel": "إلغاء"
            }
        };

        // Current language
        let currentLanguage = 'id';

        // Language selector functionality
        const languageBtn = document.getElementById('languageBtn');
        const languageDropdown = document.getElementById('languageDropdown');
        const currentLangFlag = document.getElementById('currentLangFlag');
        const currentLangText = document.getElementById('currentLangText');

        languageBtn.addEventListener('click', () => {
            languageDropdown.classList.toggle('show');
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', (e) => {
            if (!languageBtn.contains(e.target) && !languageDropdown.contains(e.target)) {
                languageDropdown.classList.remove('show');
            }
        });

        // Language option click handlers
        const languageOptions = document.querySelectorAll('.language-option');
        languageOptions.forEach(option => {
            option.addEventListener('click', () => {
                const lang = option.getAttribute('data-lang');
                changeLanguage(lang);
                
                // Update active state
                languageOptions.forEach(opt => opt.classList.remove('active'));
                option.classList.add('active');
                
                // Update button display
                const flag = option.querySelector('span:first-child').textContent;
                const text = option.querySelector('span:last-child').textContent;
                currentLangFlag.textContent = flag;
                currentLangText.textContent = text;
                
                // Close dropdown
                languageDropdown.classList.remove('show');
            });
        });

        // Change language function
        function changeLanguage(lang) {
            currentLanguage = lang;
            document.documentElement.lang = lang;
            
            // Update all elements with data-lang-key attribute
            const elements = document.querySelectorAll('[data-lang-key]');
            elements.forEach(element => {
                const key = element.getAttribute('data-lang-key');
                if (translations[lang] && translations[lang][key]) {
                    element.textContent = translations[lang][key];
                }
            });
            
            // Update placeholders
            updatePlaceholders(lang);
            
            // Update RTL for Arabic
            if (lang === 'ar') {
                document.body.style.direction = 'rtl';
                document.querySelector('.main-content').style.marginLeft = '0';
                document.querySelector('.main-content').style.marginRight = 'var(--sidebar-width)';
                document.querySelector('.sidebar').style.left = 'auto';
                document.querySelector('.sidebar').style.right = '0';
            } else {
                document.body.style.direction = 'ltr';
                document.querySelector('.main-content').style.marginLeft = 'var(--sidebar-width)';
                document.querySelector('.main-content').style.marginRight = '0';
                document.querySelector('.sidebar').style.left = '0';
                document.querySelector('.sidebar').style.right = 'auto';
            }
        }

        // Update placeholders based on language
        function updatePlaceholders(lang) {
            const placeholders = {
                id: {
                    'bookTitle': 'Masukkan judul buku',
                    'bookAuthor': 'Nama penulis',
                    'bookOriginalPrice': '0.00',
                    'bookBasePrice': '0.00',
                    'bookDiscount': 'Contoh: 10%',
                    'bookVolumes': 'Jumlah jilid',
                    'bookPages': 'Jumlah halaman',
                    'bookYear': 'Tahun terbit',
                    'bookWeightValue': 'Nilai berat',
                    'bookTextColorInput': 'Ketik manual',
                    'bookCoverTypeInput': 'Ketik manual',
                    'bookPaperTypeInput': 'Ketik manual',
                    'bookPrintCount': 'Angka cetakan',
                    'bookEditor': 'Nama editor',
                    'bookDescription': 'Deskripsi lengkap buku',
                    'bookCoverImageUrl': 'Masukkan URL gambar',
                    'searchTitle': 'Kata kunci judul...',
                    'searchAuthor': 'Nama penulis...',
                    'filterCoverType': 'Jenis cover...',
                    'filterPaperType': 'Jenis kertas...',
                    'publisherName': 'Nama penerbit',
                    'publisherLetter': 'Huruf penerbit',
                    'publisherDiscount': 'Contoh: 10%',
                    'categoryNameId': 'Nama dalam Bahasa Indonesia',
                    'categoryNameEn': 'Nama dalam Bahasa Inggris',
                    'categoryNameAr': 'Nama dalam Bahasa Arab',
                    'bannerTitle': 'Judul banner',
                    'bannerType': 'Contoh: promo, utama',
                    'bannerDisplayOrder': 'Angka urutan',
                    'usdToIdr': 'Kurs USD ke Rupiah',
                    'usdToEgp': 'Kurs USD ke Pound Mesir'
                },
                en: {
                    'bookTitle': 'Enter book title',
                    'bookAuthor': 'Author name',
                    'bookOriginalPrice': '0.00',
                    'bookBasePrice': '0.00',
                    'bookDiscount': 'Example: 10%',
                    'bookVolumes': 'Number of volumes',
                    'bookPages': 'Number of pages',
                    'bookYear': 'Publication year',
                    'bookWeightValue': 'Weight value',
                    'bookTextColorInput': 'Type manually',
                    'bookCoverTypeInput': 'Type manually',
                    'bookPaperTypeInput': 'Type manually',
                    'bookPrintCount': 'Print edition number',
                    'bookEditor': 'Editor name',
                    'bookDescription': 'Complete book description',
                    'bookCoverImageUrl': 'Enter image URL',
                    'searchTitle': 'Title keywords...',
                    'searchAuthor': 'Author name...',
                    'filterCoverType': 'Cover type...',
                    'filterPaperType': 'Paper type...',
                    'publisherName': 'Publisher name',
                    'publisherLetter': 'Publisher letter',
                    'publisherDiscount': 'Example: 10%',
                    'categoryNameId': 'Name in Indonesian',
                    'categoryNameEn': 'Name in English',
                    'categoryNameAr': 'Name in Arabic',
                    'bannerTitle': 'Banner title',
                    'bannerType': 'Example: promo, main',
                    'bannerDisplayOrder': 'Order number',
                    'usdToIdr': 'USD to IDR rate',
                    'usdToEgp': 'USD to EGP rate'
                },
                ar: {
                    'bookTitle': 'أدخل عنوان الكتاب',
                    'bookAuthor': 'اسم المؤلف',
                    'bookOriginalPrice': '0.00',
                    'bookBasePrice': '0.00',
                    'bookDiscount': 'مثال: 10%',
                    'bookVolumes': 'عدد المجلدات',
                    'bookPages': 'عدد الصفحات',
                    'bookYear': 'سنة النشر',
                    'bookWeightValue': 'قيمة الوزن',
                    'bookTextColorInput': 'اكتب يدوياً',
                    'bookCoverTypeInput': 'اكتب يدوياً',
                    'bookPaperTypeInput': 'اكتب يدوياً',
                    'bookPrintCount': 'رقم الطبعة',
                    'bookEditor': 'اسم المحرر',
                    'bookDescription': 'وصف الكتاب الكامل',
                    'bookCoverImageUrl': 'أدخل رابط الصورة',
                    'searchTitle': 'كلمات مفتاحية للعنوان...',
                    'searchAuthor': 'اسم المؤلف...',
                    'filterCoverType': 'نوع الغلاف...',
                    'filterPaperType': 'نوع الورق...',
                    'publisherName': 'اسم الناشر',
                    'publisherLetter': 'حرف الناشر',
                    'publisherDiscount': 'مثال: 10%',
                    'categoryNameId': 'الاسم بالإندونيسية',
                    'categoryNameEn': 'الاسم بالإنجليزية',
                    'categoryNameAr': 'الاسم بالعربية',
                    'bannerTitle': 'عنوان اللافتة',
                    'bannerType': 'مثال: ترويجي، رئيسي',
                    'bannerDisplayOrder': 'رقم الترتيب',
                    'usdToIdr': 'سعر صرف الدولار إلى الروبية الإندونيسية',
                    'usdToEgp': 'سعر صرف الدولار إلى الجنيه المصري'
                }
            };
            
            // Update all input placeholders
            for (const [id, placeholder] of Object.entries(placeholders[lang])) {
                const element = document.getElementById(id);
                if (element) {
                    element.placeholder = placeholder;
                }
            }
        }

        // Menu toggle for mobile
        document.getElementById('menuToggle').addEventListener('click', function() {
            document.getElementById('sidebar').classList.toggle('active');
        });

        // Navigation
        const navButtons = document.querySelectorAll('.nav-btn');
        const contentSections = document.querySelectorAll('.content-section');

        navButtons.forEach(button => {
            button.addEventListener('click', () => {
                const targetSection = button.getAttribute('data-section');
                
                // Update active nav button
                navButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                
                // Show target section
                contentSections.forEach(section => {
                    section.classList.remove('active');
                    if (section.id === `${targetSection}-section`) {
                        section.classList.add('active');
                    }
                });
                
                // Close mobile menu
                if (window.innerWidth <= 1024) {
                    document.getElementById('sidebar').classList.remove('active');
                }
            });
        });

        // Check screen size on load and resize
        function checkScreenSize() {
            const menuToggle = document.getElementById('menuToggle');
            if (window.innerWidth <= 1024) {
                menuToggle.style.display = 'block';
            } else {
                menuToggle.style.display = 'none';
                document.getElementById('sidebar').classList.remove('active');
            }
        }

        window.addEventListener('load', checkScreenSize);
        window.addEventListener('resize', checkScreenSize);

        // Initialize with Indonesian language
        changeLanguage('id');
    document.addEventListener('DOMContentLoaded', function() {
        const supabaseUrl = 'https://rfqpsuzmonfmnvthxinb.supabase.co';
        const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJmcXBzdXptb25mbW52dGh4aW5iIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA1OTQyMjUsImV4cCI6MjA3NjE3MDIyNX0.gJFzuE-KJrdSoIKMTIDszTdNLDl_sJkIhgo7wmXRGWA';
        const supabase = window.supabase.createClient(supabaseUrl, supabaseAnonKey);
        const STORAGE_BUCKET = 'images';

        let currencySettings = { usd_rate: 15000, egp_rate: 500 };
        let allPublishers = [];
        let allCategories = [];
        let selectedBooks = new Set();
        let currentFilters = {};

        function saveFormData(formId) {
            const form = document.getElementById(formId);
            const formData = {};
            const inputs = form.querySelectorAll('input, select, textarea');
            inputs.forEach(input => {
                if (input.type !== 'file' && input.type !== 'submit' && input.type !== 'button') {
                    formData[input.id] = input.value;
                }
            });
            localStorage.setItem(`formData_${formId}`, JSON.stringify(formData));
        }

        function loadFormData(formId) {
            const savedData = localStorage.getItem(`formData_${formId}`);
            if (savedData) {
                const formData = JSON.parse(savedData);
                Object.keys(formData).forEach(key => {
                    const element = document.getElementById(key);
                    if (element) {
                        element.value = formData[key];
                        if (element.id.includes('BasePrice') || element.id.includes('Discount')) {
                            updatePriceCalculator();
                        }
                    }
                });
            }
        }

        function setupFormAutoSave(formId) {
            const form = document.getElementById(formId);
            const inputs = form.querySelectorAll('input, select, textarea');
            inputs.forEach(input => {
                if (input.type !== 'file' && input.type !== 'submit' && input.type !== 'button') {
                    input.addEventListener('input', () => saveFormData(formId));
                    input.addEventListener('change', () => saveFormData(formId));
                }
            });
        }

        const sections = document.querySelectorAll('.content-section');
        const navButtons = document.querySelectorAll('.nav-btn');
        
        function showSection(sectionId) {
            sections.forEach(section => section.classList.remove('active'));
            navButtons.forEach(btn => btn.classList.remove('active'));
            document.getElementById(`${sectionId}-section`).classList.add('active');
            document.querySelector(`[data-section="${sectionId}"]`).classList.add('active');
            
            if (window[`fetch${sectionId.charAt(0).toUpperCase() + sectionId.slice(1)}`]) {
                window[`fetch${sectionId.charAt(0).toUpperCase() + sectionId.slice(1)}`]();
            }
        }
        
        navButtons.forEach(button => {
            button.addEventListener('click', () => showSection(button.dataset.section));
        });

        function formatPrice(priceInUsd, currency) {
            let rate = 1, symbol = '$';
            if (currency === 'IDR') { rate = currencySettings.usd_rate; symbol = 'Rp '; }
            if (currency === 'EGP') { rate = currencySettings.egp_rate; symbol = 'E£ '; }
            const price = priceInUsd * rate;
            return `${symbol}${price.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
        }
        
        function calculateDiscountedPrice(basePrice, discount) {
            if (!discount) return basePrice;
            const discountPercent = parseFloat(discount.replace('%', '')) || 0;
            return basePrice * (1 - discountPercent / 100);
        }
        
        function slugify(text) {
            return text.toString().toLowerCase()
                .replace(/\s+/g, '-')
                .replace(/[^\w\-]+/g, '')
                .replace(/\-\-+/g, '-')
                .replace(/^-+/, '')
                .replace(/-+$/, '');
        }
        
        async function uploadImage(file, folder) {
            if (!file) return null;
            const fileExt = file.name.split('.').pop();
            const fileName = `${folder}/${Date.now()}.${fileExt}`;
            const { data, error } = await supabase.storage.from(STORAGE_BUCKET).upload(fileName, file);
            if (error) {
                console.error('Error uploading image:', error);
                alert('Gagal mengunggah gambar.');
                return null;
            }
            const { data: { publicUrl } } = supabase.storage.from(STORAGE_BUCKET).getPublicUrl(fileName);
            return publicUrl;
        }
        
        async function fetchData(tableName, tbodyId, loadingId, renderFunction) {
            document.getElementById(loadingId).style.display = 'block';
            const { data, error } = await supabase.from(tableName).select('*');
            if (error) {
                console.error(`Error fetching ${tableName}:`, error);
                document.getElementById(loadingId).textContent = 'Gagal memuat data.';
            } else {
                renderFunction(data);
                document.getElementById(loadingId).style.display = 'none';
            }
        }
        
        async function deleteItem(tableName, itemId, fetchFunction) {
            if (!confirm('Apakah Anda yakin ingin menghapus data ini?')) return;
            const { error } = await supabase.from(tableName).delete().eq('id', itemId);
            if (error) {
                console.error(`Error deleting from ${tableName}:`, error);
                alert('Gagal menghapus data.');
            } else {
                fetchFunction();
            }
        }

        const bookForm = document.getElementById('bookForm');
        const booksTableBody = document.getElementById('booksTableBody');
        const bookFileInput = document.getElementById('bookCoverImageFile');
        const bookUrlInput = document.getElementById('bookCoverImageUrl');
        const bookImagePreview = document.getElementById('bookImagePreview');
        const bookPublisherSelect = document.getElementById('bookPublisherSelect');
        const bookCategorySelect = document.getElementById('bookCategorySelect');
        const bookDiscountInput = document.getElementById('bookDiscount');
        const bookBasePriceInput = document.getElementById('bookBasePrice');

        const displayBasePriceUSD = document.getElementById('displayBasePriceUSD');
        const displayDiscountPercent = document.getElementById('displayDiscountPercent');
        const displayFinalPriceUSD = document.getElementById('displayFinalPriceUSD');
        const displayFinalPriceIDR = document.getElementById('displayFinalPriceIDR');
        const displayFinalPriceEGP = document.getElementById('displayFinalPriceEGP');

        const selectAllCheckbox = document.getElementById('selectAll');
        const bulkActionSelect = document.getElementById('bulkAction');
        const applyBulkActionBtn = document.getElementById('applyBulkAction');
        const selectedCountSpan = document.getElementById('selectedCount');

        const searchTitle = document.getElementById('searchTitle');
        const searchAuthor = document.getElementById('searchAuthor');
        const filterPublisher = document.getElementById('filterPublisher');
        const filterCategory = document.getElementById('filterCategory');
        const filterCoverType = document.getElementById('filterCoverType');
        const filterPaperType = document.getElementById('filterPaperType');
        const applyFilterBtn = document.getElementById('applyFilter');
        const resetFilterBtn = document.getElementById('resetFilter');

        const editModal = document.getElementById('editModal');
        const editBookForm = document.getElementById('editBookForm');
        const closeModalBtn = document.querySelector('.close-modal');
        const cancelEditModalBtn = document.getElementById('cancelEditModal');

        function updatePriceCalculator() {
            const basePrice = parseFloat(bookBasePriceInput.value) || 0;
            const discount = bookDiscountInput.value || '0';
            const discountPercent = parseFloat(discount.replace('%', '')) || 0;
            const finalPriceUSD = calculateDiscountedPrice(basePrice, discount);
            
            displayBasePriceUSD.textContent = `$${basePrice.toFixed(2)}`;
            displayDiscountPercent.textContent = `${discountPercent}%`;
            displayFinalPriceUSD.textContent = `$${finalPriceUSD.toFixed(2)}`;
            displayFinalPriceIDR.textContent = formatPrice(finalPriceUSD, 'IDR');
            displayFinalPriceEGP.textContent = formatPrice(finalPriceUSD, 'EGP');
        }

        function updateEditPriceCalculator() {
            const basePrice = parseFloat(document.getElementById('editBookBasePrice').value) || 0;
            const discount = document.getElementById('editBookDiscount').value || '0';
            const discountPercent = parseFloat(discount.replace('%', '')) || 0;
            const finalPriceUSD = calculateDiscountedPrice(basePrice, discount);
            
            document.getElementById('editDisplayBasePriceUSD').textContent = `$${basePrice.toFixed(2)}`;
            document.getElementById('editDisplayDiscountPercent').textContent = `${discountPercent}%`;
            document.getElementById('editDisplayFinalPriceUSD').textContent = `$${finalPriceUSD.toFixed(2)}`;
            document.getElementById('editDisplayFinalPriceIDR').textContent = formatPrice(finalPriceUSD, 'IDR');
            document.getElementById('editDisplayFinalPriceEGP').textContent = formatPrice(finalPriceUSD, 'EGP');
        }

        async function populatePublisherDropdown() {
            const { data, error } = await supabase.from('publishers').select('id, name, discount');
            if (error) {
                console.error('Error fetching publishers:', error);
                return;
            }
            allPublishers = data;
            
            bookPublisherSelect.innerHTML = '<option value="">-- Pilih Penerbit --</option>' + 
                data.map(p => `<option value="${p.id}" data-discount="${p.discount || ''}">${p.name}</option>`).join('');
            
            document.getElementById('editBookPublisherSelect').innerHTML = '<option value="">-- Pilih Penerbit --</option>' + 
                data.map(p => `<option value="${p.id}" data-discount="${p.discount || ''}">${p.name}</option>`).join('');
            
            filterPublisher.innerHTML = '<option value="">Semua Penerbit</option>' + 
                data.map(p => `<option value="${p.id}">${p.name}</option>`).join('');
        }

        async function populateCategoryDropdown() {
            const { data, error } = await supabase.from('categories').select('id, name_id');
            if (error) {
                console.error('Error fetching categories:', error);
                return;
            }
            allCategories = data;
            
            bookCategorySelect.innerHTML = '<option value="">-- Pilih Kategori --</option>' + 
                data.map(c => `<option value="${c.id}">${c.name_id}</option>`).join('');
            
            document.getElementById('editBookCategorySelect').innerHTML = '<option value="">-- Pilih Kategori --</option>' + 
                data.map(c => `<option value="${c.id}">${c.name_id}</option>`).join('');
            
            filterCategory.innerHTML = '<option value="">Semua Kategori</option>' + 
                data.map(c => `<option value="${c.id}">${c.name_id}</option>`).join('');
        }

        bookPublisherSelect.addEventListener('change', (e) => {
            const selectedOption = e.target.options[e.target.selectedIndex];
            bookDiscountInput.value = selectedOption.dataset.discount || '';
            updatePriceCalculator();
            saveFormData('bookForm');
        });

        document.getElementById('editBookPublisherSelect').addEventListener('change', (e) => {
            const selectedOption = e.target.options[e.target.selectedIndex];
            document.getElementById('editBookDiscount').value = selectedOption.dataset.discount || '';
            updateEditPriceCalculator();
        });

        bookBasePriceInput.addEventListener('input', () => {
            updatePriceCalculator();
            saveFormData('bookForm');
        });
        bookDiscountInput.addEventListener('input', () => {
            updatePriceCalculator();
            saveFormData('bookForm');
        });

        document.getElementById('editBookBasePrice').addEventListener('input', updateEditPriceCalculator);
        document.getElementById('editBookDiscount').addEventListener('input', updateEditPriceCalculator);

        document.querySelectorAll('input[name="bookImageSource"]').forEach(radio => {
            radio.addEventListener('change', (e) => {
                if (e.target.value === 'upload') {
                    bookFileInput.style.display = 'block';
                    bookUrlInput.style.display = 'none';
                } else {
                    bookFileInput.style.display = 'none';
                    bookUrlInput.style.display = 'block';
                }
                saveFormData('bookForm');
            });
        });

        document.querySelectorAll('input[name="editBookImageSource"]').forEach(radio => {
            radio.addEventListener('change', (e) => {
                if (e.target.value === 'upload') {
                    document.getElementById('editBookCoverImageFile').style.display = 'block';
                    document.getElementById('editBookCoverImageUrl').style.display = 'none';
                } else {
                    document.getElementById('editBookCoverImageFile').style.display = 'none';
                    document.getElementById('editBookCoverImageUrl').style.display = 'block';
                }
            });
        });

        bookFileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                bookImagePreview.src = URL.createObjectURL(file);
                bookImagePreview.style.display = 'block';
            }
        });
        bookUrlInput.addEventListener('input', (e) => {
            if (e.target.value) {
                bookImagePreview.src = e.target.value;
                bookImagePreview.style.display = 'block';
            } else {
                bookImagePreview.style.display = 'none';
            }
            saveFormData('bookForm');
        });

        document.getElementById('editBookCoverImageFile').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                document.getElementById('editBookImagePreview').src = URL.createObjectURL(file);
                document.getElementById('editBookImagePreview').style.display = 'block';
            }
        });
        document.getElementById('editBookCoverImageUrl').addEventListener('input', (e) => {
            if (e.target.value) {
                document.getElementById('editBookImagePreview').src = e.target.value;
                document.getElementById('editBookImagePreview').style.display = 'block';
            } else {
                document.getElementById('editBookImagePreview').style.display = 'none';
            }
        });

        function updateSelectedCount() {
            selectedCountSpan.textContent = `${selectedBooks.size} buku terpilih`;
        }

        function handleBookSelection(bookId, isChecked) {
            if (isChecked) {
                selectedBooks.add(bookId);
            } else {
                selectedBooks.delete(bookId);
            }
            updateSelectedCount();
        }

        selectAllCheckbox.addEventListener('change', (e) => {
            const checkboxes = document.querySelectorAll('.book-checkbox');
            checkboxes.forEach(checkbox => {
                checkbox.checked = e.target.checked;
                handleBookSelection(checkbox.dataset.id, e.target.checked);
            });
        });

        applyBulkActionBtn.addEventListener('click', async () => {
            const action = bulkActionSelect.value;
            if (!action) {
                alert('Pilih aksi terlebih dahulu');
                return;
            }

            if (selectedBooks.size === 0) {
                alert('Pilih setidaknya satu buku');
                return;
            }

            if (action === 'delete') {
                if (!confirm(`Apakah Anda yakin ingin menghapus ${selectedBooks.size} buku?`)) return;
                
                for (const bookId of selectedBooks) {
                    await deleteItem('books', bookId, () => {});
                }
                selectedBooks.clear();
                updateSelectedCount();
                selectAllCheckbox.checked = false;
                window.fetchBooks();
                alert(`${selectedBooks.size} buku berhasil dihapus`);
            }
        });

        function getCustomInputValue(selectId, inputId) {
            const selectValue = document.getElementById(selectId).value;
            const inputValue = document.getElementById(inputId).value.trim();
            return inputValue || selectValue;
        }

        function setCustomInputValue(selectId, inputId, value) {
            const select = document.getElementById(selectId);
            const input = document.getElementById(inputId);
            
            if (select.querySelector(`option[value="${value}"]`)) {
                select.value = value;
                input.value = '';
            } else {
                select.value = '';
                input.value = value;
            }
        }

        function openEditModal(data) {
            document.getElementById('editBookId').value = data.id;
            document.getElementById('editBookTitle').value = data.title;
            document.getElementById('editBookAuthor').value = data.author;
            document.getElementById('editBookOriginalPrice').value = data.original_price;
            document.getElementById('editBookBasePrice').value = data.base_price;
            document.getElementById('editBookVolumes').value = data.volumes;
            document.getElementById('editBookPages').value = data.pages;
            document.getElementById('editBookYear').value = data.year;
            document.getElementById('editBookDescription').value = data.description || '';
            document.getElementById('editBookOldCoverUrl').value = data.cover_image_url || '';
            document.getElementById('editBookPublisherSelect').value = data.publisher_id || '';
            document.getElementById('editBookCategorySelect').value = data.category_id || '';
            document.getElementById('editBookDiscount').value = data.discount || '';
            
            // Set berat buku
            if (data.weight_value && data.weight_unit) {
                document.getElementById('editBookWeightValue').value = data.weight_value;
                document.getElementById('editBookWeightUnit').value = data.weight_unit;
            }
            
            setCustomInputValue('editBookTextColorSelect', 'editBookTextColorInput', data.text_color || '');
            setCustomInputValue('editBookCoverTypeSelect', 'editBookCoverTypeInput', data.cover_type || '');
            setCustomInputValue('editBookPaperTypeSelect', 'editBookPaperTypeInput', data.paper_type || '');
            
            document.getElementById('editBookPrintCount').value = data.print_count || '';
            document.getElementById('editBookEditor').value = data.editor || '';
            
            updateEditPriceCalculator();
            
            if (data.cover_image_url) {
                document.getElementById('editBookImagePreview').src = data.cover_image_url;
                document.getElementById('editBookImagePreview').style.display = 'block';
            }
            
            editModal.style.display = 'block';
        }

        function applyFilters() {
            currentFilters = {
                title: searchTitle.value,
                author: searchAuthor.value,
                publisher: filterPublisher.value,
                category: filterCategory.value,
                coverType: filterCoverType.value,
                paperType: filterPaperType.value
            };
            
            window.fetchBooks();
        }

        function resetFilters() {
            searchTitle.value = '';
            searchAuthor.value = '';
            filterPublisher.value = '';
            filterCategory.value = '';
            filterCoverType.value = '';
            filterPaperType.value = '';
            
            currentFilters = {};
            window.fetchBooks();
        }

        applyFilterBtn.addEventListener('click', applyFilters);
        resetFilterBtn.addEventListener('click', resetFilters);

        const renderBooks = (books) => {
            let filteredBooks = books;
            
            if (currentFilters.title) {
                filteredBooks = filteredBooks.filter(book => 
                    book.title.toLowerCase().includes(currentFilters.title.toLowerCase())
                );
            }
            
            if (currentFilters.author) {
                filteredBooks = filteredBooks.filter(book => 
                    book.author.toLowerCase().includes(currentFilters.author.toLowerCase())
                );
            }
            
            if (currentFilters.publisher) {
                filteredBooks = filteredBooks.filter(book => 
                    book.publisher_id === currentFilters.publisher
                );
            }
            
            if (currentFilters.category) {
                filteredBooks = filteredBooks.filter(book => 
                    book.category_id === currentFilters.category
                );
            }
            
            if (currentFilters.coverType) {
                filteredBooks = filteredBooks.filter(book => 
                    book.cover_type && book.cover_type.toLowerCase().includes(currentFilters.coverType.toLowerCase())
                );
            }
            
            if (currentFilters.paperType) {
                filteredBooks = filteredBooks.filter(book => 
                    book.paper_type && book.paper_type.toLowerCase().includes(currentFilters.paperType.toLowerCase())
                );
            }
            
            booksTableBody.innerHTML = filteredBooks.map(book => {
                const basePrice = book.base_price || 0;
                const discount = book.discount || '0';
                const discountPercent = parseFloat(discount.replace('%', '')) || 0;
                const finalPriceUSD = calculateDiscountedPrice(basePrice, discount);
                const isChecked = selectedBooks.has(book.id);
                
                const publisher = allPublishers.find(p => p.id === book.publisher_id);
                const category = allCategories.find(c => c.id === book.category_id);
                
                return `
                <tr>
                    <td><input type="checkbox" class="book-checkbox" data-id="${book.id}" ${isChecked ? 'checked' : ''}></td>
                    <td><img src="${book.cover_image_url || 'https://via.placeholder.com/60x60.png?text=No+Image'}" class="table-image" alt="Cover"></td>
                    <td>
                        <strong>${book.title}</strong><br>
                        <small>Penulis: ${book.author}</small><br>
                        <small>Penerbit: ${publisher ? publisher.name : '-'}</small><br>
                        <small>Kategori: ${category ? category.name_id : '-'}</small>
                    </td>
                    <td>
                        <div class="book-details-grid">
                            ${book.text_color ? `<div class="detail-item"><span class="detail-label">Warna Tulisan:</span><span class="detail-value">${book.text_color}</span></div>` : ''}
                            ${book.cover_type ? `<div class="detail-item"><span class="detail-label">Jenis Cover:</span><span class="detail-value">${book.cover_type}</span></div>` : ''}
                            ${book.paper_type ? `<div class="detail-item"><span class="detail-label">Jenis Kertas:</span><span class="detail-value">${book.paper_type}</span></div>` : ''}
                            ${book.print_count ? `<div class="detail-item"><span class="detail-label">Cetakan Ke:</span><span class="detail-value">${book.print_count}</span></div>` : ''}
                            ${book.editor ? `<div class="detail-item"><span class="detail-label">Editor:</span><span class="detail-value">${book.editor}</span></div>` : ''}
                            ${book.volumes ? `<div class="detail-item"><span class="detail-label">Jilid:</span><span class="detail-value">${book.volumes}</span></div>` : ''}
                            ${book.pages ? `<div class="detail-item"><span class="detail-label">Halaman:</span><span class="detail-value">${book.pages}</span></div>` : ''}
                            ${book.year ? `<div class="detail-item"><span class="detail-label">Tahun:</span><span class="detail-value">${book.year}</span></div>` : ''}
                        </div>
                    </td>
                    <td>${book.weight_value ? `${book.weight_value} ${book.weight_unit}` : '-'}</td>
                    <td class="price-display">
                        <span class="original-price">${formatPrice(basePrice, 'USD')}</span>
                        <span class="discounted-price">${formatPrice(finalPriceUSD, 'USD')}</span>
                        ${discountPercent > 0 ? `<span class="discount-badge">-${discountPercent}%</span>` : ''}
                    </td>
                    <td class="price-display">
                        <span class="original-price">${formatPrice(basePrice, 'IDR')}</span>
                        <span class="discounted-price">${formatPrice(finalPriceUSD, 'IDR')}</span>
                    </td>
                    <td class="price-display">
                        <span class="original-price">${formatPrice(basePrice, 'EGP')}</span>
                        <span class="discounted-price">${formatPrice(finalPriceUSD, 'EGP')}</span>
                    </td>
                    <td>${discount || '-'}</td>
                    <td class="action-buttons">
                        <button class="btn edit-btn" data-id="${book.id}">✏️ Edit</button>
                        <button class="btn delete-btn" data-id="${book.id}">🗑️ Hapus</button>
                    </td>
                </tr>`;
            }).join('');

            document.querySelectorAll('.book-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', (e) => {
                    handleBookSelection(e.target.dataset.id, e.target.checked);
                });
            });
        };
        
        window.fetchBooks = () => fetchData('books', 'booksTableBody', 'loadingBooks', renderBooks);

        setupFormAutoSave('bookForm');
        loadFormData('bookForm');

        bookForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const submitBtn = document.querySelector('#bookForm .submit-btn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Menyimpan...';
            
            const bookId = document.getElementById('bookId').value;
            const bookData = {
                title: document.getElementById('bookTitle').value,
                author: document.getElementById('bookAuthor').value,
                original_price: parseFloat(document.getElementById('bookOriginalPrice').value),
                base_price: parseFloat(document.getElementById('bookBasePrice').value),
                volumes: document.getElementById('bookVolumes').value,
                pages: document.getElementById('bookPages').value,
                year: document.getElementById('bookYear').value,
                description: document.getElementById('bookDescription').value,
                publisher_id: bookPublisherSelect.value || null,
                category_id: bookCategorySelect.value || null,
                discount: bookDiscountInput.value,
                text_color: getCustomInputValue('bookTextColorSelect', 'bookTextColorInput'),
                cover_type: getCustomInputValue('bookCoverTypeSelect', 'bookCoverTypeInput'),
                paper_type: getCustomInputValue('bookPaperTypeSelect', 'bookPaperTypeInput'),
                print_count: document.getElementById('bookPrintCount').value ? parseInt(document.getElementById('bookPrintCount').value) : null,
                editor: document.getElementById('bookEditor').value,
                weight_value: document.getElementById('bookWeightValue').value ? parseFloat(document.getElementById('bookWeightValue').value) : null,
                weight_unit: document.getElementById('bookWeightUnit').value
            };
            
            let imageUrl = null;
            if (document.querySelector('input[name="bookImageSource"]:checked').value === 'url') {
                imageUrl = bookUrlInput.value;
            } else {
                const file = bookFileInput.files[0];
                if (file) {
                    imageUrl = await uploadImage(file, 'books');
                    if (!imageUrl) {
                        submitBtn.disabled = false;
                        submitBtn.textContent = 'Tambah Buku';
                        return;
                    }
                } else {
                    imageUrl = document.getElementById('bookOldCoverUrl').value;
                }
            }
            bookData.cover_image_url = imageUrl;

            const { error } = bookId ? 
                await supabase.from('books').update(bookData).eq('id', bookId) : 
                await supabase.from('books').insert([bookData]);
                
            if (error) {
                console.error('Error saving book:', error);
                alert('Gagal menyimpan buku.');
            } else {
                if (!bookId) {
                    bookForm.reset();
                    localStorage.removeItem('formData_bookForm');
                }
                resetBookForm();
            }
            
            submitBtn.disabled = false;
            submitBtn.textContent = bookId ? 'Perbarui Buku' : 'Tambah Buku';
            window.fetchBooks();
        });
        
        booksTableBody.addEventListener('click', async (e) => {
            const id = e.target.dataset.id;
            if (e.target.classList.contains('delete-btn')) {
                await deleteItem('books', id, window.fetchBooks);
            }
            if (e.target.classList.contains('edit-btn')) {
                const { data } = await supabase.from('books').select('*').eq('id', id).single();
                if (data) {
                    openEditModal(data);
                }
            }
        });
        
        function resetBookForm() {
            document.getElementById('bookId').value = '';
            document.getElementById('bookOldCoverUrl').value = '';
            bookImagePreview.style.display = 'none';
            document.getElementById('booksFormTitle').textContent = 'Tambah Buku Baru';
            document.querySelector('#bookForm .submit-btn').textContent = 'Tambah Buku';
            document.getElementById('cancelEditBook').style.display = 'none';
            bookFileInput.style.display = 'block';
            bookUrlInput.style.display = 'none';
            updatePriceCalculator();
        }
        
        document.getElementById('cancelEditBook').addEventListener('click', resetBookForm);

        editBookForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const submitBtn = document.querySelector('#editBookForm .submit-btn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Menyimpan...';
            
            const bookId = document.getElementById('editBookId').value;
            const bookData = {
                title: document.getElementById('editBookTitle').value,
                author: document.getElementById('editBookAuthor').value,
                original_price: parseFloat(document.getElementById('editBookOriginalPrice').value),
                base_price: parseFloat(document.getElementById('editBookBasePrice').value),
                volumes: document.getElementById('editBookVolumes').value,
                pages: document.getElementById('editBookPages').value,
                year: document.getElementById('editBookYear').value,
                description: document.getElementById('editBookDescription').value,
                publisher_id: document.getElementById('editBookPublisherSelect').value || null,
                category_id: document.getElementById('editBookCategorySelect').value || null,
                discount: document.getElementById('editBookDiscount').value,
                text_color: getCustomInputValue('editBookTextColorSelect', 'editBookTextColorInput'),
                cover_type: getCustomInputValue('editBookCoverTypeSelect', 'editBookCoverTypeInput'),
                paper_type: getCustomInputValue('editBookPaperTypeSelect', 'editBookPaperTypeInput'),
                print_count: document.getElementById('editBookPrintCount').value ? parseInt(document.getElementById('editBookPrintCount').value) : null,
                editor: document.getElementById('editBookEditor').value,
                weight_value: document.getElementById('editBookWeightValue').value ? parseFloat(document.getElementById('editBookWeightValue').value) : null,
                weight_unit: document.getElementById('editBookWeightUnit').value
            };
            
            let imageUrl = null;
            if (document.querySelector('input[name="editBookImageSource"]:checked').value === 'url') {
                imageUrl = document.getElementById('editBookCoverImageUrl').value;
            } else {
                const file = document.getElementById('editBookCoverImageFile').files[0];
                if (file) {
                    imageUrl = await uploadImage(file, 'books');
                    if (!imageUrl) {
                        submitBtn.disabled = false;
                        submitBtn.textContent = 'Perbarui Buku';
                        return;
                    }
                } else {
                    imageUrl = document.getElementById('editBookOldCoverUrl').value;
                }
            }
            bookData.cover_image_url = imageUrl;

            const { error } = await supabase.from('books').update(bookData).eq('id', bookId);
                
            if (error) {
                console.error('Error updating book:', error);
                alert('Gagal memperbarui buku.');
            } else {
                closeEditModal();
                window.fetchBooks();
            }
            
            submitBtn.disabled = false;
            submitBtn.textContent = 'Perbarui Buku';
        });

        function closeEditModal() {
            editModal.style.display = 'none';
            editBookForm.reset();
            document.getElementById('editBookId').value = '';
            document.getElementById('editBookOldCoverUrl').value = '';
            document.getElementById('editBookImagePreview').style.display = 'none';
            document.getElementById('editBookCoverImageFile').style.display = 'block';
            document.getElementById('editBookCoverImageUrl').style.display = 'none';
        }

        closeModalBtn.addEventListener('click', closeEditModal);
        cancelEditModalBtn.addEventListener('click', closeEditModal);

        window.addEventListener('click', (e) => {
            if (e.target === editModal) {
                closeEditModal();
            }
        });

        const categoryForm = document.getElementById('categoryForm');
        const categoriesTableBody = document.getElementById('categoriesTableBody');
        const categoryFileInput = document.getElementById('categoryImageFile');
        const categoryImagePreview = document.getElementById('categoryImagePreview');
        const categoryNameIdInput = document.getElementById('categoryNameId');
        const categoryLinkInput = document.getElementById('categoryLink');

        categoryNameIdInput.addEventListener('input', (e) => {
            categoryLinkInput.value = `/kategori/${slugify(e.target.value)}`;
            saveFormData('categoryForm');
        });

        const renderCategories = (categories) => {
            categoriesTableBody.innerHTML = categories.map(c => `
                <tr>
                    <td><img src="${c.image_url || 'https://via.placeholder.com/60x60.png?text=No+Image'}" class="table-image" alt="Category"></td>
                    <td>${c.name_id}</td>
                    <td>${c.name_en}</td>
                    <td><span style="display:inline-block; width:20px; height:20px; background-color:${c.color}; border-radius:4px; vertical-align:middle;"></span> ${c.color}</td>
                    <td>${c.link ? `<a href="${c.link}" target="_blank">${c.link}</a>` : '-'}</td>
                    <td class="action-buttons">
                        <button class="btn edit-btn" data-id="${c.id}">✏️ Edit</button>
                        <button class="btn delete-btn" data-id="${c.id}">🗑️ Hapus</button>
                    </td>
                </tr>`).join('');
        };
        
        window.fetchCategories = () => fetchData('categories', 'categoriesTableBody', 'loadingCategories', renderCategories);
        
        categoryFileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                categoryImagePreview.src = URL.createObjectURL(file);
                categoryImagePreview.style.display = 'block';
            }
        });
        
        setupFormAutoSave('categoryForm');
        loadFormData('categoryForm');
        
        categoryForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const submitBtn = document.querySelector('#categoryForm .submit-btn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Menyimpan...';
            const categoryId = document.getElementById('categoryId').value;
            const categoryData = {
                name_id: document.getElementById('categoryNameId').value,
                name_en: document.getElementById('categoryNameEn').value,
                name_ar: document.getElementById('categoryNameAr').value,
                color: document.getElementById('categoryColor').value,
                link: categoryLinkInput.value
            };
            const file = categoryFileInput.files[0];
            if (file) {
                categoryData.image_url = await uploadImage(file, 'categories');
                if (!categoryData.image_url) {
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'Tambah Kategori';
                    return;
                }
            } else {
                categoryData.image_url = document.getElementById('categoryOldImageUrl').value;
            }
            const { error } = categoryId ? 
                await supabase.from('categories').update(categoryData).eq('id', categoryId) : 
                await supabase.from('categories').insert([categoryData]);
            if (error) {
                alert('Gagal menyimpan kategori.');
            } else {
                if (!categoryId) {
                    categoryForm.reset();
                    localStorage.removeItem('formData_categoryForm');
                }
                resetCategoryForm();
            }
            submitBtn.disabled = false;
            submitBtn.textContent = categoryId ? 'Perbarui Kategori' : 'Tambah Kategori';
            window.fetchCategories();
        });
        
        categoriesTableBody.addEventListener('click', async (e) => {
            const id = e.target.dataset.id;
            if (e.target.classList.contains('delete-btn')) {
                await deleteItem('categories', id, window.fetchCategories);
            }
            if (e.target.classList.contains('edit-btn')) {
                const { data } = await supabase.from('categories').select('*').eq('id', id).single();
                if (data) {
                    document.getElementById('categoryId').value = data.id;
                    document.getElementById('categoryNameId').value = data.name_id;
                    document.getElementById('categoryNameEn').value = data.name_en;
                    document.getElementById('categoryNameAr').value = data.name_ar;
                    document.getElementById('categoryColor').value = data.color;
                    categoryLinkInput.value = data.link || '';
                    document.getElementById('categoryOldImageUrl').value = data.image_url || '';
                    if (data.image_url) {
                        categoryImagePreview.src = data.image_url;
                        categoryImagePreview.style.display = 'block';
                    } else {
                        categoryImagePreview.style.display = 'none';
                    }
                    document.getElementById('categoriesFormTitle').textContent = 'Edit Kategori';
                    document.querySelector('#categoryForm .submit-btn').textContent = 'Perbarui Kategori';
                    document.getElementById('cancelEditCategory').style.display = 'inline-block';
                    categoryForm.scrollIntoView({ behavior: 'smooth' });
                    saveFormData('categoryForm');
                }
            }
        });
        
        function resetCategoryForm() {
            categoryForm.reset();
            document.getElementById('categoryId').value = '';
            document.getElementById('categoryOldImageUrl').value = '';
            categoryImagePreview.style.display = 'none';
            document.getElementById('categoriesFormTitle').textContent = 'Tambah Kategori Baru';
            document.querySelector('#categoryForm .submit-btn').textContent = 'Tambah Kategori';
            document.getElementById('cancelEditCategory').style.display = 'none';
        }
        
        document.getElementById('cancelEditCategory').addEventListener('click', resetCategoryForm);

        const publisherForm = document.getElementById('publisherForm');
        const publishersTableBody = document.getElementById('publishersTableBody');
        const publisherFileInput = document.getElementById('publisherLogoFile');
        const publisherImagePreview = document.getElementById('publisherImagePreview');
        
        const renderPublishers = (publishers) => {
            publishersTableBody.innerHTML = publishers.map(p => `
                <tr>
                    <td><img src="${p.logo_url || 'https://via.placeholder.com/60x60.png?text=No+Logo'}" class="table-image" alt="Logo"></td>
                    <td>${p.name}</td>
                    <td>${p.letter}</td>
                    <td>${p.discount || '-'}</td>
                    <td class="action-buttons">
                        <button class="btn edit-btn" data-id="${p.id}">✏️ Edit</button>
                        <button class="btn delete-btn" data-id="${p.id}">🗑️ Hapus</button>
                    </td>
                </tr>`).join('');
        };
        
        window.fetchPublishers = () => fetchData('publishers', 'publishersTableBody', 'loadingPublishers', renderPublishers);
        
        publisherFileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                publisherImagePreview.src = URL.createObjectURL(file);
                publisherImagePreview.style.display = 'block';
            }
        });
        
        setupFormAutoSave('publisherForm');
        loadFormData('publisherForm');
        
        publisherForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const submitBtn = document.querySelector('#publisherForm .submit-btn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Menyimpan...';
            const publisherId = document.getElementById('publisherId').value;
            const publisherData = {
                name: document.getElementById('publisherName').value,
                letter: document.getElementById('publisherLetter').value,
                discount: document.getElementById('publisherDiscount').value
            };
            const file = publisherFileInput.files[0];
            if (file) {
                publisherData.logo_url = await uploadImage(file, 'publishers');
                if (!publisherData.logo_url) {
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'Tambah Penerbit';
                    return;
                }
            } else {
                publisherData.logo_url = document.getElementById('publisherOldLogoUrl').value;
            }
            const { error } = publisherId ? 
                await supabase.from('publishers').update(publisherData).eq('id', publisherId) : 
                await supabase.from('publishers').insert([publisherData]);
            if (error) {
                alert('Gagal menyimpan penerbit.');
            } else {
                if (!publisherId) {
                    publisherForm.reset();
                    localStorage.removeItem('formData_publisherForm');
                }
                resetPublisherForm();
            }
            submitBtn.disabled = false;
            submitBtn.textContent = publisherId ? 'Perbarui Penerbit' : 'Tambah Penerbit';
            window.fetchPublishers();
        });
        
        publishersTableBody.addEventListener('click', async (e) => {
            const id = e.target.dataset.id;
            if (e.target.classList.contains('delete-btn')) {
                await deleteItem('publishers', id, window.fetchPublishers);
            }
            if (e.target.classList.contains('edit-btn')) {
                const { data } = await supabase.from('publishers').select('*').eq('id', id).single();
                if (data) {
                    document.getElementById('publisherId').value = data.id;
                    document.getElementById('publisherName').value = data.name;
                    document.getElementById('publisherLetter').value = data.letter;
                    document.getElementById('publisherDiscount').value = data.discount;
                    document.getElementById('publisherOldLogoUrl').value = data.logo_url || '';
                    if (data.logo_url) {
                        publisherImagePreview.src = data.logo_url;
                        publisherImagePreview.style.display = 'block';
                    } else {
                        publisherImagePreview.style.display = 'none';
                    }
                    document.getElementById('publishersFormTitle').textContent = 'Edit Penerbit';
                    document.querySelector('#publisherForm .submit-btn').textContent = 'Perbarui Penerbit';
                    document.getElementById('cancelEditPublisher').style.display = 'inline-block';
                    publisherForm.scrollIntoView({ behavior: 'smooth' });
                    saveFormData('publisherForm');
                }
            }
        });
        
        function resetPublisherForm() {
            publisherForm.reset();
            document.getElementById('publisherId').value = '';
            document.getElementById('publisherOldLogoUrl').value = '';
            publisherImagePreview.style.display = 'none';
            document.getElementById('publishersFormTitle').textContent = 'Tambah Penerbit Baru';
            document.querySelector('#publisherForm .submit-btn').textContent = 'Tambah Penerbit';
            document.getElementById('cancelEditPublisher').style.display = 'none';
        }
        
        document.getElementById('cancelEditPublisher').addEventListener('click', resetPublisherForm);

        const bannerForm = document.getElementById('bannerForm');
        const bannersTableBody = document.getElementById('bannersTableBody');
        const bannerFileInput = document.getElementById('bannerImageFile');
        const bannerImagePreview = document.getElementById('bannerImagePreview');
        
        const renderBanners = (banners) => {
            bannersTableBody.innerHTML = banners.map(b => `
                <tr>
                    <td><img src="${b.image_url || 'https://via.placeholder.com/60x60.png?text=No+Image'}" class="table-image" alt="Banner"></td>
                    <td>${b.title}</td>
                    <td>${b.type}</td>
                    <td>${b.display_order}</td>
                    <td class="action-buttons">
                        <button class="btn edit-btn" data-id="${b.id}">✏️ Edit</button>
                        <button class="btn delete-btn" data-id="${b.id}">🗑️ Hapus</button>
                    </td>
                </tr>`).join('');
        };
        
        window.fetchBanners = () => fetchData('banners', 'bannersTableBody', 'loadingBanners', renderBanners);
        
        bannerFileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                bannerImagePreview.src = URL.createObjectURL(file);
                bannerImagePreview.style.display = 'block';
            }
        });
        
        setupFormAutoSave('bannerForm');
        loadFormData('bannerForm');
        
        bannerForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const submitBtn = document.querySelector('#bannerForm .submit-btn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Menyimpan...';
            const bannerId = document.getElementById('bannerId').value;
            const bannerData = {
                title: document.getElementById('bannerTitle').value,
                type: document.getElementById('bannerType').value,
                display_order: parseInt(document.getElementById('bannerDisplayOrder').value) || 0
            };
            const file = bannerFileInput.files[0];
            if (file) {
                bannerData.image_url = await uploadImage(file, 'banners');
                if (!bannerData.image_url) {
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'Tambah Banner';
                    return;
                }
            } else {
                bannerData.image_url = document.getElementById('bannerOldImageUrl').value;
            }
            const { error } = bannerId ? 
                await supabase.from('banners').update(bannerData).eq('id', bannerId) : 
                await supabase.from('banners').insert([bannerData]);
            if (error) {
                alert('Gagal menyimpan banner.');
            } else {
                if (!bannerId) {
                    bannerForm.reset();
                    localStorage.removeItem('formData_bannerForm');
                }
                resetBannerForm();
            }
            submitBtn.disabled = false;
            submitBtn.textContent = bannerId ? 'Perbarui Banner' : 'Tambah Banner';
            window.fetchBanners();
        });
        
        bannersTableBody.addEventListener('click', async (e) => {
            const id = e.target.dataset.id;
            if (e.target.classList.contains('delete-btn')) {
                await deleteItem('banners', id, window.fetchBanners);
            }
            if (e.target.classList.contains('edit-btn')) {
                const { data } = await supabase.from('banners').select('*').eq('id', id).single();
                if (data) {
                    document.getElementById('bannerId').value = data.id;
                    document.getElementById('bannerTitle').value = data.title;
                    document.getElementById('bannerType').value = data.type;
                    document.getElementById('bannerDisplayOrder').value = data.display_order;
                    document.getElementById('bannerOldImageUrl').value = data.image_url || '';
                    if (data.image_url) {
                        bannerImagePreview.src = data.image_url;
                        bannerImagePreview.style.display = 'block';
                    } else {
                        bannerImagePreview.style.display = 'none';
                    }
                    document.getElementById('bannersFormTitle').textContent = 'Edit Banner';
                    document.querySelector('#bannerForm .submit-btn').textContent = 'Perbarui Banner';
                    document.getElementById('cancelEditBanner').style.display = 'inline-block';
                    bannerForm.scrollIntoView({ behavior: 'smooth' });
                    saveFormData('bannerForm');
                }
            }
        });
        
        function resetBannerForm() {
            bannerForm.reset();
            document.getElementById('bannerId').value = '';
            document.getElementById('bannerOldImageUrl').value = '';
            bannerImagePreview.style.display = 'none';
            document.getElementById('bannersFormTitle').textContent = 'Tambah Banner Baru';
            document.querySelector('#bannerForm .submit-btn').textContent = 'Tambah Banner';
            document.getElementById('cancelEditBanner').style.display = 'none';
        }
        
        document.getElementById('cancelEditBanner').addEventListener('click', resetBannerForm);

        const ordersTableBody = document.getElementById('ordersTableBody');
        const renderOrders = (orders) => {
            ordersTableBody.innerHTML = orders.map(o => `
                <tr>
                    <td>${o.name}</td>
                    <td>${o.book_title}</td>
                    <td>Rp ${o.total_price.toLocaleString('id-ID')}</td>
                    <td>${o.status}</td>
                    <td>${new Date(o.created_at).toLocaleString('id-ID')}</td>
                </tr>`).join('');
        };
        
        window.fetchOrders = () => fetchData('orders', 'ordersTableBody', 'loadingOrders', renderOrders);

        const currencyForm = document.getElementById('currencyForm');
        
        window.fetchCurrency = async () => {
            const { data, error } = await supabase.from('site_settings').select('usd_rate, egp_rate').single();
            if (error) {
                console.error('Error fetching currency settings:', error);
            } else if (data) {
                currencySettings = { usd_rate: data.usd_rate, egp_rate: data.egp_rate };
                document.getElementById('usdToIdr').value = currencySettings.usd_rate;
                document.getElementById('usdToEgp').value = currencySettings.egp_rate;
            }
        };
        
        setupFormAutoSave('currencyForm');
        loadFormData('currencyForm');
        
        currencyForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const newUsdRate = parseFloat(document.getElementById('usdToIdr').value);
            const newEgpRate = parseFloat(document.getElementById('usdToEgp').value);
            const { error } = await supabase.from('site_settings').update({
                usd_rate: newUsdRate,
                egp_rate: newEgpRate
            }).eq('id', (await supabase.from('site_settings').select('id').single()).data.id);
            if (error) {
                alert('Gagal memperbarui pengaturan kurs.');
            } else {
                alert('Pengaturan kurs berhasil disimpan!');
                currencySettings.usd_rate = newUsdRate;
                currencySettings.egp_rate = newEgpRate;
                if (document.getElementById('books-section').classList.contains('active')) {
                    window.fetchBooks();
                }
                updatePriceCalculator();
                saveFormData('currencyForm');
            }
        });

        window.fetchCurrency().then(() => {
            populatePublisherDropdown().then(() => {
                populateCategoryDropdown().then(() => {
                    window.fetchBooks();
                });
            });
        });
    });
    </script>
</body>
</html>
