<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Toko Buku Islam - Beranda</title>
    <style>
        /* === FONT & ROOT VARIABLES === */
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Lato:wght@400;700&display=swap');

        :root {
            --primary-color: #004ed6ff; /* Indigo modern */
            --primary-dark: #385ccaff; /* Indigo lebih gelap */
            --secondary-color: #06B6D4; /* Cyan */
            --accent-color: #F59E0B; /* Amber */
            --white: #ffffff;
            --light-bg: #F9FAFB; /* Abu-abu sangat muda */
            --card-bg: #ffffff;
            --border-color: #E5E7EB;
            --text-dark: #1F2937; /* Abu-abu gelap */
            --text-light: #6B7280; /* Abu-abu sedang */
            --danger-red: #EF4444;
            --success-green: #10B981;
            --font-heading: 'Poppins', sans-serif;
            --font-body: 'Lato', sans-serif;
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.1), 0 1px 2px rgba(0, 0, 0, 0.06);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.07), 0 2px 4px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1), 0 4px 6px rgba(0, 0, 0, 0.05);
            --border-radius: 16px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* === GENERAL STYLES === */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-body);
            background-color: var(--light-bg);
            color: var(--text-dark);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            padding-bottom: 60px; /* Space for bottom navbar */
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        section {
            padding: 3rem 0;
        }

        h1, h2, h3 {
            font-family: var(--font-heading);
            font-weight: 600;
            color: var(--text-dark);
        }
        
        .section-title {
            text-align: center;
            margin-bottom: 2.5rem;
            font-size: 2.2rem;
            font-weight: 700;
            position: relative;
            display: inline-block;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 4px;
            background-color: var(--primary-color);
            border-radius: 2px;
        }

        /* === HEADER / NAVBAR === */
        header {
            background-color: var(--primary-color);
            padding: 1rem 0;
            box-shadow: var(--shadow-md);
            position: sticky;
            top: 0;
            z-index: 1000;
            width: 100%;
            color: var(--white);
            transition: transform 0.3s ease;
        }

        header.hidden {
            transform: translateY(-100%);
        }

        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo-link {
            display: flex;
            align-items: center;
            text-decoration: none;
        }

        .logo {
            width: 90px;
            height: auto;
        }

        .search-bar {
            width: 40%;
            position: relative;
        }

        .search-bar input {
            width: 100%;
            padding: 0.8rem 1.2rem 0.8rem 2.5rem;
            border-radius: 50px;
            border: 1px solid var(--border-color);
            font-size: 1rem;
            transition: var(--transition);
            background-color: var(--white);
            color: var(--text-dark);
        }
        
        .search-bar input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.2);
        }
        
        .search-bar .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-light);
        }

        .search-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            width: 100%;
            max-height: 400px;
            overflow-y: auto;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
            display: none;
            z-index: 999;
        }

        .search-dropdown.active {
            display: block;
        }

        .search-result-item {
            display: flex;
            align-items: center;
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
            text-decoration: none;
            color: var(--text-dark);
            transition: var(--transition);
        }

        .search-result-item:hover {
            background: var(--light-bg);
        }

        .search-result-image {
            width: 50px;
            height: 75px;
            object-fit: cover;
            margin-right: 1rem;
            border-radius: 8px;
        }

        .search-result-info {
            flex-grow: 1;
        }

        .search-result-title {
            font-weight: 600;
            margin-bottom: 0.3rem;
        }

        .search-result-price {
            color: var(--primary-color);
            font-weight: bold;
        }

        .search-result-discount {
            color: var(--danger-red);
            margin-left: 0.5rem;
        }

        .search-result-actions {
            display: flex;
            gap: 0.5rem;
        }

        .mini-btn {
            padding: 0.3rem 0.6rem;
            border-radius: 20px;
            text-decoration: none;
            font-size: 0.8rem;
            transition: var(--transition);
        }

        .mini-buy {
            background: var(--primary-color);
            color: var(--white);
        }

        .mini-buy:hover {
            background: var(--primary-dark);
        }

        .mini-cart {
            background: var(--success-green);
            color: var(--white);
        }

        .mini-cart:hover {
            background: #059669;
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .currency-selector, .language-selector {
            margin-left: 0.5rem;
        }

        .currency-selector select, .language-selector select {
            padding: 0.5rem 1rem;
            border-radius: 50px;
            border: 1px solid var(--border-color);
            background: var(--white);
            cursor: pointer;
            color: var(--text-dark);
        }

        /* Cart Icon */
        .cart-icon {
            position: relative;
            cursor: pointer;
            font-size: 1.5rem;
            color: var(--white);
        }

        .cart-icon svg {
            width: 24px;
            height: 24px;
        }

        .cart-badge {
            position: absolute;
            top: -0.5rem;
            right: -0.5rem;
            background-color: var(--danger-red);
            color: var(--white);
            border-radius: 50%;
            padding: 0.2rem 0.5rem;
            font-size: 0.8rem;
            display: none;
        }

        .cart-badge.active {
            display: block;
        }

        /* === FLOATING SEARCH BAR === */
        .floating-search {
            position: fixed;
            top: -100px;
            left: 0;
            width: 100%;
            padding: 1rem 0;
            z-index: 999;
            transition: top 0.3s ease;
            display: flex;
            justify-content: center;
        }

        .floating-search.visible {
            top: 0;
        }

        .floating-search .container {
            width: 100%;
            max-width: 600px;
        }

        .floating-search .search-bar {
            width: 100%;
        }

        .floating-search .search-bar input {
            background-color: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: var(--shadow-lg);
        }

        /* === BREADCRUMB === */
        .breadcrumb {
            background-color: var(--card-bg);
            padding: 1rem 0;
            border-bottom: 1px solid var(--border-color);
        }

        .breadcrumb-list {
            display: flex;
            list-style: none;
            font-size: 0.9rem;
        }

        .breadcrumb-item {
            margin-right: 0.5rem;
        }

        .breadcrumb-item:not(:last-child)::after {
            content: "‚Ä∫";
            margin-left: 0.5rem;
            color: var(--text-light);
        }

        .breadcrumb-item a {
            color: var(--text-light);
            text-decoration: none;
            transition: var(--transition);
        }

        .breadcrumb-item a:hover {
            color: var(--primary-color);
        }

        .breadcrumb-item.active {
            color: var(--text-dark);
            font-weight: 500;
        }

        /* === HERO BANNERS === */
        .banner-slider {
            width: 100%;
            height: 450px;
            position: relative;
            overflow: hidden;
            border-radius: var(--border-radius);
            background: var(--border-color);
            box-shadow: var(--shadow-md);
        }

        .banner-slide {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 1s ease-in-out;
        }

        .banner-slide.active {
            opacity: 1;
        }

        .banner-slide img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* === PUBLISHERS SECTION === */
        .publishers-section {
            padding: 2rem 0;
        }

        .publisher-slider-container {
            position: relative;
            overflow: hidden;
            padding: 1rem 3rem;
        }

        .publisher-track {
            display: flex;
            transition: transform 0.5s ease;
        }

        .publisher-slide {
            flex: 0 0 20%;
            padding: 0 0.5rem;
            box-sizing: border-box;
        }

        .publisher-card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            text-align: center;
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
            text-decoration: none;
            color: var(--text-dark);
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100%;
            position: relative;
        }

        .publisher-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .publisher-card-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 1rem auto;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--primary-color);
            overflow: hidden;
        }
        
        .publisher-card-icon img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .publisher-card h3 {
            font-size: 1.1rem;
            font-weight: 500;
        }

        .publisher-book-count {
            font-size: 0.8rem;
            color: var(--text-light);
            margin-top: 0.3rem;
        }

        .discount-pin {
            position: absolute;
            top: -10px;
            right: -10px;
            background-color: var(--danger-red);
            color: var(--white);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.8rem;
            box-shadow: var(--shadow-md);
            transform: rotate(15deg);
            border: 2px solid var(--white);
        }

        .slider-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background-color: var(--primary-color);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--shadow-md);
        }

        #prevPublisher {
            left: 0;
        }

        #nextPublisher {
            right: 0;
        }

        .slider-btn:hover {
            background-color: var(--primary-dark);
            transform: scale(1.1) translateY(-50%);
        }

        /* === CATEGORIES SECTION === */
        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1.5rem;
        }

        .category-card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            text-align: center;
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
            text-decoration: none;
            color: var(--text-dark);
            cursor: pointer;
        }

        .category-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .category-card.active {
            border: 2px solid var(--primary-color);
        }

        .category-card-icon {
            width: 60px;
            height: 60px;
            margin: 0 auto 1rem auto;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--primary-color);
            /* PERBAIKAN: Hilangkan border tipis untuk mengecilkan bingkai */
        }
        
        .category-card-icon img {
            width: 80%; /* PERBAIKAN: Besarkan gambar dari 50% ke 80% */
            height: 80%;
            object-fit: contain;
            border-radius: 50%; /* PERBAIKAN: Buat foto bulat */
        }

        .category-card h3 {
            font-size: 1.1rem;
            font-weight: 500;
        }

        .category-book-count {
            font-size: 0.8rem;
            color: var(--text-light);
            margin-top: 0.3rem;
        }

        /* === PRODUCTS SECTION === */
        .product-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1.5rem;
        }

        .product-card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-sm);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            transition: var(--transition);
            cursor: pointer;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .product-image {
            height: 250px;
            background-color: var(--light-bg);
        }

        .product-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .product-info {
            padding: 1.2rem;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .product-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            height: 3.3em;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .product-author {
            color: var(--text-light);
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        .product-publisher {
            color: var(--text-light);
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        .product-year {
            color: var(--text-light);
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        .product-pages {
            color: var(--text-light);
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        .product-pricing {
            margin-top: auto;
        }

        .final-price {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .original-price {
            font-size: 1rem;
            color: var(--text-light);
            text-decoration: line-through;
            margin-left: 0.5rem;
        }
        
        .discount-badge {
            background-color: var(--danger-red);
            color: var(--white);
            padding: 0.2rem 0.5rem;
            border-radius: 5px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-left: 0.5rem;
        }

        .product-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 1rem;
        }

        .btn-add-to-cart-card, .btn-buy-card {
            padding: 0.5rem;
            border-radius: 50%;
            text-decoration: none;
            font-weight: bold;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
        }

        .btn-add-to-cart-card {
            background-color: var(--success-green);
            color: var(--white);
        }

        .btn-add-to-cart-card:hover {
            background-color: #059669;
        }

        .btn-buy-card {
            background-color: var(--primary-color);
            color: var(--white);
        }

        .btn-buy-card:hover {
            background-color: var(--primary-dark);
        }

        /* === PAGINATION === */
        .pagination {
            display: flex;
            justify-content: center;
            margin-top: 2rem;
            gap: 0.5rem;
        }

        .pagination button {
            padding: 0.5rem 1rem;
            border: 1px solid var(--border-color);
            background: var(--card-bg);
            cursor: pointer;
            border-radius: 8px;
            transition: var(--transition);
            color: var(--text-dark);
        }

        .pagination button.active {
            background: var(--primary-color);
            color: var(--white);
            border-color: var(--primary-color);
        }

        .pagination button:hover {
            background: var(--primary-dark);
            color: var(--white);
        }

        /* === CART MODAL === */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--card-bg);
            padding: 2rem;
            border-radius: var(--border-radius);
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            box-shadow: var(--shadow-lg);
        }

        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 2rem;
            cursor: pointer;
            color: var(--text-light);
            background: none;
            border: none;
        }

        .cart-item {
            display: flex;
            gap: 1rem;
            padding: 1rem 0;
            border-bottom: 1px solid var(--border-color);
        }

        .cart-item img {
            width: 80px;
            height: 120px;
            object-fit: cover;
            border-radius: 8px;
        }

        .cart-item-info {
            flex-grow: 1;
        }

        .cart-item-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .cart-item-price {
            color: var(--primary-color);
            font-weight: bold;
        }

        .cart-item-remove {
            color: var(--white);
            cursor: pointer;
            background: var(--danger-red);
            border: none;
            font-size: 1rem;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            transition: var(--transition);
        }

        .cart-item-remove:hover {
            background-color: #DC2626;
        }

        .cart-total {
            text-align: right;
            font-weight: bold;
            margin-top: 1rem;
        }

        .btn-checkout {
            display: block;
            width: 100%;
            padding: 1rem;
            background-color: var(--primary-color);
            color: var(--white);
            text-align: center;
            border-radius: 50px;
            text-decoration: none;
            margin-top: 1rem;
            transition: var(--transition);
        }

        .btn-checkout:hover {
            background-color: var(--primary-dark);
        }

        /* === LOADER === */
        .loader-container {
            text-align: center;
            padding: 4rem;
        }
        
        .loader {
            border: 5px solid var(--border-color);
            border-top: 5px solid var(--primary-color);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* === FILTER INFO === */
        .filter-info {
            background-color: var(--card-bg);
            padding: 1rem 1.5rem;
            border-radius: var(--border-radius);
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow-sm);
        }

        .filter-info h3 {
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
        }

        .filter-info p {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .clear-filter {
            background-color: var(--danger-red);
            color: var(--white);
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
        }

        .clear-filter:hover {
            background-color: #DC2626;
        }

        /* === FOOTER === */
        footer {
            background-color: var(--primary-color);
            color: var(--white);
            padding: 2rem 0;
            text-align: center;
        }

        /* === PRODUCT DETAIL PAGE === */
        .product-detail-container {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .product-detail-image {
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow-md);
        }

        .product-detail-image img {
            width: 100%;
            height: auto;
            object-fit: cover;
        }

        .product-detail-info {
            background: var(--card-bg);
            padding: 2rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-md);
        }

        .product-detail-info h1 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .product-detail-info .author {
            font-size: 1.1rem;
            color: var(--text-light);
            margin-bottom: 0.5rem;
        }

        .product-detail-info .publisher {
            font-size: 1rem;
            margin-bottom: 0.5rem;
        }

        .product-detail-info .year {
            font-size: 1rem;
            margin-bottom: 0.5rem;
        }

        .product-detail-info .pages {
            font-size: 1rem;
            margin-bottom: 1rem;
        }

        .product-detail-info .pricing {
            margin: 1.5rem 0;
        }

        .product-detail-info .description {
            margin: 1rem 0;
        }

        .details-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.8rem;
            margin-top: 1rem;
            background: var(--light-bg);
            padding: 1rem;
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
        }

        .detail-item {
            font-size: 0.9rem;
        }

        .detail-item strong {
            color: var(--text-dark);
            margin-right: 0.5rem;
        }
        
        .btn-buy, .btn-add-to-cart {
            display: inline-block;
            padding: 0.8rem 2rem;
            border-radius: 50px;
            text-decoration: none;
            font-weight: bold;
            transition: var(--transition);
            margin-right: 1rem;
            cursor: pointer;
            border: none;
        }

        .btn-buy {
            background-color: var(--primary-color);
            color: var(--white);
        }

        .btn-buy:hover {
            background-color: var(--primary-dark);
        }

        .btn-add-to-cart {
            background-color: var(--success-green);
            color: var(--white);
        }

        .btn-add-to-cart:hover {
            background-color: #059669;
        }

        /* === ORDER PAGE === */
        .order-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

        .order-form-container {
            background: var(--card-bg);
            padding: 2rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-md);
        }

        .order-form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .order-form input, .order-form select {
            padding: 0.8rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: var(--white);
            color: var(--text-dark);
        }

        .order-form button {
            padding: 0.8rem;
            background-color: var(--primary-color);
            color: var(--white);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
        }

        .order-form button:hover {
            background-color: var(--primary-dark);
        }

        .order-items {
            margin-bottom: 2rem;
        }

        .recommended-products {
            background: var(--card-bg);
            padding: 2rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-md);
        }

        .recommended-products h2 {
            margin-bottom: 1.5rem;
            position: relative;
            display: inline-block;
        }

        .recommended-products h2::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 0;
            width: 60px;
            height: 4px;
            background-color: var(--primary-color);
            border-radius: 2px;
        }

        .recommended-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }

        .recommended-card {
            display: flex;
            gap: 1rem;
            padding: 1rem;
            border-radius: 8px;
            background: var(--light-bg);
            transition: var(--transition);
            cursor: pointer;
        }

        .recommended-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-md);
        }

        .recommended-image {
            width: 80px;
            height: 120px;
            object-fit: cover;
            border-radius: 8px;
        }

        .recommended-info {
            flex-grow: 1;
        }

        .recommended-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .recommended-price {
            color: var(--primary-color);
            font-weight: bold;
        }

        /* === FORM VALIDATION STYLES === */
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .form-group label {
            font-weight: 500;
            color: var(--text-dark);
        }

        .form-group input:invalid {
            border-color: var(--danger-red);
        }

        .form-group input:valid {
            border-color: var(--success-green);
        }

        .error-message {
            color: var(--danger-red);
            font-size: 0.8rem;
            display: none;
        }

        .phone-input-group {
            display: flex;
            gap: 0.5rem;
        }

        .phone-country {
            flex: 0 0 100px;
        }

        .phone-number {
            flex: 1;
        }

        /* === BOTTOM NAVBAR FOR MOBILE === */
        .bottom-navbar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: var(--white);
            box-shadow: var(--shadow-md);
            display: flex;
            justify-content: space-around;
            align-items: center;
            height: 60px;
            z-index: 1000;
            display: none; /* Hidden by default, shown on mobile */
        }

        .bottom-navbar a {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: var(--text-dark);
            font-size: 0.8rem;
        }

        .bottom-navbar svg {
            width: 24px;
            height: 24px;
            margin-bottom: 0.2rem;
        }

        @media (max-width: 768px) {
            .bottom-navbar {
                display: flex;
            }
        }

        /* === PAYMENT METHODS SECTION === */
        .payment-methods {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 1rem;
            margin-top: 1rem;
        }

        .payment-methods img {
            height: 40px;
            object-fit: contain;
        }

        /* === RESPONSIVE DESIGN (Mobile App-like) === */
        @media (max-width: 768px) {
            .navbar {
                flex-wrap: wrap;
                justify-content: space-between;
            }
            
            .logo-link {
                display: none; /* PERBAIKAN: Sembunyikan logo di mobile */
            }
            
            .search-bar {
                width: 100%;
                order: 1;
                margin-top: 0;
            }
            
            .header-controls {
                width: 100%;
                justify-content: flex-end;
                order: 2;
                gap: 0.5rem;
                margin-top: 0.5rem;
            }
            
            /* PERBAIKAN: Hapus modifikasi icon-only untuk mata uang dan bahasa di mobile */
            .language-selector select, .currency-selector select {
                padding: 0.5rem 1rem;
                width: auto;
                text-indent: 0;
                background-size: auto;
                background-position: auto;
                background-repeat: auto;
                border-radius: 50px;
                font-size: 1rem;
            }
            
            .cart-icon {
                width: 35px;
                height: 35px;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .product-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .section-title {
                font-size: 1.8rem;
            }
            
            .banner-slider {
                height: 200px;
            }
            
            .filter-info {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
            
            .publisher-slide {
                flex: 0 0 20%; /* 5 kolom di mobile */
            }
            
            .category-grid {
                grid-template-columns: repeat(4, 1fr); /* 4 kolom di mobile */
                gap: 0.5rem; /* Mengurangi gap agar tidak terpotong */
            }
            
            .category-card {
                padding: 0.6rem; /* Mengurangi padding agar tidak terpotong */
            }
            
            .category-card-icon {
                width: 40px;
                height: 40px;
                margin: 0 auto 0.5rem auto;
                /* PERBAIKAN: Hilangkan border di mobile juga */
            }
            
            .category-card h3 {
                font-size: 0.75rem; /* Mengurangi ukuran font agar tidak terpotong */
                line-height: 1.2;
            }
            
            .header-controls {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .publisher-slider-container {
                padding: 1rem 2rem;
            }
            
            body {
                padding-bottom: 60px;
            }
            
            .product-detail-container {
                grid-template-columns: 1fr;
            }
            
            .order-container {
                grid-template-columns: 1fr;
            }
            
            .recommended-grid {
                grid-template-columns: 1fr;
            }
            
            .phone-input-group {
                flex-direction: column;
            }
            
            .phone-country {
                flex: 1;
            }
        }

        @media (max-width: 576px) {
            .product-grid {
                grid-template-columns: repeat(2, 1fr); /* 2 kolom untuk mobile kecil */
            }
            
            .details-grid {
                grid-template-columns: 1fr;
            }
            
            .publisher-slide {
                flex: 0 0 20%; /* Tetap 5 kolom */
            }
            
            .category-grid {
                grid-template-columns: repeat(4, 1fr); /* Tetap 4 kolom */
                gap: 0.3rem; /* Mengurangi gap lebih kecil */
            }
            
            .category-card {
                padding: 0.4rem; /* Mengurangi padding lebih kecil */
            }
            
            .category-card-icon {
                width: 35px;
                height: 35px;
                margin: 0 auto 0.3rem auto;
            }
            
            .category-card h3 {
                font-size: 0.7rem; /* Mengurangi ukuran font lebih kecil */
                line-height: 1.1;
            }
            
            .banner-slider {
                height: 150px;
            }
        }
    </style>
</head>
<body>

    <header id="header">
        <div class="container navbar">
            <a href="#" class="logo-link" id="homeLink">
                <img src="Logo darl imam qarrafi.png" alt="Toko Buku Islam" class="logo">
            </a>
            <div class="search-bar">
                <span class="search-icon">üîç</span>
                <input type="text" id="searchInput" data-i18n-placeholder="searchPlaceholder">
                <div id="searchDropdown" class="search-dropdown"></div>
            </div>
            <div class="header-controls">
                <div class="language-selector">
                    <select id="languageSelect">
                        <option value="id">ID</option>
                        <option value="en">EN</option>
                        <option value="ar">AR</option>
                    </select>
                </div>
                <div class="currency-selector">
                    <select id="currencySelect">
                        <option value="IDR">IDR</option>
                        <option value="USD">USD</option>
                        <option value="EGP">EGP</option>
                    </select>
                </div>
                <div class="cart-icon" id="cartIcon">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M2 2H3.74001C4.82001 2 5.67 2.93 5.58 4L4.75 13.96C4.61 15.59 5.89 16.99 7.53 17H18.08C19.72 17 21 15.6 20.86 13.97L21.24 9.01001C21.36 7.41001 20.08 6.01001 18.44 6.01001H5.82M16.25 22C16.9404 22 17.5 21.4404 17.5 20.75C17.5 20.0596 16.9404 19.5 16.25 19.5C15.5596 19.5 15 20.0596 15 20.75C15 21.4404 15.5596 22 16.25 22ZM7.25 22C7.94036 22 8.5 21.4404 8.5 20.75C8.5 20.0596 7.94036 19.5 7.25 19.5C6.55964 19.5 6 20.0596 6 20.75C6 21.4404 6.55964 22 7.25 22Z" stroke="currentColor" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span id="cartBadge" class="cart-badge"></span>
                </div>
            </div>
        </div>
    </header>

    <!-- Floating Search Bar -->
    <div class="floating-search" id="floatingSearch">
        <div class="container">
            <div class="search-bar">
                <span class="search-icon">üîç</span>
                <input type="text" id="floatingSearchInput" data-i18n-placeholder="searchPlaceholder">
                <div id="floatingSearchDropdown" class="search-dropdown"></div>
            </div>
        </div>
    </div>

    <!-- Breadcrumb Navigation -->
    <div class="breadcrumb" id="breadcrumb" style="display: none;">
        <div class="container">
            <ul class="breadcrumb-list">
                <li class="breadcrumb-item"><a href="#" id="breadcrumbHome" data-i18n="home">Beranda</a></li>
                <li class="breadcrumb-item active" id="breadcrumbCurrent"></li>
            </ul>
        </div>
    </div>

    <main id="mainContent">
        <!-- Home Page Content -->
        <div id="homePage">
            <section id="banners-section" style="padding: 2rem 0 0 0;">
                <div class="container">
                    <div id="bannerSlider" class="banner-slider">
                        <div class="loader-container">
                            <div class="loader"></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Penerbit dipindahkan ke bawah banner -->
            <section id="publishers-section" class="publishers-section">
                <div class="container">
                    <h2 class="section-title" data-i18n="publishers">Penerbit</h2>
                    <div class="publisher-slider-container">
                        <div id="publisherTrack" class="publisher-track">
                            <!-- Penerbit akan dimuat di sini -->
                        </div>
                        <button class="slider-btn" id="prevPublisher">&#10094;</button>
                        <button class="slider-btn" id="nextPublisher">&#10095;</button>
                    </div>
                </div>
            </section>

            <section id="categories-section">
                <div class="container">
                    <h2 class="section-title" data-i18n="exploreCategories">Jelajahi Kategori</h2>
                    <div id="categoryGrid" class="category-grid">
                        <div class="loader-container" style="grid-column: 1 / -1;">
                            <div class="loader"></div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="products-section" style="background-color: var(--white);">
                <div class="container">
                    <div id="filterInfo" class="filter-info" style="display: none;">
                        <div>
                            <h3 id="filterTitle"></h3>
                            <p id="filterDescription"></p>
                        </div>
                        <button class="clear-filter" id="clearFilter" data-i18n="clearFilter">Hapus Filter</button>
                    </div>
                    <h2 class="section-title" id="productsTitle" data-i18n="newCollection">Koleksi Buku Terbaru</h2>
                    <div id="productGrid" class="product-grid">
                        <div class="loader-container" style="grid-column: 1 / -1;">
                            <div class="loader"></div>
                        </div>
                    </div>
                    <div id="pagination" class="pagination"></div>
                </div>
            </section>
        </div>

        <!-- Product Detail Page (Hidden by default) -->
        <div id="productDetailPage" style="display: none;">
            <div class="container">
                <div class="product-detail-container">
                    <div class="product-detail-image">
                        <img id="detailImage" src="" alt="">
                    </div>
                    <div class="product-detail-info">
                        <h1 id="detailTitle"></h1>
                        <p class="author" id="detailAuthor" data-i18n-prefix="by"></p>
                        <p class="publisher" id="detailPublisher" data-i18n-prefix="publisher"></p>
                        <p class="year" id="detailYear" data-i18n-prefix="year"></p>
                        <p class="pages" id="detailPages" data-i18n-prefix="pages"></p>
                        <div class="pricing" id="detailPricing"></div>
                        <p class="description" id="detailDescription"></p>
                        <div class="details-grid" id="detailGrid"></div>
                        <div style="margin-top: 2rem;">
                            <button class="btn-buy" id="detailBackBtn" data-i18n="backToHome">üîô Kembali ke Beranda</button>
                            <button class="btn-add-to-cart" id="detailAddToCartBtn" data-i18n="addToCart">‚ûï Tambah ke Keranjang</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Order Page (Hidden by default) -->
        <div id="orderPage" style="display: none;">
            <div class="container">
                <div class="order-container">
                    <div class="order-form-container">
                        <h2 data-i18n="orderForm">Form Pemesanan</h2>
                        <div id="orderItems" class="order-items"></div>
                        <form id="orderForm" class="order-form">
                            <div class="form-group">
                                <label for="nameInput" data-i18n="fullName">Nama Lengkap *</label>
                                <input type="text" id="nameInput" data-i18n-placeholder="fullNamePlaceholder" required>
                                <div class="error-message" id="nameError" data-i18n="nameRequired">Nama harus diisi</div>
                            </div>
                            
                            <div class="form-group">
                                <label for="phoneInput" data-i18n="phoneNumber">Nomor Telepon *</label>
                                <div class="phone-input-group">
                                    <select id="phoneCountry" class="phone-country" required>
                                        <option value="+62">Indonesia (+62)</option>
                                        <option value="+966">Arab Saudi (+966)</option>
                                        <option value="+971">UEA (+971)</option>
                                        <option value="+974">Qatar (+974)</option>
                                        <option value="+965">Kuwait (+965)</option>
                                        <option value="+973">Bahrain (+973)</option>
                                        <option value="+968">Oman (+968)</option>
                                        <option value="+20">Mesir (+20)</option>
                                        <option value="+212">Maroko (+212)</option>
                                        <option value="+216">Tunisia (+216)</option>
                                        <option value="+1">USA/Canada (+1)</option>
                                        <option value="+44">UK (+44)</option>
                                        <option value="+33">Prancis (+33)</option>
                                        <option value="+49">Jerman (+49)</option>
                                        <option value="+60">Malaysia (+60)</option>
                                        <option value="+65">Singapura (+65)</option>
                                        <option value="+63">Filipina (+63)</option>
                                        <option value="+66">Thailand (+66)</option>
                                    </select>
                                    <input type="tel" id="phoneInput" class="phone-number" data-i18n-placeholder="phonePlaceholder" required>
                                </div>
                                <div class="error-message" id="phoneError" data-i18n="phoneRequired">Nomor telepon harus diisi</div>
                            </div>
                            
                            <div class="form-group">
                                <label for="addressInput" data-i18n="fullAddress">Alamat Lengkap *</label>
                                <input type="text" id="addressInput" data-i18n-placeholder="addressPlaceholder" required>
                                <div class="error-message" id="addressError" data-i18n="addressRequired">Alamat harus diisi</div>
                            </div>
                            
                            <div class="form-group">
                                <label for="locationInput" data-i18n="locationCoordinates">Koordinat Lokasi (Opsional)</label>
                                <input type="text" id="locationInput" data-i18n-placeholder="locationPlaceholder" readonly>
                                <div class="error-message" id="locationError"></div>
                            </div>
                            
                            <button type="button" id="detectLocationBtn" data-i18n="detectLocation">üìç Deteksi Lokasi Otomatis</button>
                            <button type="button" id="viewMapBtn" style="display: none;" data-i18n="viewMap">üó∫Ô∏è Lihat di Google Maps</button>
                            
                            <div class="form-group">
                                <label for="paymentMethod" data-i18n="paymentMethod">Metode Pembayaran *</label>
                                <select id="paymentMethod" required>
                                    <option value="" data-i18n="selectPayment">Pilih Metode Pembayaran</option>
                                    <option value="id" data-i18n="waIndonesia">WA Indonesia (85163682122)</option>
                                    <option value="ar" data-i18n="waArab">WA Arab (1014006053)</option>
                                </select>
                                <div class="error-message" id="paymentError" data-i18n="paymentRequired">Pilih metode pembayaran</div>
                            </div>
                            
                            <button type="submit" data-i18n="orderNow">üì¶ Pesan Sekarang</button>
                        </form>
                    </div>
                    <div class="recommended-products">
                        <h2 data-i18n="recommendedProducts">Produk Rekomendasi</h2>
                        <div id="recommendedGrid" class="recommended-grid">
                            <!-- Produk rekomendasi akan dimuat di sini -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <footer>
        <div class="container">
            <p>&copy; 2025 Toko Buku Islam. <span data-i18n="copyright">Hak Cipta Dilindungi</span>.</p>
            <div class="payment-methods">
                <img src="https://www.bayarind.id/wp-content/themes/bayarind/assets/img/logo-all-pg.webp" alt="Metode Pembayaran Indonesia">
                <img src="https://t4.ftcdn.net/jpg/15/48/74/35/360_F_1548743528_v3ubiVNmUg02qcXnCLwIyB7njRV1Qkfg.jpg" alt="Cash Payment">
                <img src="https://play-lh.googleusercontent.com/Pv1p8v-KJq4Z_LLOjQjBZpK8DNJg4Zb5aNOQY7WfoiHR4Gfs165Z1TTNMThZ883Yfg=w240-h480-rw" alt="InstaPay">
            </div>
        </div>
    </footer>

    <div id="cartModal" class="modal">
        <div class="modal-content">
            <button id="cartModalClose" class="modal-close">&times;</button>
            <h2 data-i18n="cart">Keranjang Belanja</h2>
            <div id="cartItems"></div>
            <div class="cart-total" id="cartTotal"></div>
            <a href="#" class="btn-checkout" id="checkoutBtn" data-i18n="checkout">Checkout</a>
        </div>
    </div>

    <!-- Bottom Navbar for Mobile -->
    <nav class="bottom-navbar">
        <a href="#" id="bottomHome">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V9z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M9 22V12h6v10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span data-i18n="home">Beranda</span>
        </a>
        <a href="#" id="bottomSearch">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M21 21l-6-6m2-5a7 7 0 1 1-14 0 7 7 0 0 1 14 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span data-i18n="search">Cari</span>
        </a>
        <a href="#" id="bottomCart">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M2 2H3.74001C4.82001 2 5.67 2.93 5.58 4L4.75 13.96C4.61 15.59 5.89 16.99 7.53 17H18.08C19.72 17 21 15.6 20.86 13.97L21.24 9.01001C21.36 7.41001 20.08 6.01001 18.44 6.01001H5.82M16.25 22C16.9404 22 17.5 21.4404 17.5 20.75C17.5 20.0596 16.9404 19.5 16.25 19.5C15.5596 19.5 15 20.0596 15 20.75C15 21.4404 15.5596 22 16.25 22ZM7.25 22C7.94036 22 8.5 21.4404 8.5 20.75C8.5 20.0596 7.94036 19.5 7.25 19.5C6.55964 19.5 6 20.0596 6 20.75C6 21.4404 6.55964 22 7.25 22Z" stroke="currentColor" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span data-i18n="cart">Keranjang</span>
        </a>
        <a href="#" id="bottomPayment">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M2 6h20v12H2V6z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M2 10h20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span data-i18n="payment">Pembayaran</span>
        </a>
    </nav>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // ==================== KONFIGURASI SUPABASE ====================
            const supabaseUrl = 'https://rfqpsuzmonfmnvthxinb.supabase.co';
            const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJmcXBzdXptb25mbW52dGh4aW5iIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA1OTQyMjUsImV4cCI6MjA3NjE3MDIyNX0.gJFzuE-KJrdSoIKMTIDszTdNLDl_sJkIhgo7wmXRGWA';
            const supabase = window.supabase.createClient(supabaseUrl, supabaseAnonKey);

            // Nomor WA - SESUAI PERMINTAAN
            const waIndonesia = '6285163682122'; // Nomor Indonesia tanpa +62
            const waArab = '201014006053'; // Nomor Arab tanpa +20

            // ==================== VARIABEL GLOBAL & STATE ====================
            let allBooks = [];
            let categories = [];
            let publishers = [];
            let currencySettings = { usd_rate: 16000, egp_rate: 50 };
            let currentBannerIndex = 0;
            let currentPublisherIndex = 0;
            let currentCurrency = localStorage.getItem('currentCurrency') || 'IDR';
            let currentLanguage = localStorage.getItem('currentLanguage') || 'id';
            let selectedCategory = null;
            let selectedPublisher = null;
            let currentPage = 1;
            const booksPerPage = 8;
            let publisherInterval;
            let cart = JSON.parse(localStorage.getItem('cart')) || [];
            let orderItems = [];
            let currentBook = null;
            let lastScrollTop = 0;
            let ticking = false;
            let detectedLocation = null;

            // ==================== FUNGSI HELPER ====================
            function formatPrice(price, currency = 'IDR') {
                let rate = 1, symbol = 'Rp ', locale = 'id-ID';
                if (currency === 'USD') {
                    symbol = '$';
                    locale = 'en-US';
                    currency = 'USD';
                    rate = 1;
                } else if (currency === 'EGP') {
                    rate = currencySettings.egp_rate;
                    symbol = 'E¬£ ';
                    locale = 'en-EG';
                    currency = 'EGP';
                } else { // IDR
                    rate = currencySettings.usd_rate;
                    currency = 'IDR';
                }
                
                return new Intl.NumberFormat(locale, {
                    style: 'currency',
                    currency: currency,
                    minimumFractionDigits: 0
                }).format(price * rate).replace('IDR', 'Rp').replace('USD', '$').replace('EGP', 'E¬£');
            }

            function calculateDiscountedPrice(basePrice, discount, publisherDiscount = '') {
                if (!basePrice) return 0;
                let effectiveDiscount = discount || publisherDiscount;
                if (!effectiveDiscount) return basePrice;
                const discountPercent = parseFloat(effectiveDiscount.replace('%', '')) || 0;
                return basePrice * (1 - discountPercent / 100);
            }

            function navigateToCategory(categoryId) {
                const url = new URL(window.location);
                url.searchParams.set('category', categoryId);
                url.searchParams.delete('publisher');
                window.location.href = url.toString();
            }

            function navigateToPublisher(publisherId) {
                const url = new URL(window.location);
                url.searchParams.set('publisher', publisherId);
                url.searchParams.delete('category');
                window.location.href = url.toString();
            }

            function navigateToHome() {
                const url = new URL(window.location);
                url.searchParams.delete('category');
                url.searchParams.delete('publisher');
                url.searchParams.delete('product');
                url.searchParams.delete('order');
                window.location.href = url.toString();
            }

            function navigateToProductDetail(bookId) {
                const url = new URL(window.location);
                url.searchParams.set('product', bookId);
                window.location.href = url.toString();
            }

            function navigateToOrder(singleBook = null) {
                const url = new URL(window.location);
                url.searchParams.set('order', 'true');
                if (singleBook) {
                    url.searchParams.set('single', singleBook.id);
                } else {
                    url.searchParams.delete('single');
                }
                window.location.href = url.toString();
            }

            function updateBreadcrumb(filterType, filterName) {
                const breadcrumb = document.getElementById('breadcrumb');
                const breadcrumbCurrent = document.getElementById('breadcrumbCurrent');
                
                if (filterType) {
                    breadcrumb.style.display = 'block';
                    if (filterType === 'order') {
                        if (currentBook && orderItems.length === 1) {
                            breadcrumbCurrent.textContent = `${currentBook.title} > ${translations[currentLanguage].orderForm}`;
                        } else {
                            breadcrumbCurrent.textContent = translations[currentLanguage].orderForm;
                        }
                    } else if (filterType === 'product') {
                        breadcrumbCurrent.textContent = filterName;
                    } else {
                        breadcrumbCurrent.textContent = filterName;
                    }
                } else {
                    breadcrumb.style.display = 'none';
                }
            }

            function updateFilterInfo(filterType, filterName, description) {
                const filterInfo = document.getElementById('filterInfo');
                const filterTitle = document.getElementById('filterTitle');
                const filterDescription = document.getElementById('filterDescription');
                const productsTitle = document.getElementById('productsTitle');
                
                if (filterType) {
                    filterInfo.style.display = 'flex';
                    filterTitle.textContent = filterName;
                    filterDescription.textContent = description;
                    productsTitle.textContent = `${translations[currentLanguage].books} ${filterName}`;
                } else {
                    filterInfo.style.display = 'none';
                    productsTitle.textContent = translations[currentLanguage].newCollection;
                }
            }

            // ==================== FUNGSI MULTI-BAHASA ====================
            const translations = {
                id: {
                    searchPlaceholder: "Cari judul atau penulis buku...",
                    publishers: "Penerbit",
                    exploreCategories: "Jelajahi Kategori",
                    newCollection: "Koleksi Buku Terbaru",
                    clearFilter: "Hapus Filter",
                    noBooksFound: "Tidak ada buku yang ditemukan.",
                    copyright: "Hak Cipta Dilindungi",
                    by: "oleh",
                    publisher: "Penerbit",
                    year: "Tahun Terbit",
                    pages: "Halaman",
                    buyNow: "Beli",
                    addToCart: "Keranjang",
                    noDescription: "Tidak ada deskripsi tersedia.",
                    cart: "Keranjang Belanja",
                    checkout: "Checkout",
                    total: "Total",
                    remove: "Hapus",
                    orderForm: "Form Pemesanan",
                    orderNow: "Pesan Sekarang",
                    fullName: "Nama Lengkap",
                    fullNamePlaceholder: "Nama Lengkap",
                    nameRequired: "Nama harus diisi",
                    phoneNumber: "Nomor Telepon",
                    phonePlaceholder: "81234567890",
                    phoneRequired: "Nomor telepon harus diisi",
                    fullAddress: "Alamat Lengkap",
                    addressPlaceholder: "Alamat lengkap (jalan, kota, provinsi)",
                    addressRequired: "Alamat harus diisi",
                    locationCoordinates: "Koordinat Lokasi (Opsional)",
                    locationPlaceholder: "Koordinat lokasi akan terisi otomatis",
                    detectLocation: "üìç Deteksi Lokasi Otomatis",
                    viewMap: "üó∫Ô∏è Lihat di Google Maps",
                    paymentMethod: "Metode Pembayaran",
                    selectPayment: "Pilih Metode Pembayaran",
                    waIndonesia: "WA Indonesia (85163682122)",
                    waArab: "WA Arab (1014006053)",
                    paymentRequired: "Pilih metode pembayaran",
                    recommendedProducts: "Produk Rekomendasi",
                    home: "Beranda",
                    search: "Cari",
                    cartShort: "Keranjang",
                    payment: "Pembayaran",
                    backToHome: "üîô Kembali ke Beranda",
                    books: "Buku",
                    weight: "Berat",
                    coverType: "Jenis Sampul",
                    paperType: "Jenis Kertas",
                    volumes: "Jumlah Jilid",
                    textColor: "Warna Teks",
                    printCount: "Cetakan Ke",
                    editor: "Editor",
                    isbn: "ISBN",
                    dimensions: "Ukuran",
                    language: "Bahasa",
                    translator: "Penerjemah",
                    reviewer: "Penelaah",
                    orderItems: "Item Pemesanan",
                    noItems: "Tidak ada item. Silakan tambah item terlebih dahulu."
                },
                en: {
                    searchPlaceholder: "Search for book title or author...",
                    publishers: "Publishers",
                    exploreCategories: "Explore Categories",
                    newCollection: "New Book Collection",
                    clearFilter: "Clear Filter",
                    noBooksFound: "No books found.",
                    copyright: "Copyright Protected",
                    by: "by",
                    publisher: "Publisher",
                    year: "Publication Year",
                    pages: "Pages",
                    buyNow: "Buy",
                    addToCart: "Cart",
                    noDescription: "No description available.",
                    cart: "Shopping Cart",
                    checkout: "Checkout",
                    total: "Total",
                    remove: "Remove",
                    orderForm: "Order Form",
                    orderNow: "Order Now",
                    fullName: "Full Name",
                    fullNamePlaceholder: "Full Name",
                    nameRequired: "Name is required",
                    phoneNumber: "Phone Number",
                    phonePlaceholder: "81234567890",
                    phoneRequired: "Phone number is required",
                    fullAddress: "Full Address",
                    addressPlaceholder: "Full address (street, city, province)",
                    addressRequired: "Address is required",
                    locationCoordinates: "Location Coordinates (Optional)",
                    locationPlaceholder: "Location coordinates will be filled automatically",
                    detectLocation: "üìç Detect Location Automatically",
                    viewMap: "üó∫Ô∏è View on Google Maps",
                    paymentMethod: "Payment Method",
                    selectPayment: "Select Payment Method",
                    waIndonesia: "WA Indonesia (85163682122)",
                    waArab: "WA Arab (1014006053)",
                    paymentRequired: "Select payment method",
                    recommendedProducts: "Recommended Products",
                    home: "Home",
                    search: "Search",
                    cartShort: "Cart",
                    payment: "Payment",
                    backToHome: "üîô Back to Home",
                    books: "Books",
                    weight: "Weight",
                    coverType: "Cover Type",
                    paperType: "Paper Type",
                    volumes: "Volumes",
                    textColor: "Text Color",
                    printCount: "Print Edition",
                    editor: "Editor",
                    isbn: "ISBN",
                    dimensions: "Dimensions",
                    language: "Language",
                    translator: "Translator",
                    reviewer: "Reviewer",
                    orderItems: "Order Items",
                    noItems: "No items. Please add items first."
                },
                ar: {
                    searchPlaceholder: "ÿßÿ®ÿ≠ÿ´ ÿπŸÜ ÿπŸÜŸàÿßŸÜ ÿßŸÑŸÉÿ™ÿßÿ® ÿ£Ÿà ÿßŸÑŸÖÿ§ŸÑŸÅ...",
                    publishers: "ÿßŸÑŸÜÿßÿ¥ÿ±ŸàŸÜ",
                    exploreCategories: "ÿßÿ≥ÿ™ŸÉÿ¥ŸÅ ÿßŸÑŸÅÿ¶ÿßÿ™",
                    newCollection: "ŸÖÿ¨ŸÖŸàÿπÿ© ÿßŸÑŸÉÿ™ÿ® ÿßŸÑÿ¨ÿØŸäÿØÿ©",
                    clearFilter: "ŸÖÿ≥ÿ≠ ÿßŸÑŸÅŸÑÿ™ÿ±",
                    noBooksFound: "ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ŸÉÿ™ÿ®.",
                    copyright: "ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÇ ŸÖÿ≠ŸÅŸàÿ∏ÿ©",
                    by: "ÿ®Ÿàÿßÿ≥ÿ∑ÿ©",
                    publisher: "ÿßŸÑŸÜÿßÿ¥ÿ±",
                    year: "ÿ≥ŸÜÿ© ÿßŸÑŸÜÿ¥ÿ±",
                    pages: "ÿßŸÑÿµŸÅÿ≠ÿßÿ™",
                    buyNow: "ÿßÿ¥ÿ™ÿ±Ÿä",
                    addToCart: "ÿßŸÑÿ≥ŸÑÿ©",
                    noDescription: "ŸÑÿß ŸäŸàÿ¨ÿØ ŸàÿµŸÅ ŸÖÿ™ÿßÿ≠.",
                    cart: "ÿ≥ŸÑÿ© ÿßŸÑÿ™ÿ≥ŸàŸÇ",
                    checkout: "ÿßŸÑÿØŸÅÿπ",
                    total: "ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä",
                    remove: "ÿ•ÿ≤ÿßŸÑÿ©",
                    orderForm: "ŸÜŸÖŸàÿ∞ÿ¨ ÿßŸÑÿ∑ŸÑÿ®",
                    orderNow: "ÿßÿ∑ŸÑÿ® ÿßŸÑÿ¢ŸÜ",
                    fullName: "ÿßŸÑÿßÿ≥ŸÖ ÿßŸÑŸÉÿßŸÖŸÑ",
                    fullNamePlaceholder: "ÿßŸÑÿßÿ≥ŸÖ ÿßŸÑŸÉÿßŸÖŸÑ",
                    nameRequired: "ÿßŸÑÿßÿ≥ŸÖ ŸÖÿ∑ŸÑŸàÿ®",
                    phoneNumber: "ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ",
                    phonePlaceholder: "81234567890",
                    phoneRequired: "ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ ŸÖÿ∑ŸÑŸàÿ®",
                    fullAddress: "ÿßŸÑÿπŸÜŸàÿßŸÜ ÿßŸÑŸÉÿßŸÖŸÑ",
                    addressPlaceholder: "ÿßŸÑÿπŸÜŸàÿßŸÜ ÿßŸÑŸÉÿßŸÖŸÑ (ÿßŸÑÿ¥ÿßÿ±ÿπÿå ÿßŸÑŸÖÿØŸäŸÜÿ©ÿå ÿßŸÑŸÖŸÇÿßÿ∑ÿπÿ©)",
                    addressRequired: "ÿßŸÑÿπŸÜŸàÿßŸÜ ŸÖÿ∑ŸÑŸàÿ®",
                    locationCoordinates: "ÿ•ÿ≠ÿØÿßÿ´Ÿäÿßÿ™ ÿßŸÑŸÖŸàŸÇÿπ (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)",
                    locationPlaceholder: "ÿ≥Ÿäÿ™ŸÖ ŸÖŸÑÿ° ÿ•ÿ≠ÿØÿßÿ´Ÿäÿßÿ™ ÿßŸÑŸÖŸàŸÇÿπ ÿ™ŸÑŸÇÿßÿ¶ŸäŸãÿß",
                    detectLocation: "üìç ÿßŸÑŸÉÿ¥ŸÅ ÿπŸÜ ÿßŸÑŸÖŸàŸÇÿπ ÿ™ŸÑŸÇÿßÿ¶ŸäŸãÿß",
                    viewMap: "üó∫Ô∏è ÿπÿ±ÿ∂ ÿπŸÑŸâ ÿÆÿ±ÿßÿ¶ÿ∑ ÿ¨Ÿàÿ¨ŸÑ",
                    paymentMethod: "ÿ∑ÿ±ŸäŸÇÿ© ÿßŸÑÿØŸÅÿπ",
                    selectPayment: "ÿßÿÆÿ™ÿ± ÿ∑ÿ±ŸäŸÇÿ© ÿßŸÑÿØŸÅÿπ",
                    waIndonesia: "WA ÿ•ŸÜÿØŸàŸÜŸäÿ≥Ÿäÿß (85163682122)",
                    waArab: "WA ÿπÿ±ÿ®Ÿä (1014006053)",
                    paymentRequired: "ÿßÿÆÿ™ÿ± ÿ∑ÿ±ŸäŸÇÿ© ÿßŸÑÿØŸÅÿπ",
                    recommendedProducts: "ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ÿßŸÑŸÖŸàÿµŸâ ÿ®Ÿáÿß",
                    home: "ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©",
                    search: "ÿ®ÿ≠ÿ´",
                    cartShort: "ÿßŸÑÿ≥ŸÑÿ©",
                    payment: "ÿßŸÑÿØŸÅÿπ",
                    backToHome: "üîô ÿßŸÑÿπŸàÿØÿ© ÿ•ŸÑŸâ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©",
                    books: "ŸÉÿ™ÿ®",
                    weight: "ÿßŸÑŸàÿ≤ŸÜ",
                    coverType: "ŸÜŸàÿπ ÿßŸÑÿ∫ŸÑÿßŸÅ",
                    paperType: "ŸÜŸàÿπ ÿßŸÑŸàÿ±ŸÇ",
                    volumes: "ÿπÿØÿØ ÿßŸÑŸÖÿ¨ŸÑÿØÿßÿ™",
                    textColor: "ŸÑŸàŸÜ ÿßŸÑŸÜÿµ",
                    printCount: "ÿßŸÑÿ∑ÿ®ÿπÿ©",
                    editor: "ÿßŸÑŸÖÿ≠ÿ±ÿ±",
                    isbn: "ISBN",
                    dimensions: "ÿßŸÑÿ£ÿ®ÿπÿßÿØ",
                    language: "ÿßŸÑŸÑÿ∫ÿ©",
                    translator: "ÿßŸÑŸÖÿ™ÿ±ÿ¨ŸÖ",
                    reviewer: "ÿßŸÑŸÖÿ±ÿßÿ¨ÿπ",
                    orderItems: "ÿπŸÜÿßÿµÿ± ÿßŸÑÿ∑ŸÑÿ®",
                    noItems: "ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿπŸÜÿßÿµÿ±. Ÿäÿ±ÿ¨Ÿâ ÿ•ÿ∂ÿßŸÅÿ© ÿπŸÜÿßÿµÿ± ÿ£ŸàŸÑÿßŸã."
                    addedToCart: "ÿ™ŸÖÿ™ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÉÿ™ÿßÿ® ÿ•ŸÑŸâ ÿßŸÑÿ≥ŸÑÿ©!",
                }
            };

            function updateLanguage() {
                const lang = currentLanguage;
                const t = translations[lang];
                
                document.querySelectorAll('[data-i18n]').forEach(element => {
                    const key = element.getAttribute('data-i18n');
                    if (t[key]) {
                        element.textContent = t[key];
                    }
                });
                
                document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
                    const key = element.getAttribute('data-i18n-placeholder');
                    if (t[key]) {
                        element.placeholder = t[key];
                    }
                });
                
                document.querySelectorAll('[data-i18n-prefix]').forEach(element => {
                    const prefixKey = element.getAttribute('data-i18n-prefix');
                    const originalText = element.textContent.trim().replace(t[prefixKey] + ' ', '');
                    if (t[prefixKey]) {
                        element.textContent = t[prefixKey] + ' ' + originalText;
                    }
                });
                
                // Update placeholders and labels
                document.getElementById('searchInput').placeholder = t.searchPlaceholder;
                document.getElementById('floatingSearchInput').placeholder = t.searchPlaceholder;
                
                if (document.getElementById('productDetailPage').style.display !== 'none') {
                    renderProductDetail(currentBook);
                }
                
                if (document.getElementById('orderPage').style.display !== 'none') {
                    renderOrderItems();
                }
                
                if (document.getElementById('cartModal').classList.contains('active')) {
                    renderCart();
                }

                // Update select options
                const paymentSelect = document.getElementById('paymentMethod');
                if (paymentSelect) {
                    paymentSelect.options[0].textContent = t.selectPayment;
                    paymentSelect.options[1].textContent = t.waIndonesia;
                    paymentSelect.options[2].textContent = t.waArab;
                }

                // Update bottom navbar
                document.getElementById('bottomHome').querySelector('span').textContent = t.home;
                document.getElementById('bottomSearch').querySelector('span').textContent = t.search;
                document.getElementById('bottomCart').querySelector('span').textContent = t.cartShort;
                document.getElementById('bottomPayment').querySelector('span').textContent = t.payment;
            }

            // ==================== FUNGSI VALIDASI FORM ====================
            function validateForm() {
                let isValid = true;
                
                // Reset error messages
                document.querySelectorAll('.error-message').forEach(error => {
                    error.style.display = 'none';
                });
                
                // Validate name
                const nameInput = document.getElementById('nameInput');
                if (!nameInput.value.trim()) {
                    document.getElementById('nameError').style.display = 'block';
                    isValid = false;
                }
                
                // Validate phone
                const phoneInput = document.getElementById('phoneInput');
                if (!phoneInput.value.trim()) {
                    document.getElementById('phoneError').style.display = 'block';
                    isValid = false;
                }
                
                // Validate address
                const addressInput = document.getElementById('addressInput');
                if (!addressInput.value.trim()) {
                    document.getElementById('addressError').style.display = 'block';
                    isValid = false;
                }
                
                // Validate payment method
                const paymentMethod = document.getElementById('paymentMethod');
                if (!paymentMethod.value) {
                    document.getElementById('paymentError').style.display = 'block';
                    isValid = false;
                }
                
                return isValid;
            }

            // ==================== FUNGSI DETEKSI LOKASI ====================
            function detectLocation() {
                if (navigator.geolocation) {
                    document.getElementById('detectLocationBtn').textContent = translations[currentLanguage].detectLocation.replace('üìç ', '') + '...';
                    document.getElementById('detectLocationBtn').disabled = true;
                    
                    navigator.geolocation.getCurrentPosition(
                        async (position) => {
                            const lat = position.coords.latitude;
                            const long = position.coords.longitude;
                            detectedLocation = { lat, long };
                            
                            // Update location input
                            document.getElementById('locationInput').value = `Lat: ${lat.toFixed(6)}, Long: ${long.toFixed(6)}`;
                            
                            // Show view map button
                            const viewMapBtn = document.getElementById('viewMapBtn');
                            viewMapBtn.style.display = 'block';
                            viewMapBtn.textContent = translations[currentLanguage].viewMap;
                            viewMapBtn.onclick = () => {
                                window.open(`https://www.google.com/maps?q=${lat},${long}`, '_blank');
                            };
                            
                            // Try to get address from coordinates
                            try {
                                const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${long}`);
                                const data = await response.json();
                                
                                if (data && data.display_name) {
                                    const addressInput = document.getElementById('addressInput');
                                    if (!addressInput.value.trim()) {
                                        addressInput.value = data.display_name;
                                    }
                                }
                            } catch (error) {
                                console.log('Tidak bisa mendapatkan alamat dari koordinat');
                            }
                            
                            document.getElementById('detectLocationBtn').textContent = translations[currentLanguage].detectLocation;
                            document.getElementById('detectLocationBtn').disabled = false;
                        },
                        (error) => {
                            alert(translations[currentLanguage].locationError || 'Gagal mendeteksi lokasi: ' + error.message);
                            document.getElementById('detectLocationBtn').textContent = translations[currentLanguage].detectLocation;
                            document.getElementById('detectLocationBtn').disabled = false;
                        },
                        {
                            enableHighAccuracy: true,
                            timeout: 10000,
                            maximumAge: 60000
                        }
                    );
                } else {
                    alert(translations[currentLanguage].geolocationNotSupported || 'Geolocation tidak didukung oleh browser ini.');
                }
            }

            // ==================== FUNGSI FETCH DATA ====================
            async function fetchCurrency() {
                const { data, error } = await supabase.from('site_settings').select('usd_rate, egp_rate').single();
                if (!error && data) {
                    currencySettings = { usd_rate: data.usd_rate, egp_rate: data.egp_rate };
                }
            }
            
            async function fetchBanners() {
                const { data, error } = await supabase.from('banners').select('*').order('display_order', { ascending: true });
                if (!error && data) {
                    renderBanners(data);
                } else {
                    document.getElementById('bannerSlider').innerHTML = `<p>${translations[currentLanguage].noBanners || 'Gagal memuat banner.'}</p>`;
                }
            }
            
            async function fetchCategories() {
                const { data, error } = await supabase.from('categories').select('*');
                if (!error && data) {
                    categories = data;
                    for (let cat of categories) {
                        const { count } = await supabase.from('books').select('id', { count: 'exact' }).eq('category_id', cat.id);
                        cat.bookCount = count || 0;
                    }
                    renderCategories(categories);
                } else {
                    document.getElementById('categoryGrid').innerHTML = `<p>${translations[currentLanguage].noCategories || 'Gagal memuat kategori.'}</p>`;
                }
            }

            async function fetchPublishers() {
                const { data, error } = await supabase.from('publishers').select('*, discount');
                if (!error && data) {
                    publishers = data;
                    for (let pub of publishers) {
                        const { count } = await supabase.from('books').select('id', { count: 'exact' }).eq('publisher_id', pub.id);
                        pub.bookCount = count || 0;
                    }
                    renderPublishers(publishers);
                    startPublisherSlider();
                } else {
                    document.getElementById('publisherTrack').innerHTML = `<p>${translations[currentLanguage].noPublishers || 'Gagal memuat penerbit.'}</p>`;
                }
            }

            async function fetchBooks() {
                const { data, error } = await supabase.from('books').select('*, publishers(name, discount)');
                if (!error && data) {
                    allBooks = data;
                    checkUrlParams();
                } else {
                    document.getElementById('productGrid').innerHTML = `<p>${translations[currentLanguage].noBooksFound}</p>`;
                }
            }
            
            // ==================== FUNGSI RENDER TAMPILAN ====================
            function renderBanners(banners) {
                const slider = document.getElementById('bannerSlider');
                if (!banners || banners.length === 0) {
                    slider.innerHTML = `<p>${translations[currentLanguage].noBanners || 'Tidak ada banner tersedia.'}</p>`;
                    return;
                }
                
                slider.innerHTML = banners.map((banner, index) => `
                    <div class="banner-slide ${index === 0 ? 'active' : ''}">
                        <img src="${banner.image_url}" alt="${banner.title}">
                    </div>
                `).join('');
                
                setInterval(() => {
                    const slides = document.querySelectorAll('.banner-slide');
                    slides[currentBannerIndex].classList.remove('active');
                    currentBannerIndex = (currentBannerIndex + 1) % slides.length;
                    slides[currentBannerIndex].classList.add('active');
                }, 5000);
            }
            
            function renderCategories(cats) {
                const grid = document.getElementById('categoryGrid');
                if (!cats || cats.length === 0) {
                    grid.innerHTML = `<p>${translations[currentLanguage].noCategories || 'Tidak ada kategori tersedia.'}</p>`;
                    return;
                }
                grid.innerHTML = cats.map(cat => `
                    <div class="category-card" data-category-id="${cat.id}" style="border-top: 5px solid ${cat.color};">
                        <div class="category-card-icon" style="background-color: ${cat.color};">
                            <img src="${cat.image_url || 'https://via.placeholder.com/40'}" alt="${cat.name_id}">
                        </div>
                        <h3>${cat.name_id}</h3>
                        <p class="category-book-count">(${cat.bookCount} ${translations[currentLanguage].books})</p>
                    </div>
                `).join('');

                document.querySelectorAll('.category-card').forEach(card => {
                    card.addEventListener('click', () => {
                        const catId = card.dataset.categoryId;
                        navigateToCategory(catId);
                    });
                });
            }

            function renderPublishers(pubs) {
                const track = document.getElementById('publisherTrack');
                if (!pubs || pubs.length === 0) {
                    track.innerHTML = `<p>${translations[currentLanguage].noPublishers || 'Tidak ada penerbit tersedia.'}</p>`;
                    return;
                }
                track.innerHTML = pubs.map(pub => `
                    <div class="publisher-slide">
                        <div class="publisher-card" data-publisher-id="${pub.id}">
                            <div class="publisher-card-icon">
                                <img src="${pub.logo_url || 'https://via.placeholder.com/80'}" alt="${pub.name}">
                            </div>
                            <h3>${pub.name}</h3>
                            <p class="publisher-book-count">(${pub.bookCount} ${translations[currentLanguage].books})</p>
                            ${pub.discount ? `<div class="discount-pin">${pub.discount}</div>` : ''}
                        </div>
                    </div>
                `).join('');

                document.querySelectorAll('.publisher-card').forEach(card => {
                    card.addEventListener('click', () => {
                        const pubId = card.dataset.publisherId;
                        navigateToPublisher(pubId);
                    });
                });
            }

            function startPublisherSlider() {
                if (publisherInterval) {
                    clearInterval(publisherInterval);
                }
                
                const track = document.getElementById('publisherTrack');
                const slides = document.querySelectorAll('.publisher-slide');
                const totalSlides = slides.length;
                
                currentPublisherIndex = 0;
                updatePublisherSlider();
                
                publisherInterval = setInterval(() => {
                    currentPublisherIndex = (currentPublisherIndex + 1) % totalSlides;
                    updatePublisherSlider();
                }, 3000);
            }
            
            function updatePublisherSlider() {
                const track = document.getElementById('publisherTrack');
                const slides = document.querySelectorAll('.publisher-slide');
                const slideWidth = slides[0]?.offsetWidth || 0;
                track.style.transform = `translateX(-${currentPublisherIndex * slideWidth}px)`;
            }

            function checkUrlParams() {
                const urlParams = new URLSearchParams(window.location.search);
                const categoryId = urlParams.get('category');
                const publisherId = urlParams.get('publisher');
                const productId = urlParams.get('product');
                const isOrder = urlParams.get('order');
                const singleBookId = urlParams.get('single');
                
                if (productId) {
                    const book = allBooks.find(b => b.id == productId);
                    if (book) {
                        currentBook = book;
                        showProductDetail(book);
                        return;
                    }
                }
                
                if (isOrder === 'true') {
                    if (singleBookId) {
                        const singleBook = allBooks.find(b => b.id == singleBookId);
                        if (singleBook) {
                            orderItems = [{ ...singleBook, quantity: 1 }];
                            currentBook = singleBook;
                        }
                    } else if (orderItems.length === 0 && cart.length > 0) {
                        orderItems = [...cart.map(item => ({ ...item, quantity: item.quantity || 1 }))];
                        currentBook = null;
                    }
                    showOrderPage();
                    return;
                }
                
                if (categoryId) {
                    const category = categories.find(c => c.id == categoryId);
                    if (category) {
                        selectedCategory = categoryId;
                        updateBreadcrumb('category', category.name_id);
                        updateFilterInfo('category', category.name_id, `${translations[currentLanguage].showingBooksFromCategory || 'Menampilkan buku dari kategori'} ${category.name_id}`);
                    }
                } else if (publisherId) {
                    const publisher = publishers.find(p => p.id == publisherId);
                    if (publisher) {
                        selectedPublisher = publisherId;
                        updateBreadcrumb('publisher', publisher.name);
                        updateFilterInfo('publisher', publisher.name, `${translations[currentLanguage].showingBooksFromPublisher || 'Menampilkan buku dari penerbit'} ${publisher.name}`);
                    }
                }
                
                currentPage = 1;
                filterAndRenderBooks();
            }

            function filterAndRenderBooks(searchTerm = '') {
                let filteredBooks = allBooks.filter(book => 
                    (book.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    book.author.toLowerCase().includes(searchTerm.toLowerCase())) &&
                    (!selectedCategory || book.category_id == selectedCategory) &&
                    (!selectedPublisher || book.publisher_id == selectedPublisher)
                );

                const totalPages = Math.ceil(filteredBooks.length / booksPerPage);
                const paginatedBooks = filteredBooks.slice((currentPage - 1) * booksPerPage, currentPage * booksPerPage);

                renderBooks(paginatedBooks);
                renderPagination(totalPages);
            }

            function renderBooks(books) {
                const grid = document.getElementById('productGrid');
                const t = translations[currentLanguage];
                
                if (!books || books.length === 0) {
                    grid.innerHTML = `<p style="grid-column: 1/-1; text-align: center;">${t.noBooksFound}</p>`;
                    return;
                }
                grid.innerHTML = books.map(book => {
                    const publisher = publishers.find(p => p.id === book.publisher_id);
                    const publisherDiscount = publisher ? publisher.discount : '';
                    const basePrice = book.base_price;
                    const originalPrice = book.original_price || basePrice;
                    const finalPrice = calculateDiscountedPrice(basePrice, book.discount, publisherDiscount);
                    const discountPercent = parseFloat((book.discount || publisherDiscount || '0%').replace('%', '')) || 0;

                    return `
                        <div class="product-card" data-book-id="${book.id}">
                            <div class="product-image">
                                <img src="${book.cover_image_url || 'https://via.placeholder.com/300x400.png?text=No+Image'}" alt="${book.title}">
                            </div>
                            <div class="product-info">
                                <h3 class="product-title">${book.title}</h3>
                                <p class="product-author">${t.by} ${book.author}</p>
                                <p class="product-publisher">${t.publisher}: ${publisher ? publisher.name : 'N/A'}</p>
                                <p class="product-year">${t.year}: ${book.year || 'N/A'}</p>
                                <p class="product-pages">${t.pages}: ${book.pages || 'N/A'}</p>
                                <div class="product-pricing">
                                    <span class="final-price">${formatPrice(finalPrice, currentCurrency)}</span>
                                    ${discountPercent > 0 || originalPrice > basePrice ? `<span class="original-price">${formatPrice(originalPrice, currentCurrency)}</span>` : ''}
                                    ${discountPercent > 0 ? `<span class="discount-badge">-${discountPercent}%</span>` : ''}
                                </div>
                                <div class="product-actions">
                                    <a href="#" class="btn-add-to-cart-card" data-book-id="${book.id}">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M2 2H3.74001C4.82001 2 5.67 2.93 5.58 4L4.75 13.96C4.61 15.59 5.89 16.99 7.53 17H18.08C19.72 17 21 15.6 20.86 13.97L21.24 9.01001C21.36 7.41001 20.08 6.01001 18.44 6.01001H5.82M16.25 22C16.9404 22 17.5 21.4404 17.5 20.75C17.5 20.0596 16.9404 19.5 16.25 19.5C15.5596 19.5 15 20.0596 15 20.75C15 21.4404 15.5596 22 16.25 22ZM7.25 22C7.94036 22 8.5 21.4404 8.5 20.75C8.5 20.0596 7.94036 19.5 7.25 19.5C6.55964 19.5 6 20.0596 6 20.75C6 21.4404 6.55964 22 7.25 22Z" stroke="currentColor" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                    </a>
                                    <a href="#" class="btn-buy-card" data-book-id="${book.id}">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M12 4V20M4 12H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                    </a>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');

                document.querySelectorAll('.product-card').forEach(card => {
                    card.addEventListener('click', (e) => {
                        if (!e.target.closest('.btn-add-to-cart-card') && !e.target.closest('.btn-buy-card')) {
                            const bookId = card.dataset.bookId;
                            navigateToProductDetail(bookId);
                        }
                    });
                });

                document.querySelectorAll('.btn-add-to-cart-card').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        const bookId = btn.dataset.bookId;
                        const book = allBooks.find(b => b.id == bookId);
                        addToCart(book);
                    });
                });

                document.querySelectorAll('.btn-buy-card').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        const bookId = btn.dataset.bookId;
                        const book = allBooks.find(b => b.id == bookId);
                        startOrder([book]);
                    });
                });
            }

            function renderPagination(totalPages) {
                const pagination = document.getElementById('pagination');
                pagination.innerHTML = '';

                // PERBAIKAN: Tambah tombol prev
                const prevBtn = document.createElement('button');
                prevBtn.textContent = '<';
                prevBtn.disabled = currentPage === 1;
                prevBtn.addEventListener('click', () => {
                    if (currentPage > 1) {
                        currentPage--;
                        filterAndRenderBooks(document.getElementById('searchInput').value);
                    }
                });
                pagination.appendChild(prevBtn);

                // Tampilkan maksimal 5 halaman dengan ellipsis
                const maxVisible = 4;
                let startPage = Math.max(1, currentPage - Math.floor(maxVisible / 2));
                let endPage = Math.min(totalPages, startPage + maxVisible - 1);

                if (endPage - startPage < maxVisible - 1) {
                    startPage = Math.max(1, endPage - maxVisible + 1);
                }

                // Tambah ellipsis awal jika diperlukan
                if (startPage > 1) {
                    const ellipsis = document.createElement('button');
                    ellipsis.textContent = '...';
                    ellipsis.disabled = true;
                    pagination.appendChild(ellipsis);
                }

                // Tambah tombol halaman
                for (let i = startPage; i <= endPage; i++) {
                    const btn = document.createElement('button');
                    btn.textContent = i;
                    if (i === currentPage) btn.classList.add('active');
                    btn.addEventListener('click', () => {
                        currentPage = i;
                        filterAndRenderBooks(document.getElementById('searchInput').value);
                    });
                    pagination.appendChild(btn);
                }

                // Tambah ellipsis akhir jika diperlukan
                if (endPage < totalPages) {
                    const ellipsis = document.createElement('button');
                    ellipsis.textContent = '...';
                    ellipsis.disabled = true;
                    pagination.appendChild(ellipsis);
                }

                // PERBAIKAN: Tambah tombol next
                const nextBtn = document.createElement('button');
                nextBtn.textContent = '>';
                nextBtn.disabled = currentPage === totalPages;
                nextBtn.addEventListener('click', () => {
                    if (currentPage < totalPages) {
                        currentPage++;
                        filterAndRenderBooks(document.getElementById('searchInput').value);
                    }
                });
                pagination.appendChild(nextBtn);
            }

            function renderSearchDropdown(books, dropdownId) {
                const dropdown = document.getElementById(dropdownId);
                const t = translations[currentLanguage];
                if (books.length === 0) {
                    dropdown.innerHTML = '<p style="padding: 1rem; text-align: center;">' + t.noBooksFound + '</p>';
                    return;
                }
                dropdown.innerHTML = books.map(book => {
                    const publisher = publishers.find(p => p.id === book.publisher_id);
                    const publisherDiscount = publisher ? publisher.discount : '';
                    const basePrice = book.base_price;
                    const finalPrice = calculateDiscountedPrice(basePrice, book.discount, publisherDiscount);
                    const discountPercent = parseFloat((book.discount || publisherDiscount || '0%').replace('%', '')) || 0;

                    return `
                        <div class="search-result-item" data-book-id="${book.id}">
                            <img src="${book.cover_image_url || 'https://via.placeholder.com/50x75'}" alt="${book.title}" class="search-result-image">
                            <div class="search-result-info">
                                <h4 class="search-result-title">${book.title}</h4>
                                <p class="search-result-price">${formatPrice(finalPrice, currentCurrency)}
                                    ${discountPercent > 0 ? `<span class="search-result-discount">-${discountPercent}%</span>` : ''}
                                </p>
                            </div>
                            <div class="search-result-actions">
                                <a href="#" class="mini-btn mini-buy" data-book-id="${book.id}">üõí</a>
                                <a href="#" class="mini-btn mini-cart" data-book-id="${book.id}">‚ûï</a>
                            </div>
                        </div>
                    `;
                }).join('');

                dropdown.querySelectorAll('.search-result-item').forEach(item => {
                    item.addEventListener('click', (e) => {
                        if (!e.target.closest('.mini-btn')) {
                            const bookId = item.dataset.bookId;
                            navigateToProductDetail(bookId);
                        }
                    });
                });

                dropdown.querySelectorAll('.mini-cart').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        const bookId = btn.dataset.bookId;
                        const book = allBooks.find(b => b.id == bookId);
                        addToCart(book);
                    });
                });

                dropdown.querySelectorAll('.mini-buy').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        const bookId = btn.dataset.bookId;
                        const book = allBooks.find(b => b.id == bookId);
                        startOrder([book]);
                    });
                });
            }

            // ==================== FUNGSI HALAMAN DETAIL PRODUK ====================
            function showProductDetail(book) {
                currentBook = book;
                renderProductDetail(book);
                
                document.getElementById('homePage').style.display = 'none';
                document.getElementById('productDetailPage').style.display = 'block';
                document.getElementById('orderPage').style.display = 'none';
                
                updateBreadcrumb('product', book.title);
                
                window.scrollTo(0, 0);
            }

            function renderProductDetail(book) {
                currentBook = book;
                const publisher = publishers.find(p => p.id === book.publisher_id);
                const publisherDiscount = publisher ? publisher.discount : '';
                const basePrice = book.base_price;
                const originalPrice = book.original_price || basePrice;
                const finalPrice = calculateDiscountedPrice(basePrice, book.discount, publisherDiscount);
                const discountPercent = parseFloat((book.discount || publisherDiscount || '0%').replace('%', '')) || 0;
                const t = translations[currentLanguage];

                document.getElementById('detailImage').src = book.cover_image_url || 'https://via.placeholder.com/300x400.png?text=No+Image';
                document.getElementById('detailTitle').textContent = book.title;
                document.getElementById('detailAuthor').textContent = `${t.by} ${book.author}`;
                document.getElementById('detailPublisher').textContent = `${t.publisher}: ${publisher ? publisher.name : 'N/A'}`;
                document.getElementById('detailYear').textContent = `${t.year}: ${book.year || 'N/A'}`;
                document.getElementById('detailPages').textContent = `${t.pages}: ${book.pages || 'N/A'}`;
                
                document.getElementById('detailPricing').innerHTML = `
                    <span class="final-price">${formatPrice(finalPrice, currentCurrency)}</span>
                    ${discountPercent > 0 || originalPrice > basePrice ? `<span class="original-price">${formatPrice(originalPrice, currentCurrency)}</span>` : ''}
                    ${discountPercent > 0 ? `<span class="discount-badge">-${discountPercent}%</span>` : ''}
                `;
                
                document.getElementById('detailDescription').textContent = book.description || t.noDescription;
                
                const detailsGrid = document.getElementById('detailGrid');
                detailsGrid.innerHTML = `
                    ${book.weight_value ? `<div class="detail-item"><strong>${t.weight}:</strong> ${book.weight_value} ${book.weight_unit}</div>` : ''}
                    ${book.cover_type ? `<div class="detail-item"><strong>${t.coverType}:</strong> ${book.cover_type}</div>` : ''}
                    ${book.paper_type ? `<div class="detail-item"><strong>${t.paperType}:</strong> ${book.paper_type}</div>` : ''}
                    ${book.volumes ? `<div class="detail-item"><strong>${t.volumes}:</strong> ${book.volumes}</div>` : ''}
                    ${book.text_color ? `<div class="detail-item"><strong>${t.textColor}:</strong> ${book.text_color}</div>` : ''}
                    ${book.print_count ? `<div class="detail-item"><strong>${t.printCount}:</strong> ${book.print_count}</div>` : ''}
                    ${book.editor ? `<div class="detail-item"><strong>${t.editor}:</strong> ${book.editor}</div>` : ''}
                    ${book.isbn ? `<div class="detail-item"><strong>${t.isbn}:</strong> ${book.isbn}</div>` : ''}
                    ${book.dimensions ? `<div class="detail-item"><strong>${t.dimensions}:</strong> ${book.dimensions}</div>` : ''}
                    ${book.language ? `<div class="detail-item"><strong>${t.language}:</strong> ${book.language}</div>` : ''}
                    ${book.translator ? `<div class="detail-item"><strong>${t.translator}:</strong> ${book.translator}</div>` : ''}
                    ${book.reviewer ? `<div class="detail-item"><strong>${t.reviewer}:</strong> ${book.reviewer}</div>` : ''}
                `;

                // Update buttons
                document.getElementById('detailBackBtn').textContent = t.backToHome;
                document.getElementById('detailAddToCartBtn').textContent = t.addToCart;

                // PERBAIKAN: Event listener untuk tombol di halaman detail
                const detailBackBtn = document.getElementById('detailBackBtn');
                const detailAddToCartBtn = document.getElementById('detailAddToCartBtn');

                // Hapus event listener lama jika ada
                detailBackBtn.replaceWith(detailBackBtn.cloneNode(true));
                detailAddToCartBtn.replaceWith(detailAddToCartBtn.cloneNode(true));

                // Tambah event listener baru
                document.getElementById('detailBackBtn').addEventListener('click', (e) => {
                    e.preventDefault();
                    navigateToHome();
                });

                document.getElementById('detailAddToCartBtn').addEventListener('click', (e) => {
                    e.preventDefault();
                    addToCart(book);
                });
            }

            // ==================== FUNGSI HALAMAN ORDER ====================
            function showOrderPage() {
                renderOrderItems();
                loadRecommendedProducts();
                
                document.getElementById('homePage').style.display = 'none';
                document.getElementById('productDetailPage').style.display = 'none';
                document.getElementById('orderPage').style.display = 'block';
                
                updateBreadcrumb('order', 'Form Pemesanan');
                
                window.scrollTo(0, 0);
            }

            function renderOrderItems() {
                const orderItemsDiv = document.getElementById('orderItems');
                const t = translations[currentLanguage];
                let totalPrice = 0;

                if (orderItems.length === 0) {
                    orderItemsDiv.innerHTML = '<p>' + (t.noItems || 'Tidak ada item. Silakan tambah item terlebih dahulu.') + '</p>';
                    return;
                }

                orderItemsDiv.innerHTML = '<h3>' + (t.orderItems || 'Item Pemesanan:') + '</h3>' + orderItems.map(item => {
                    const publisher = publishers.find(p => p.id === item.publisher_id);
                    const publisherDiscount = publisher ? publisher.discount : '';
                    const finalPrice = calculateDiscountedPrice(item.base_price, item.discount, publisherDiscount);
                    const itemTotal = finalPrice * (item.quantity || 1);
                    totalPrice += itemTotal;

                    return `
                        <div class="cart-item">
                            <img src="${item.cover_image_url || 'https://via.placeholder.com/80x120.png?text=No+Image'}" alt="${item.title}">
                            <div class="cart-item-info">
                                <h3 class="cart-item-title">${item.title}</h3>
                                <p>${item.quantity || 1} x ${formatPrice(finalPrice, currentCurrency)}</p>
                                <p class="cart-item-price">${formatPrice(itemTotal, currentCurrency)}</p>
                            </div>
                        </div>
                    `;
                }).join('') + `<p><strong>${t.total}: ${formatPrice(totalPrice, currentCurrency)}</strong></p>`;
            }

            function loadRecommendedProducts() {
                const shuffled = [...allBooks].sort(() => 0.5 - Math.random());
                const recommended = shuffled.slice(0, 4);
                
                const recommendedGrid = document.getElementById('recommendedGrid');
                recommendedGrid.innerHTML = recommended.map(book => {
                    const publisher = publishers.find(p => p.id === book.publisher_id);
                    const publisherDiscount = publisher ? publisher.discount : '';
                    const finalPrice = calculateDiscountedPrice(book.base_price, book.discount, publisherDiscount);
                    
                    return `
                        <div class="recommended-card" data-book-id="${book.id}">
                            <img src="${book.cover_image_url || 'https://via.placeholder.com/80x120.png?text=No+Image'}" alt="${book.title}" class="recommended-image">
                            <div class="recommended-info">
                                <h4 class="recommended-title">${book.title}</h4>
                                <p class="recommended-price">${formatPrice(finalPrice, currentCurrency)}</p>
                            </div>
                        </div>
                    `;
                }).join('');
                
                document.querySelectorAll('.recommended-card').forEach(card => {
                    card.addEventListener('click', () => {
                        const bookId = card.dataset.bookId;
                        navigateToProductDetail(bookId);
                    });
                });
            }

         // ==================== FUNGSI KERANJANG ====================
function addToCart(book) {
    const existingItem = cart.find(item => item.id === book.id);
    if (existingItem) {
        existingItem.quantity += 1;
    } else {
        cart.push({ ...book, quantity: 1 });
    }
    localStorage.setItem('cart', JSON.stringify(cart));
    updateCartBadge();
    alert(translations[currentLanguage].addedToCart || 'Buku ditambahkan ke keranjang!');
}

function removeFromCart(bookId) {
    cart = cart.filter(item => item.id !== bookId);
    localStorage.setItem('cart', JSON.stringify(cart));
    updateCartBadge();
    renderCart(); // Memanggil renderCart untuk menggambar ulang
}

function updateCartBadge() {
    const badge = document.getElementById('cartBadge');
    const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
    if (totalItems > 0) {
        badge.textContent = totalItems;
        badge.classList.add('active');
    } else {
        badge.classList.remove('active');
    }
}

function renderCart() {
    const cartItems = document.getElementById('cartItems');
    const cartTotal = document.getElementById('cartTotal');
    const t = translations[currentLanguage];
    let totalPrice = 0;

    if (cart.length === 0) {
        cartItems.innerHTML = '<p>' + (t.emptyCart || 'Keranjang kosong.') + '</p>';
        cartTotal.innerHTML = '';
        return;
    }

    cartItems.innerHTML = cart.map(item => {
        const publisher = publishers.find(p => p.id === item.publisher_id);
        const publisherDiscount = publisher ? publisher.discount : '';
        const finalPrice = calculateDiscountedPrice(item.base_price, item.discount, publisherDiscount);
        const itemTotal = finalPrice * item.quantity;
        totalPrice += itemTotal;

        return `
            <div class="cart-item">
                <img src="${item.cover_image_url || 'https://via.placeholder.com/80x120.png?text=No+Image'}" alt="${item.title}">
                <div class="cart-item-info">
                    <h3 class="cart-item-title">${item.title}</h3>
                    <p>${item.quantity} x ${formatPrice(finalPrice, currentCurrency)}</p>
                    <p class="cart-item-price">${formatPrice(itemTotal, currentCurrency)}</p>
                </div>
                <button class="cart-item-remove" data-book-id="${item.id}">${t.remove}</button>
            </div>
        `;
    }).join('');

    cartTotal.innerHTML = `${t.total}: ${formatPrice(totalPrice, currentCurrency)}`;
    
    // TIDAK PERLU BLOK PERBAIKAN DI SINI LAGI
}

// ===========================================================
// PERBAIKAN: EVENT DELEGATION UNTUK TOMBOL HAPUS (DITARUH DI SINI)
// ===========================================================
document.getElementById('cartItems').addEventListener('click', function(event) {
    // Cek apakah elemen yang diklik memiliki class 'cart-item-remove'
    if (event.target.classList.contains('cart-item-remove')) {
        
        // Ambil ID buku dari atribut data-book-id
        const bookId = parseInt(event.target.getAttribute('data-book-id'));
        
        // Panggil fungsi hapus
        removeFromCart(bookId);
    }
});
            // ==================== FUNGSI ORDER ====================
            function startOrder(items) {
                if (!items || items.length === 0) {
                    if (cart.length > 0) {
                        items = [...cart];
                    } else {
                        alert(translations[currentLanguage].noItemsToOrder || 'Tidak ada item untuk dipesan.');
                        return;
                    }
                }
                
                orderItems = items.map(item => ({
                    ...item,
                    quantity: item.quantity || 1
                }));
                
                if (items.length === 1) {
                    currentBook = items[0];
                } else {
                    currentBook = null;
                }
                
                console.log('Order items:', orderItems);
                
                navigateToOrder(items.length === 1 ? items[0] : null);
            }

            async function submitOrder(e) {
                e.preventDefault();
                
                if (!validateForm()) {
                    alert(translations[currentLanguage].fillRequiredFields || 'Mohon lengkapi semua field yang wajib diisi!');
                    return;
                }

                const name = document.getElementById('nameInput').value;
                const phoneCountry = document.getElementById('phoneCountry').value;
                const phoneNumber = document.getElementById('phoneInput').value;
                const fullPhone = phoneCountry + phoneNumber.replace(/^0+/, '');
                const address = document.getElementById('addressInput').value;
                const location = document.getElementById('locationInput').value;
                const paymentMethod = document.getElementById('paymentMethod').value;

                if (orderItems.length === 0) {
                    alert(translations[currentLanguage].noItemsToOrder || 'Tidak ada item untuk dipesan.');
                    return;
                }

                const totalPrice = orderItems.reduce((sum, item) => {
                    const publisher = publishers.find(p => p.id === item.publisher_id);
                    const publisherDiscount = publisher ? publisher.discount : '';
                    const finalPrice = calculateDiscountedPrice(item.base_price, item.discount, publisherDiscount);
                    return sum + finalPrice * (item.quantity || 1);
                }, 0);

                const firstBook = orderItems[0];

                console.log('Data yang akan dikirim:', {
                    name, 
                    phone: fullPhone, 
                    address, 
                    location,
                    items: orderItems, 
                    total_price: totalPrice, 
                    currency: currentCurrency, 
                    language: paymentMethod,
                    book_title: firstBook.title,
                    book_author: firstBook.author,
                    cover_image_url: firstBook.cover_image_url,
                    quantity: orderItems.reduce((sum, item) => sum + (item.quantity || 1), 0),
                    payment_method: paymentMethod
                });

                try {
                    const { data, error } = await supabase.from('orders').insert({
                        name: name,
                        phone: fullPhone,
                        address: address,
                        items: orderItems,
                        total_price: totalPrice,
                        currency: currentCurrency.toLowerCase(),
                        language: paymentMethod,
                        book_title: firstBook.title,
                        book_author: firstBook.author,
                        cover_image_url: firstBook.cover_image_url,
                        quantity: orderItems.reduce((sum, item) => sum + (item.quantity || 1), 0),
                        payment_method: paymentMethod,
                        status: 'pending'
                    });

                    if (error) {
                        console.error('Error dari Supabase:', error);
                        alert(translations[currentLanguage].orderSaveFailed || 'Gagal menyimpan order: ' + error.message);
                        return;
                    }

                    console.log('Order berhasil disimpan:', data);

                    // Buat template WA berdasarkan pilihan user
                    const isArab = paymentMethod === 'ar';
                    const waNumber = isArab ? waArab : waIndonesia;
                    
                    let template = '';
                    
                    if (isArab) {
                        template = `ÿßŸÑÿ∑ŸÑÿ® ÿßŸÑÿ¨ÿØŸäÿØ üì¶\n\n`;
                        template += `ÿßŸÑÿßÿ≥ŸÖ: ${name}\n`;
                        template += `ÿßŸÑŸáÿßÿ™ŸÅ: ${fullPhone}\n`;
                        template += `ÿßŸÑÿπŸÜŸàÿßŸÜ: ${address}\n`;
                        template += `ÿ±ÿßÿ®ÿ∑ ÿßŸÑÿπŸÜŸàÿßŸÜ ÿπŸÑŸâ ÿ∫Ÿàÿ∫ŸÑ ŸÖÿßÿ®ÿ≥: https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(address)}\n`;
                        if (location) {
                            template += `ÿßŸÑŸÖŸàŸÇÿπ: https://www.google.com/maps?q=${encodeURIComponent(location)}\n`;
                        }
                        template += `\nÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™:\n`;
                        orderItems.forEach((item, index) => {
                            const publisher = publishers.find(p => p.id === item.publisher_id);
                            const publisherDiscount = publisher ? publisher.discount : '';
                            const finalPrice = calculateDiscountedPrice(item.base_price, item.discount, publisherDiscount);
                            template += `${index + 1}. üìñ ÿßŸÑÿπŸÜŸàÿßŸÜ: ${item.title}\n`;
                            template += `   ÿßŸÑŸÉÿßÿ™ÿ®: ${item.author}\n`;
                            template += `   ÿßŸÑŸÉŸÖŸäÿ©: ${item.quantity || 1}\n`;
                            template += `   ÿßŸÑÿ≥ÿπÿ± ŸÑŸÑŸàÿ≠ÿØÿ©: ${formatPrice(finalPrice, currentCurrency)}\n`;
                            template += `   ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä ŸÑŸÑÿπŸÜÿµÿ±: ${formatPrice(finalPrice * (item.quantity || 1), currentCurrency)}\n\n`;
                        });
                        template += `ÿßŸÑŸÖÿ¨ŸÖŸàÿπ ÿßŸÑŸÉŸÑŸä: ${formatPrice(totalPrice, currentCurrency)}\n`;
                        template += `ÿßŸÑÿπŸÖŸÑÿ©: ${currentCurrency}\n`;
                        template += `ÿßŸÑŸÑÿ∫ÿ©: ${currentLanguage.toUpperCase()}`;
                    } else {
                        template = `Pesanan Baru üì¶\n\n`;
                        template += `Nama: ${name}\n`;
                        template += `Telepon: ${fullPhone}\n`;
                        template += `Alamat: ${address}\n`;
                        template += `Link Alamat di Google Maps: https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(address)}\n`;
                        if (location) {
                            template += `Lokasi: https://www.google.com/maps?q=${encodeURIComponent(location)}\n`;
                        }
                        template += `\nProduk:\n`;
                        orderItems.forEach((item, index) => {
                            const publisher = publishers.find(p => p.id === item.publisher_id);
                            const publisherDiscount = publisher ? publisher.discount : '';
                            const finalPrice = calculateDiscountedPrice(item.base_price, item.discount, publisherDiscount);
                            template += `${index + 1}. üìñ Judul: ${item.title}\n`;
                            template += `   Penulis: ${item.author}\n`;
                            template += `   Kuantitas: ${item.quantity || 1}\n`;
                            template += `   Harga per Unit: ${formatPrice(finalPrice, currentCurrency)}\n`;
                            template += `   Total per Item: ${formatPrice(finalPrice * (item.quantity || 1), currentCurrency)}\n\n`;
                        });
                        template += `Total Keseluruhan: ${formatPrice(totalPrice, currentCurrency)}\n`;
                        template += `Mata Uang: ${currentCurrency}\n`;
                        template += `Bahasa: ${currentLanguage.toUpperCase()}`;
                    }

                    // Redirect ke WhatsApp
                    window.location.href = `https://wa.me/${waNumber}?text=${encodeURIComponent(template)}`;

                    // Clear cart jika dari cart (tapi tidak jika single order)
                    if (orderItems.length > 1 || JSON.stringify(orderItems) === JSON.stringify(cart)) {
                        cart = [];
                        localStorage.setItem('cart', JSON.stringify(cart));
                        updateCartBadge();
                    }

                } catch (err) {
                    console.error('Error:', err);
                    alert(translations[currentLanguage].errorOccurred || 'Terjadi kesalahan: ' + err.message);
                }
            }

            // ==================== SCROLL HANDLER ====================
            function handleScroll() {
                const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                const header = document.getElementById('header');
                const floatingSearch = document.getElementById('floatingSearch');
                
                if (scrollTop > lastScrollTop && scrollTop > 100) {
                    header.classList.add('hidden');
                    floatingSearch.classList.add('visible');
                } else {
                    header.classList.remove('hidden');
                    floatingSearch.classList.remove('visible');
                }
                
                lastScrollTop = scrollTop <= 0 ? 0 : scrollTop;
                ticking = false;
            }

            function requestTick() {
                if (!ticking) {
                    window.requestAnimationFrame(handleScroll);
                    ticking = true;
                }
            }

            // ==================== EVENT LISTENERS ====================
            const cartModal = document.getElementById('cartModal');
            const cartModalClose = document.getElementById('cartModalClose');
            const cartIcon = document.getElementById('cartIcon');
            const checkoutBtn = document.getElementById('checkoutBtn');
            const detectLocationBtn = document.getElementById('detectLocationBtn');
            const orderForm = document.getElementById('orderForm');
            const searchInput = document.getElementById('searchInput');
            const floatingSearchInput = document.getElementById('floatingSearchInput');
            const searchDropdown = document.getElementById('searchDropdown');
            const floatingSearchDropdown = document.getElementById('floatingSearchDropdown');

            window.addEventListener('scroll', requestTick);

            searchInput.addEventListener('input', (e) => {
                floatingSearchInput.value = e.target.value;
                handleSearchInput(e.target.value, 'searchDropdown');
            });

            floatingSearchInput.addEventListener('input', (e) => {
                searchInput.value = e.target.value;
                handleSearchInput(e.target.value, 'floatingSearchDropdown');
            });

            function handleSearchInput(searchTerm, dropdownId) {
                if (searchTerm.length > 0) {
                    const filtered = allBooks.filter(book => 
                        book.title.toLowerCase().includes(searchTerm.toLowerCase()) || 
                        book.author.toLowerCase().includes(searchTerm.toLowerCase())
                    ).slice(0, 10);
                    renderSearchDropdown(filtered, dropdownId);
                    document.getElementById(dropdownId).classList.add('active');
                } else {
                    document.getElementById(dropdownId).classList.remove('active');
                }
            }

            document.addEventListener('click', (e) => {
                if (!searchDropdown.contains(e.target) && e.target !== searchInput && !floatingSearchDropdown.contains(e.target) && e.target !== floatingSearchInput) {
                    searchDropdown.classList.remove('active');
                    floatingSearchDropdown.classList.remove('active');
                }
            });

            cartModalClose.addEventListener('click', () => {
                cartModal.classList.remove('active');
            });

            cartModal.addEventListener('click', (e) => {
                if (e.target === cartModal) {
                    cartModal.classList.remove('active');
                }
            });

            cartIcon.addEventListener('click', () => {
                renderCart();
                cartModal.classList.add('active');
            });

            checkoutBtn.addEventListener('click', (e) => {
                e.preventDefault();
                if (cart.length === 0) {
                    alert(translations[currentLanguage].emptyCart);
                    return;
                }
                orderItems = [...cart];
                cartModal.classList.remove('active');
                navigateToOrder();
            });

            detectLocationBtn.addEventListener('click', detectLocation);

            orderForm.addEventListener('submit', submitOrder);

            // Validasi real-time
            document.getElementById('nameInput').addEventListener('input', function() {
                if (this.value.trim()) {
                    document.getElementById('nameError').style.display = 'none';
                }
            });

            document.getElementById('phoneInput').addEventListener('input', function() {
                if (this.value.trim()) {
                    document.getElementById('phoneError').style.display = 'none';
                }
            });

            document.getElementById('addressInput').addEventListener('input', function() {
                if (this.value.trim()) {
                    document.getElementById('addressError').style.display = 'none';
                }
            });

            document.getElementById('paymentMethod').addEventListener('change', function() {
                if (this.value) {
                    document.getElementById('paymentError').style.display = 'none';
                }
            });

            document.getElementById('currencySelect').addEventListener('change', (e) => {
                currentCurrency = e.target.value;
                localStorage.setItem('currentCurrency', currentCurrency);
                filterAndRenderBooks(searchInput.value);
                if (document.getElementById('productDetailPage').style.display !== 'none') {
                    renderProductDetail(currentBook);
                }
                if (cartModal.classList.contains('active')) {
                    renderCart();
                }
                if (document.getElementById('orderPage').style.display !== 'none') {
                    renderOrderItems();
                }
            });

            document.getElementById('languageSelect').addEventListener('change', (e) => {
                currentLanguage = e.target.value;
                localStorage.setItem('currentLanguage', currentLanguage);
                updateLanguage();
                fetchCategories(); // Re-render categories with new language
                fetchPublishers(); // Re-render publishers
                filterAndRenderBooks(searchInput.value);
            });

            document.getElementById('homeLink').addEventListener('click', (e) => {
                e.preventDefault();
                navigateToHome();
            });

            document.getElementById('breadcrumbHome').addEventListener('click', (e) => {
                e.preventDefault();
                navigateToHome();
            });

            document.getElementById('clearFilter').addEventListener('click', () => {
                navigateToHome();
            });

            document.getElementById('prevPublisher').addEventListener('click', () => {
                const slides = document.querySelectorAll('.publisher-slide');
                const totalSlides = slides.length;
                currentPublisherIndex = (currentPublisherIndex - 1 + totalSlides) % totalSlides;
                updatePublisherSlider();
                
                if (publisherInterval) {
                    clearInterval(publisherInterval);
                    startPublisherSlider();
                }
            });

            document.getElementById('nextPublisher').addEventListener('click', () => {
                const slides = document.querySelectorAll('.publisher-slide');
                const totalSlides = slides.length;
                currentPublisherIndex = (currentPublisherIndex + 1) % totalSlides;
                updatePublisherSlider();
                
                if (publisherInterval) {
                    clearInterval(publisherInterval);
                    startPublisherSlider();
                }
            });

            // Bottom Navbar Event Listeners
            document.getElementById('bottomHome').addEventListener('click', (e) => {
                e.preventDefault();
                navigateToHome();
            });

            document.getElementById('bottomSearch').addEventListener('click', (e) => {
                e.preventDefault();
                document.getElementById('searchInput').focus();
            });

            document.getElementById('bottomCart').addEventListener('click', (e) => {
                e.preventDefault();
                renderCart();
                cartModal.classList.add('active');
            });

            document.getElementById('bottomPayment').addEventListener('click', (e) => {
                e.preventDefault();
                // Navigate to order or payment page
                navigateToOrder();
            });

            // ==================== INISIALISASI APLIKASI ====================
            async function initializeApp() {
                await fetchCurrency();
                fetchBanners();
                fetchCategories();
                fetchPublishers();
                fetchBooks();
                updateLanguage();
                updateCartBadge();
                checkUrlParams();
                document.getElementById('languageSelect').value = currentLanguage;
                document.getElementById('currencySelect').value = currentCurrency;
            }

            initializeApp();
        });
    </script>
</body>
</html>
